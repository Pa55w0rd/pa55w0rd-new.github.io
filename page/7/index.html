
<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  

  <title>Pa55w0rd &#39;s Blog</title>

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="信息安全">
<meta property="og:type" content="website">
<meta property="og:title" content="Pa55w0rd &#39;s Blog">
<meta property="og:url" content="https://www.pa55w0rd.club/page/7/index.html">
<meta property="og:site_name" content="Pa55w0rd &#39;s Blog">
<meta property="og:description" content="信息安全">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Pa55w0rd &#39;s Blog">
<meta name="twitter:description" content="信息安全">

  

  


  


  



  
    <link rel="alternative" href="/atom.xml" title="Pa55w0rd &#39;s Blog" type="application/atom+xml">
  


  
    <link rel="icon" href="/img/favicon.ico">
  


  <link rel="stylesheet" href="/css/style.css">
  <!-- <link href="/css/show.ua.css" rel="stylesheet" type="text/css" > -->
  <link href="http://fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <!--[if lt IE 9]><script src="//cdn.bootcss.com/html5shiv/r29/html5.min.js"></script><![endif]-->
  <!-- <link href="/vendors/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css" /> -->

  <link href="/vendors/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">

  <script src="/js/ua-parser.min.js" type="text/javascript"></script>
  <script src="/js/jquery.js" type="text/javascript"></script>
  <script src="/js/jquery.min.js" type="text/javascript"></script>
  <script src="/js/scrollReveal.js" type="text/javascript"></script>
  <script src="http://cdn.bootcss.com/instantsearch.js/1.5.1/instantsearch.js"></script>
  <script src="/js/algolia-search.js" type="text/javascript"></script>
  <!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
  <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script> -->
  <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
  <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
  <script src="https://cdn.bootcss.com/blueimp-md5/2.10.0/js/md5.js"></script>
  
  






  
  
  <!-- 
  
  
  
  
   -->

  <script>
   var CONFIG = {
    root: '/',
    algolia: {
          applicationID: "",
          apiKey: "",
          adminApiKey: "",
          indexName: "",
          hits: {"per_page":10},
          labels: {"input_placeholder":"搜索...","hits_empty":"未发现与 「${query}」相关的内容","hits_stats":"${hits} 条相关条目，使用了 ${time} 毫秒"}
        }
  };
  </script>

</head>


</html>
<body>
<div id="container">
  <div id="wrap">
    <header id="header">
  <div id="banner"></div>
  <div data-scroll-reveal="enter top" id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Pa55w0rd &#39;s Blog</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">记录</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/"><i class="fa fa-home" aria-hidden="true"></i>首页</a>
        
          <a class="main-nav-link" href="/archives"><i class="fa fa-archive" aria-hidden="true"></i>归档</a>
        
          <a class="main-nav-link" href="/about"><i class="fa fa-about" aria-hidden="true"></i>about</a>
        
          <a class="main-nav-link" href="/categories"><i class="fa fa-categories" aria-hidden="true"></i>Categories</a>
        
          <a class="main-nav-link" href="/tags"><i class="fa fa-tags" aria-hidden="true"></i>标签</a>
        
          <a class="main-nav-link" href="/about"><i class="fa fa-user" aria-hidden="true"></i>关于我</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a class="nav-icon" href="/atom.xml" title="RSS Feed"><i class="fa fa-rss" aria-hidden="true"></i></a>
        
        <a id="nav-search-btn" class="nav-icon popup-trigger" title="Search"><i class="fa fa-search" aria-hidden="true"></i></a>
      </nav>
        <div id="local-search-input"></div>
      <!-- 百度搜索 -->
     <!-- <div id="search-form-wrap">
        <form action="//www.baidu.com/baidu" method="get" accept-charset="utf-8" class="search-form">
          <input type="search" name="word" maxlength="20" class="search-form-input" placeholder="Search">
          <input type="submit" value="" class="search-form-submit">
          <input name=tn type=hidden value="bds">
          <input name=cl type=hidden value="3">
          <input name=ct type=hidden value="2097152">
          <input type="hidden" name="si" value="www.pa55w0rd.club">
        </form>
      </div>
      -->
   
    </div>
  </div>
</header>

    <div class="outer">
      <section id="main">
  
    <article id="post-wireshark使用" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div data-scroll-reveal="enter top and over 0.7s" class="article-meta">
    <a href="/wireshark使用/" class="article-date">
  <i class="fa fa-calendar"></i>
  <time datetime="2018-10-09T02:10:35.000Z" itemprop="datePublished">2018-10-09</time>
</a>

    
  <div class="article-category">
    <a class="article-category-link" href="/categories/note/">note</a>
  </div>


  </div>
  <div class="article-inner">
    
    

      <header class="article-header">

        
  
    <h1 itemprop="name">
      <a class="article-title" href="/wireshark使用/">
        <i class="fa fa-pencil-square-o  article-title-icon"></i>Wireshark使用</a>
    </h1>
  



      </header>
    
    <div class="article-entry" itemprop="articleBody">
      

        <br>
        <span id="busuanzi_container_page_pv">
          阅读次数<span id="busuanzi_value_page_pv"></span>
        </span>
        <h2 id="0x00-前言"><a href="#0x00-前言" class="headerlink" title="0x00 前言"></a>0x00 前言</h2><p>Wireshark（前称Ethereal）是一个网络封包分析软件。网络封包分析软件的功能是撷取网络封包，并尽可能显示出最为详细的网络封包资料。Wireshark使用WinPCAP作为接口，直接与网卡进行数据报文交换。大家可以用它来排查故障、分析攻击类型等，可以更快理解和发现问题</p>
<h2 id="0x01-工作流程"><a href="#0x01-工作流程" class="headerlink" title="0x01 工作流程"></a>0x01 工作流程</h2><ol>
<li>确定Wireshark的位置。如果没有一个正确的位置，启动Wireshark后会花费很长的时间捕获一些与自己无关的数据。</li>
<li>选择捕获接口。一般都是选择连接到Internet网络的接口，这样才可以捕获到与网络相关的数据。否则，捕获到的其它数据对自己也没有任何帮助。</li>
<li>使用捕获过滤器。通过设置捕获过滤器，可以避免产生过大的捕获文件。这样用户在分析数据时，也不会受其它数据干扰。而且，还可以为用户节约大量的时间。</li>
<li>使用显示过滤器。通常使用捕获过滤器过滤后的数据，往往还是很复杂。为了使过滤的数据包再更细致，此时使用显示过滤器进行过滤。</li>
<li>使用着色规则。通常使用显示过滤器过滤后的数据，都是有用的数据包。如果想更加突出的显示某个会话，可以使用着色规则高亮显示。</li>
<li>构建图表。如果用户想要更明显的看出一个网络中数据的变化情况，使用图表的形式可以很方便的展现数据分布情况。</li>
<li>重组数据。Wireshark的重组功能，可以重组一个会话中不同数据包的信息，或者是一个重组一个完整的图片或文件。由于传输的文件往往较大，所以信息分布在多个数据包中。为了能够查看到整个图片或文件，这时候就需要使用重组数据的方法来实现。</li>
</ol>
<h2 id="0x02-使用技巧"><a href="#0x02-使用技巧" class="headerlink" title="0x02 使用技巧"></a>0x02 使用技巧</h2><h3 id="TCP流绘制"><a href="#TCP流绘制" class="headerlink" title="TCP流绘制"></a>TCP流绘制</h3><p>为了便于理解在整个TCP会话期间，TCP 的Seq号和Ack号的工作过程，可使用Wireshark的绘制流功能，选择菜单栏中的<code>统计 -&gt;流量图 -&gt;TCP flows</code>，会自动创建一个TCP流的图形。</p>
<p>每行代表一个数据包，左边列显示时间，中间列显示包的方向、TCP端口、包的负载长度和设置的标志位，右边列以10进制的方式显示相关Seq号/Ack号。</p>
<p><img src="/assets/img/wireshark/1.png" alt="tcp流绘制"></p>
<p>Wireshark默认展示的是相对Seq号/Ack号，相对Seq号/Ack号是和TCP会话的初始序列号相关联的。跟真实Seq号/Ack号相比，跟踪更小的相对Seq号/Ack号会相对容易一些。</p>
<p>如果想要关闭相对序列号/确认号，可以选择Wireshark菜单栏中的<code>编辑 -&gt; 首选项 -&gt;protocols -&gt;TCP</code>，取消勾选<code>Relative sequence number</code>选项即可。</p>
<h3 id="包的拼接与拆解"><a href="#包的拼接与拆解" class="headerlink" title="包的拼接与拆解"></a>包的拼接与拆解</h3><p><strong>包的拆解</strong>：在数据包保存时，<code>文件 -&gt; 导出特定分组</code>在对话框下面有一些保存选项，这里可以设置按什么方将包拆解。选好后填好文件名保存即可完成拆解。</p>
<p><img src="/assets/img/wireshark/2.png" alt="包拆解"></p>
<p><strong>包的拼接</strong>：<code>文件 -&gt; 合并（merge）</code> 然后选中一个将要被拼接的包，在该对话框下面设置接接方式和显示过滤器等</p>
<p><img src="/assets/img/wireshark/3.png" alt="包拼接"></p>
<h3 id="相对时间显示"><a href="#相对时间显示" class="headerlink" title="相对时间显示"></a>相对时间显示</h3><p>以一个数据包的时间为基准，后面的数据包显示都是以这个数据包的时间作为基准，这种方式常用于对网络延时的响应判断，是判断服务器还是客户端还是线路的延迟，来解决网络速度问题。有时数据包丢失并非延迟造成，当两台主机间通信很慢时，并没有TCP 重传或者重复ACK 特征，这时需要查看初始连接握手以及接下来的两个数据包。以相对时间显示来查看数据包的延迟情况。</p>
<p><img src="/assets/img/wireshark/4.png" alt="相对时间显示"></p>
<h3 id="协议统计分层信息"><a href="#协议统计分层信息" class="headerlink" title="协议统计分层信息"></a>协议统计分层信息</h3><p>使用<code>统计 –&gt; 协议分级</code>，此信息显示的是抓包文件包含的所有协议的树状分支。数据包通常会包含许多协议，有很多协议会在每个包中被统计。End Packets，End Bytes，End Mbit/s列是该层在抓包中作为最后一层协议的统计数据，按分组百分比参照的是相同协议层的百分比。</p>
<p><img src="/assets/img/wireshark/5.png" alt="协议分级统计"></p>
<h3 id="网络会话列表"><a href="#网络会话列表" class="headerlink" title="网络会话列表"></a>网络会话列表</h3><p>网络会话是两个指定终端之间的数据流，使用<code>统计 —&gt; 对话</code>统计功能分析协议，通过对话列表，能看出很多网络问题。</p>
<p>第3层IP统计数据，IP会话是两个IP地址之间的所有数据流，观察源ip和目的ip分布规律可知道ip地址请求报文分布，点击每列表头可得到排序；也可知道包大小，字节大小。通过字节分布，看看是小包攻击还是应用层攻击。</p>
<p>第4层TCP或UDP统计数据：看看主要是tcp攻击还是udp数据包，此列表主要分析tcp的链接次数、源端口和目的端口分布规律，是固定还是随机的。比如每一个PC合理的连接数是10到20个，上百个则是不正常的。</p>
<p><img src="/assets/img/wireshark/6.png" alt="会话列表"></p>
<h3 id="网络端点列表"><a href="#网络端点列表" class="headerlink" title="网络端点列表"></a>网络端点列表</h3><p>选择菜单栏中的<code>统计 -&gt; 端点</code>，分析IP地址的pps和bps，以及统计每个端点的地址、发送或收到的数据包的数量和字节。少量IP终端节点与大量TCP终端节点：可能的情况是每一台主机有很多个TCP连接，进而推测可能是网络攻击。</p>
<p><img src="/assets/img/wireshark/7.png" alt="端点列表"></p>
<h3 id="IP地址统计列表"><a href="#IP地址统计列表" class="headerlink" title="IP地址统计列表"></a>IP地址统计列表</h3><p>使用<code>统计 —IP Statistics—all addresss</code>，分析IP地址的排序和百分比</p>
<p><img src="/assets/img/wireshark/8.png" alt="ip地址统计"></p>
<h3 id="应用层数据包分析"><a href="#应用层数据包分析" class="headerlink" title="应用层数据包分析"></a>应用层数据包分析</h3><p>使用<code>统计 -http-分组计数器</code>、可以看到http get和post数据包分布规律，发现数据包大部分是get。</p>
<p><img src="/assets/img/wireshark/9.png" alt="应用层统计"></p>
<p>使用<code>统计 -http-请求</code>可以看到请求url分布过来，发现get请求的url集中在极个别的url上面，url带有明显特征。</p>
<p><img src="/assets/img/wireshark/10.png" alt="应用层统计"></p>
<h3 id="数据包着色"><a href="#数据包着色" class="headerlink" title="数据包着色"></a>数据包着色</h3><p>Wireshark地彩色高亮有助于快速标识协议。将数据包进行彩色高亮，可以让你很快地讲不通协议的数据包分开，而不需要对每个数据包都查看Packet List面板中地协议列，举例来说，如果觉得网络上有一个恶意的DHCP服务器在分发IP，可以简单地修改DHCP协议的着色规则，使其呈现黄色（或者其他便于辨认地颜色）。这可以能够更快地找出所有DHCP流量，数据包分析工作更有效率。使用<code>视图 - 着色规则</code>来修改</p>
<p><img src="/assets/img/wireshark/11.png" alt="着色规则"></p>

      

    </div>





    <footer class="article-footer">
      
        <a data-url="https://www.pa55w0rd.club/wireshark使用/" data-id="cjop4yndb000bldt6qmt8enw3" class="article-share-link" data-share="baidu" data-title="Wireshark使用">分享到</a>
      

      
        <a href="https://www.pa55w0rd.club/wireshark使用/#gitalk-container" class="article-comment-link">评论</a>
      

      

    </footer>
  </div>
  
</article>
<!--
<div class="share-component" data-disabled="" data-description="Share.js - 一键分享到微博，QQ空间，腾讯微博，人人，豆瓣">一键分享</div>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/css/share.min.css" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/js/social-share.min.js"></script>
-->







  
    <article id="post-ubuntu安装xunfeng" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div data-scroll-reveal="enter top and over 0.7s" class="article-meta">
    <a href="/ubuntu安装xunfeng/" class="article-date">
  <i class="fa fa-calendar"></i>
  <time datetime="2018-10-08T03:29:31.000Z" itemprop="datePublished">2018-10-08</time>
</a>

    
  <div class="article-category">
    <a class="article-category-link" href="/categories/企业安全/">企业安全</a>
  </div>


  </div>
  <div class="article-inner">
    
    

      <header class="article-header">

        
  
    <h1 itemprop="name">
      <a class="article-title" href="/ubuntu安装xunfeng/">
        <i class="fa fa-pencil-square-o  article-title-icon"></i>ubuntu搭建xunfeng资产扫描系统</a>
    </h1>
  



      </header>
    
    <div class="article-entry" itemprop="articleBody">
      

        <br>
        <span id="busuanzi_container_page_pv">
          阅读次数<span id="busuanzi_value_page_pv"></span>
        </span>
        <ul>
<li>目录<br>{:toc}</li>
</ul>
<h2 id="0x00-前言"><a href="#0x00-前言" class="headerlink" title="0x00 前言"></a>0x00 前言</h2><p>巡风是一款适用于企业内网的<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">网络资产识别引擎会通过用户配置的IP范围定期自动的进行端口探测（支持调用MASSCAN），并进行指纹识别，识别内容包括：服务类型、组件容器、脚本语言、CMS。</span><br><span class="line"></span><br><span class="line">漏洞检测引擎会根据用户指定的任务规则进行定期或者一次性的漏洞检测，其支持2种插件类型、标示符与脚本，均可通过web控制台进行添加。</span><br><span class="line"></span><br><span class="line">巡风需要在```python2.7```和```mongodb3.2```版本以上环境上安装 </span><br><span class="line"></span><br><span class="line">```git clone https://github.com/ysrc/xunfeng</span><br></pre></td></tr></table></figure></p>
<h2 id="0x01-环境配置"><a href="#0x01-环境配置" class="headerlink" title="0x01 环境配置"></a>0x01 环境配置</h2><h3 id="换源"><a href="#换源" class="headerlink" title="换源"></a>换源</h3><p>安装好Ubuntu，首先换源</p>
<p>部署和调试巡风要求root权限，请用户切换到root账号进行操作,Ubuntu默认未开启root，请使用下列命令开启</p>
<figure class="highlight plain"><figcaption><span>sudo passwd root```</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">输入你自己设置的root密码后</span><br><span class="line"></span><br><span class="line">```$ su root</span><br></pre></td></tr></table></figure>
<p>即可切换到root账号</p>
<p>通过lsb_release 查看开发版本代号为18.04 bionic<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># lsb_release -a</span></span><br><span class="line"><span class="literal">No</span> <span class="string">LSB</span> <span class="string">modules</span> <span class="string">are</span> <span class="string">available.</span></span><br><span class="line"><span class="string">Distributor</span> <span class="attr">ID:</span> <span class="string">Ubuntu</span></span><br><span class="line"><span class="attr">Description:</span>    <span class="string">Ubuntu</span> <span class="number">18.04</span><span class="number">.1</span> <span class="string">LTS</span></span><br><span class="line"><span class="attr">Release:</span>        <span class="number">18.04</span></span><br><span class="line"><span class="attr">Codename:</span>       <span class="string">bionic</span></span><br></pre></td></tr></table></figure></p>
<p>备份原来的数据源配置文件</p>
<figure class="highlight plain"><figcaption><span>cp</span><a href="/etc/apt/sources.list">/etc/apt/sources.list_backup```</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">编辑数据源配置文件</span><br><span class="line"></span><br><span class="line">```# vi /etc/apt/sources.list</span><br></pre></td></tr></table></figure>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">deb</span> http<span class="variable">s:</span>//mirrors.ustc.edu.<span class="keyword">cn</span>/ubuntu/ bionic main restricted universe multiverse</span><br><span class="line"><span class="keyword">deb</span>-src http<span class="variable">s:</span>//mirrors.ustc.edu.<span class="keyword">cn</span>/ubuntu/ bionic main restricted universe multiverse</span><br><span class="line"></span><br><span class="line"><span class="keyword">deb</span> http<span class="variable">s:</span>//mirrors.ustc.edu.<span class="keyword">cn</span>/ubuntu/ bionic-security main restricted universe multiverse</span><br><span class="line"><span class="keyword">deb</span>-src http<span class="variable">s:</span>//mirrors.ustc.edu.<span class="keyword">cn</span>/ubuntu/ bionic-security main restricted universe multiverse</span><br><span class="line"></span><br><span class="line"><span class="keyword">deb</span> http<span class="variable">s:</span>//mirrors.ustc.edu.<span class="keyword">cn</span>/ubuntu/ bionic-updates main restricted universe multiverse</span><br><span class="line"><span class="keyword">deb</span>-src http<span class="variable">s:</span>//mirrors.ustc.edu.<span class="keyword">cn</span>/ubuntu/ bionic-updates main restricted universe multiverse</span><br><span class="line"></span><br><span class="line"><span class="keyword">deb</span> http<span class="variable">s:</span>//mirrors.ustc.edu.<span class="keyword">cn</span>/ubuntu/ bionic-backports main restricted universe multiverse</span><br><span class="line"><span class="keyword">deb</span>-src http<span class="variable">s:</span>//mirrors.ustc.edu.<span class="keyword">cn</span>/ubuntu/ bionic-backports main restricted universe multiverse</span><br></pre></td></tr></table></figure>
<p>保存后执行<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-<span class="builtin-name">get</span> update &amp;&amp; apt-<span class="builtin-name">get</span><span class="built_in"> upgrade </span>&amp;&amp; apt-<span class="builtin-name">get</span> dist-upgrade</span><br></pre></td></tr></table></figure></p>
<h3 id="修改时区为Asia-Shanghai"><a href="#修改时区为Asia-Shanghai" class="headerlink" title="修改时区为Asia/Shanghai"></a>修改时区为Asia/Shanghai</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">echo</span> TZ\=<span class="string">'Asia/Shanghai'</span>\; <span class="built_in">export</span> TZ &gt;&gt; ~/.bash\_profile &amp;&amp; <span class="built_in">source</span> ~/.bash\_profile</span></span><br></pre></td></tr></table></figure>
<h3 id="安装操作系统依赖"><a href="#安装操作系统依赖" class="headerlink" title="安装操作系统依赖"></a>安装操作系统依赖</h3><figure class="highlight q"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># apt-<span class="built_in">get</span> install gcc libssl-<span class="built_in">dev</span> libffi-<span class="built_in">dev</span> python-<span class="built_in">dev</span> libpcap-<span class="built_in">dev</span></span><br></pre></td></tr></table></figure>
<h3 id="安装python依赖库"><a href="#安装python依赖库" class="headerlink" title="安装python依赖库"></a>安装python依赖库</h3><p>使用pip进行python依赖库管理，如果系统没有安装pip，可以通过如下命令安装</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># wget http<span class="variable">s:</span>//sec.ly.<span class="keyword">com</span>/mirror/<span class="built_in">get</span>-pip.<span class="keyword">py</span> --<span class="keyword">no</span>-check-certificate &amp;&amp; <span class="keyword">python</span> <span class="built_in">get</span>-pip.<span class="keyword">py</span></span><br></pre></td></tr></table></figure>
<p>使用pip安装 python 依赖库, 这里使用了豆瓣的 pypi 源<br><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># pip install -r requirements.txt -i https:<span class="comment">//pypi.doubanio.com/simple/</span></span></span><br></pre></td></tr></table></figure></p>
<h3 id="安装mongo数据库"><a href="#安装mongo数据库" class="headerlink" title="安装mongo数据库"></a>安装mongo数据库</h3><p>由于低版本不支持全文索引，MongoDB版本需要 ≥ 3.2。</p>
<p><a href="https://docs.mongodb.com/v3.2/tutorial/install-mongodb-on-ubuntu/" target="_blank" rel="noopener">参考官方安装步骤</a></p>
<ol>
<li><p>安装公钥</p>
 <figure class="highlight plain"><figcaption><span>apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv EA312927```</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">1. 添加3.2的源</span><br><span class="line"></span><br><span class="line">    ```# echo &quot;deb http://repo.mongodb.org/apt/ubuntu xenial/mongodb-org/3.2 multiverse&quot; | sudo tee /etc/apt/sources.list.d/mongodb-org-3.2.list</span><br></pre></td></tr></table></figure>
</li>
<li><p>安装数据库</p>
 <figure class="highlight plain"><figcaption><span>apt-get update && apt-get install -y mongodb-org```</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">4. 启动mongodb服务</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    默认情况下apt方式安装的mongodb会自动启动，查看是否启动成功</span><br><span class="line"></span><br><span class="line">    ```# netstat -antlp | grep 27017</span><br></pre></td></tr></table></figure>
<p> 如果没有启动 </p>
 <figure class="highlight plain"><figcaption><span>systemctl start mongodb```</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">设置开机启动</span><br><span class="line"></span><br><span class="line">```# systemctl enable mongodb</span><br></pre></td></tr></table></figure>
</li>
<li><p>mongodb添加认证</p>
 <figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mongo</span></span><br><span class="line">&gt; use xunfeng</span><br><span class="line">&gt; db.createUser(&#123;user:<span class="string">'scan'</span>,pwd:<span class="string">'your password'</span>,roles:[    &#123;role:<span class="string">'dbOwner'</span>,db:<span class="string">'xunfeng'</span>&#125;]&#125;)</span><br><span class="line">&gt; <span class="keyword">exit</span></span><br></pre></td></tr></table></figure>
<p> 这里的 scan和your password 需要更换为你的mongodb的账户和密码。</p>
</li>
</ol>
<h2 id="0x02-部署"><a href="#0x02-部署" class="headerlink" title="0x02 部署"></a>0x02 部署</h2><h3 id="导入数据库"><a href="#导入数据库" class="headerlink" title="导入数据库"></a>导入数据库</h3><p>进入 <figure class="highlight plain"><figcaption><span>文件夹, 执行如下命令:</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">```# mongorestore -h 127.0.0.1 --port 27017 -d xunfeng .</span><br></pre></td></tr></table></figure></p>
<h3 id="修改配置"><a href="#修改配置" class="headerlink" title="修改配置"></a>修改配置</h3><p>修改系统数据库配置脚本 Config.py:</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Config</span></span>(<span class="keyword">object</span>):</span><br><span class="line">    ACCOUNT = <span class="string">'admin'</span></span><br><span class="line">    PASSWORD = <span class="string">'xunfeng321'</span></span><br></pre></td></tr></table></figure>
<p>修改 PASSWORD 字段内的密码, 设置成你的密码。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ProductionConfig</span><span class="params">(Config)</span>:</span></span><br><span class="line">    DB = <span class="string">'127.0.0.1'</span></span><br><span class="line">    PORT = <span class="number">27017</span></span><br><span class="line">    DBUSERNAME = <span class="string">'scan'</span></span><br><span class="line">    DBPASSWORD = <span class="string">'your password'</span></span><br><span class="line">    DBNAME = <span class="string">'xunfeng'</span></span><br></pre></td></tr></table></figure>
<h3 id="运行系统"><a href="#运行系统" class="headerlink" title="运行系统"></a>运行系统</h3><p>根据实际情况修改(端口和目录需对应好) Conifg.py 和 Run.sh 文件后, 执行:</p>
<p><code># sh Run.sh</code></p>
<p>如开启防火墙，需打开80端口</p>

      

    </div>





    <footer class="article-footer">
      
        <a data-url="https://www.pa55w0rd.club/ubuntu安装xunfeng/" data-id="cjop4yndp000kldt6ehbd4tf5" class="article-share-link" data-share="baidu" data-title="ubuntu搭建xunfeng资产扫描系统">分享到</a>
      

      
        <a href="https://www.pa55w0rd.club/ubuntu安装xunfeng/#gitalk-container" class="article-comment-link">评论</a>
      

      

    </footer>
  </div>
  
</article>
<!--
<div class="share-component" data-disabled="" data-description="Share.js - 一键分享到微博，QQ空间，腾讯微博，人人，豆瓣">一键分享</div>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/css/share.min.css" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/js/social-share.min.js"></script>
-->







  
    <article id="post-token的使用" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div data-scroll-reveal="enter top and over 0.7s" class="article-meta">
    <a href="/token的使用/" class="article-date">
  <i class="fa fa-calendar"></i>
  <time datetime="2018-09-30T09:17:05.000Z" itemprop="datePublished">2018-09-30</time>
</a>

    
  <div class="article-category">
    <a class="article-category-link" href="/categories/开发安全/">开发安全</a>
  </div>


  </div>
  <div class="article-inner">
    
    

      <header class="article-header">

        
  
    <h1 itemprop="name">
      <a class="article-title" href="/token的使用/">
        <i class="fa fa-pencil-square-o  article-title-icon"></i>token的使用</a>
    </h1>
  



      </header>
    
    <div class="article-entry" itemprop="articleBody">
      

        <br>
        <span id="busuanzi_container_page_pv">
          阅读次数<span id="busuanzi_value_page_pv"></span>
        </span>
        <p>Token，就是令牌，最大的特点就是随机性，不可预测。一般黑客或软件无法猜测出来，那么，Token有什么作用？又是什么原理呢？</p>
<p>Token一般用在两个地方:</p>
<ul>
<li>防止表单重复提交</li>
<li>anti csrf攻击（跨站点请求伪造）</li>
</ul>
<p>两者在原理上都是通过session token来实现的。当客户端请求页面时，服务器会生成一个随机数Token，并且将Token放置到session当中，然后将Token发给客户端（一般通过构造hidden表单）。下次客户端提交请求时，Token会随着表单一起提交到服务器端。</p>
<p>然后，如果应用于“anti csrf攻击”，则服务器端会对Token值进行验证，判断是否和session中的Token值相等，若相等，则可以证明请求有效，不是伪造的。</p>
<p>不过，如果应用于“防止表单重复提交”，服务器端第一次验证相同过后，会将session中的Token值更新下，若用户重复提交，第二次的验证判断将失败，因为用户提交的表单中的Token没变，但服务器端session中Token已经改变了。</p>
<p>上面的session应用相对安全，但也叫繁琐，同时当多页面多请求时，必须采用多Token同时生成的方法，这样占用更多资源，执行效率会降低。因此，也可用cookie存储验证信息的方法来代替session Token。比如，应对“重复提交”时，当第一次提交后便把已经提交的信息写到cookie中，当第二次提交时，由于cookie已经有提交记录，因此第二次提交会失败。</p>
<p>不过，cookie存储有个致命弱点，如果cookie被劫持（xss攻击很容易得到用户cookie），那么又一次gameover。黑客将直接实现csrf攻击。</p>
<p>所以，安全和高效相对的。具体问题具体对待吧。</p>
<p>此外，要避免“加token但不进行校验”的情况，在session中增加了token，但服务端没有对token进行验证，根本起不到防范的作用。</p>
<p>还需注意的是，对数据库有改动的增删改操作，需要加token验证，对于查询操作，一定不要加token，防止攻击者通过查询操作获取token进行csrf攻击。但并不是这样攻击者就无法获得token，只是增大攻击成本而已。</p>

      

    </div>





    <footer class="article-footer">
      
        <a data-url="https://www.pa55w0rd.club/token的使用/" data-id="cjop4ynd90008ldt6qkccvxqz" class="article-share-link" data-share="baidu" data-title="token的使用">分享到</a>
      

      
        <a href="https://www.pa55w0rd.club/token的使用/#gitalk-container" class="article-comment-link">评论</a>
      

      

    </footer>
  </div>
  
</article>
<!--
<div class="share-component" data-disabled="" data-description="Share.js - 一键分享到微博，QQ空间，腾讯微博，人人，豆瓣">一键分享</div>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/css/share.min.css" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/js/social-share.min.js"></script>
-->







  
    <article id="post-应用开发安全指南" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div data-scroll-reveal="enter top and over 0.7s" class="article-meta">
    <a href="/应用开发安全指南/" class="article-date">
  <i class="fa fa-calendar"></i>
  <time datetime="2018-09-28T10:37:59.000Z" itemprop="datePublished">2018-09-28</time>
</a>

    
  <div class="article-category">
    <a class="article-category-link" href="/categories/开发安全/">开发安全</a>
  </div>


  </div>
  <div class="article-inner">
    
    

      <header class="article-header">

        
  
    <h1 itemprop="name">
      <a class="article-title" href="/应用开发安全指南/">
        <i class="fa fa-pencil-square-o  article-title-icon"></i>应用开发安全指南</a>
    </h1>
  



      </header>
    
    <div class="article-entry" itemprop="articleBody">
      

        <br>
        <span id="busuanzi_container_page_pv">
          阅读次数<span id="busuanzi_value_page_pv"></span>
        </span>
        <ul>
<li>目录<br>{:toc}<h1 id="1-概述"><a href="#1-概述" class="headerlink" title="1.概述"></a>1.概述</h1>本指南是IT安全保障体系建设规范的一个组成部分，全面阐述了IT系统应用开发整个软件生命周期所必须遵照的设计、编码、测试方面的安全要求，阐述了不同开发环境和编码语言条件下安全开发的相关规范要求。<h2 id="1-1-目的"><a href="#1-1-目的" class="headerlink" title="1.1.目的"></a>1.1.目的</h2>本指南针对xxxx应用系统应当遵循的应用开发安全标准进行了规范性说明，旨在指导应用系统设计人员、代码开发人员和安全检查管理人员进行应用安全开发的安全配置，以提高应用系统的安全防护能力。<h2 id="1-2-适用范围"><a href="#1-2-适用范围" class="headerlink" title="1.2.适用范围"></a>1.2.适用范围</h2>本指南适用于xxxx系统代码开发项目，作为xxxx在IT系统开发、设计环节中所遵照执行的依据。<h2 id="1-3-适用对象"><a href="#1-3-适用对象" class="headerlink" title="1.3.适用对象"></a>1.3.适用对象</h2>本配置指南的适用人员包括：xxxx系统应用开发人员及安全检查管理人员。</li>
</ul>
<hr>
<h1 id="2-应用系统设计安全"><a href="#2-应用系统设计安全" class="headerlink" title="2.应用系统设计安全"></a>2.应用系统设计安全</h1><h2 id="2-1-应用系统架构安全设计要求"><a href="#2-1-应用系统架构安全设计要求" class="headerlink" title="2.1.应用系统架构安全设计要求"></a>2.1.应用系统架构安全设计要求</h2><p>在应用系统设计阶段，应充分考虑该架构的安全性,包括B/S、C/S等形式的安全，主要体现在应用数据和用户会话的安全，还应当考虑应用系统自身体系架构内部的安全，以及与外系统接口的安全。针对某些特殊应用，还需考虑复、抗攻击等安全机制。</p>
<h3 id="2-1-1-应用系统自身架构安全"><a href="#2-1-1-应用系统自身架构安全" class="headerlink" title="2.1.1.应用系统自身架构安全"></a>2.1.1.应用系统自身架构安全</h3><ol>
<li><p>自身结构中各组件之间通讯过程的安全机制<br><br>组件之间的通讯包括命令级的和数据级的，应充分考虑：</p>
<ul>
<li>传输命令和数据所采用的协议的安全性。应根据组件之间通讯内容安全性要求程度的不同选择不同安全性要求的协议；</li>
<li>考虑程序的模块之间的安全通讯机制；</li>
<li>不应使用标准的服务端口或者常见病毒、蠕虫等使用的服务端口。</li>
</ul>
</li>
<li><p>认证与访问控制机制，应考虑：</p>
<ul>
<li>组件之间的信任机制；</li>
<li>用户的身份认证机制；</li>
<li>对于组件资源的访问控制机制；</li>
<li>不通用户对资源的权限控制机制。</li>
</ul>
</li>
<li><p>组件内重要文件和数据的安全防护机制：<br><br>存在于组件内部的重要数据资源应当考虑其相应的安全防护机制，这些重要的数据资源包括：</p>
<ul>
<li>配置文件；</li>
<li>用户数据，包括文件数据及数据库中的数据；</li>
<li>临时文件和数据；</li>
<li>与外系统或者系统内部其他组件接口用的数据文件。</li>
</ul>
<p>对这些重要数据的存取安全性设计，包括:</p>
<ul>
<li>文件和数据存放是否加密及采用的加密方式。</li>
</ul>
</li>
</ol>
<h3 id="2-1-2-应用系统与外系统接口的安全"><a href="#2-1-2-应用系统与外系统接口的安全" class="headerlink" title="2.1.2.应用系统与外系统接口的安全"></a>2.1.2.应用系统与外系统接口的安全</h3><p>应用系统与外系统的接口安全设计，主要应考虑以下几个要素：</p>
<ol>
<li>与外系统的之间通讯中的安全机制。应充分考虑：</li>
</ol>
<ul>
<li>传输命令和数据所采用的协议的安全性。应根据系统之间通讯内容安全性要求程度的不同选择不同安全性要求的协议；</li>
<li>建议不使用默认的服务端口或者常见病毒、蠕虫等使用的服务端口。</li>
<li>传输过程使用加密传输</li>
</ul>
<ol start="2">
<li>与外系统的认证与访问控制机制，应考虑：</li>
</ol>
<ul>
<li>系统之间的信任机制；</li>
<li>对于系统之间资源的访问控制机制。</li>
<li>会话凭证的有效时间</li>
<li>可以访问资源的权限控制</li>
</ul>
<ol start="3">
<li>对外系统安全机制的符合性，应考虑：</li>
</ol>
<ul>
<li>如果外系统采用的接口方式经评估认为是安全的，本系统应当沿用其接口规范进行设计开发；</li>
<li>如果外系统采用的接口方式经评估认为存在安全缺陷，应商定采用更加安全的接口方式；</li>
<li>在考虑接口安全性的同时，也应当注意接口方式对双方系统性能、磁盘、连接数等各种性能指标和资源的影响。</li>
</ul>
<h3 id="2-1-3-应用系统其他的安全机制"><a href="#2-1-3-应用系统其他的安全机制" class="headerlink" title="2.1.3.应用系统其他的安全机制"></a>2.1.3.应用系统其他的安全机制</h3><p>除了上述基本的安全架构设计内容外，针对不同的应用，以及应用系统的重要程度，可以补充考虑以下几种安全机制：</p>
<ol>
<li>针对Web应用的页面保护与恢复机制。<br><br>利用专用的安全产品，或者系统自身设计时就考虑到了对于Web页面进行静态保护和监控问题，当监控到网页被篡改时能够实时恢复页面。</li>
<li>针对特殊数据的完整性检查和监控机制。<br><br>应用系统自身的审计机制。这一点也可算作是应用系统的安全功能设计的一部分，参见相关章节的要求。</li>
<li>应用系统安全性分析。<br></li>
<li>针对重要系统的DDOS攻击的解决方案</li>
<li>除了使用技术手段保证接口安全的同时，也需要保证接口相关代码和文件不被上传到互联网或泄漏给非必要人员。<br><br>任何系统都会存在一定的安全缺陷，关键在于风险和缺陷是否可以被容忍，因此，在应用系统设计完成后，应当就其安全性问题进行自我分析和评价。</li>
</ol>
<h2 id="2-2-应用系统软件功能安全设计要求"><a href="#2-2-应用系统软件功能安全设计要求" class="headerlink" title="2.2.应用系统软件功能安全设计要求"></a>2.2.应用系统软件功能安全设计要求</h2><p>除了在架构上考虑的安全机制外，这些安全机制及相关的安全功能也应当分配在应用系统软件的各部件中。应用系统在开发中应该考虑如下五个方面的安全功能：</p>
<ul>
<li>安全审计；</li>
<li>通讯安全（此部分内容在架构中进行了设计）；</li>
<li>数据保护；</li>
<li>认证与授权；</li>
<li>最小权限；</li>
<li>资源保障。</li>
</ul>
<h3 id="2-2-1-认证与授权功能的设计"><a href="#2-2-1-认证与授权功能的设计" class="headerlink" title="2.2.1.认证与授权功能的设计"></a>2.2.1.认证与授权功能的设计</h3><ol>
<li>应用软件应包含用户身份认证体系的强度设计,重要系统应使用双因素认证措施，加强系统安全性：</li>
</ol>
<ul>
<li>用户名、口令认证；</li>
<li>一次性口令、动态口令认证；</li>
<li>证书认证；（可选）</li>
<li>生物特征的认证（签名、声音、指纹、虹膜、视网膜等）。（可选）</li>
</ul>
<ol start="2">
<li>应用软件应包含认证失败后的处理方式设计</li>
</ol>
<ul>
<li>连续失败3次，将锁定登录账号一个小时。账号锁定后可以由系统管理员解锁，也可以在一段时间后自动解锁；</li>
<li>通知用户认证失败，防止黑客暴力猜测；</li>
<li>验证码的功能，需要一定复杂度，防止被机器识别；</li>
<li>账号复杂度提醒功能。</li>
</ul>
<ol start="3">
<li>应用软件应包含用户权限分配和管理功能设计。</li>
</ol>
<ul>
<li>系统编码中要实现读、写、执行三个权限的分离设计；</li>
<li>系统查看、配置、修改、删除、登录、运行等权限设计；</li>
<li>数据访问范围的权限设计；</li>
<li>针对不同用户的数据库表权限隔离</li>
<li>应用功能模块使用权限的设计。</li>
</ul>
<ol start="4">
<li>应用软件应包含接口设计，应明确系统的内部结构和外部接口，对于每一个对外接口应详细说明：</li>
</ol>
<ul>
<li>需要通信的对方系统的安全状况和可信程度；</li>
<li>需传送的数据的保密性和完整性要求；</li>
<li>对传送数据的合法性检验规则；</li>
<li>对通信可靠性的要求；</li>
<li>信息传输过程的加密需求；</li>
<li>与外部系统的互相认证方面的需求。</li>
</ul>
<h3 id="2-2-2-数据安全功能"><a href="#2-2-2-数据安全功能" class="headerlink" title="2.2.2.数据安全功能"></a>2.2.2.数据安全功能</h3><ol>
<li>应用系统的数据安全功能，应当根据安全需求进行功能设计，内容涉及：数据库的安全、数据采集、数据传输、数据处理、数据存储、数据备份和恢复的安全。对重要的敏感数据应进行加密和完整性保护。</li>
<li>应用软件应包含输入的安全性设计，主要指对错误输入、恶意输入进行处理。</li>
<li>应用软件应包含输出的安全性设计。</li>
</ol>
<h3 id="2-2-3-安全审计功能"><a href="#2-2-3-安全审计功能" class="headerlink" title="2.2.3.安全审计功能"></a>2.2.3.安全审计功能</h3><ol>
<li>应用系统具备如下安全审计功能：</li>
</ol>
<ul>
<li>审计功能的启动和关闭；</li>
<li>变更审计功能的配置信息；</li>
<li>至少应进行审计的事件：进入和退出的时间(登录、退出系统)、异常的系统使用行为(失败登录)、系统维护行为、敏感行为和其它安全功能要求的审计内容；</li>
<li>每个审计记录中至少记录如下信息：事件的日期和时间、事件的类型、主题标识、事件的结果(成功、失败)和事件相关信息。</li>
</ul>
<ol start="2">
<li>应用系统应支持数据查阅审计功能：按照主题、事件查阅；应用系统应明确用户能够查阅审计数据用户。</li>
<li>在意外情况出现时，应有措施保证审计数据的可用性，当审计记录溢出时采取保护行动。</li>
</ol>
<h3 id="2-2-4-容错功能设计"><a href="#2-2-4-容错功能设计" class="headerlink" title="2.2.4.容错功能设计"></a>2.2.4.容错功能设计</h3><ol>
<li>应用软件应包含各模块的出错处理设计。</li>
<li>应用软件应包含可能出现的各种异常情况的安全处理设计,如关闭debug错误信息不回显给用户。</li>
<li>应用软件应包含抗网络攻击的能力的设计及系统脆弱性分析。</li>
<li>对于应用软件本身的资源及服务的优先保障设计。</li>
</ol>
<h2 id="2-3-应用系统存储安全设计要求"><a href="#2-3-应用系统存储安全设计要求" class="headerlink" title="2.3.应用系统存储安全设计要求"></a>2.3.应用系统存储安全设计要求</h2><p>在应用系统存储安全设计时，应对系统的存储容量、存储介质、存储备份内容、存储备份方式、存储设备功能要求及相关的存储技术统筹进行考虑。</p>
<h3 id="2-3-1-应用系统的存储容量设计"><a href="#2-3-1-应用系统的存储容量设计" class="headerlink" title="2.3.1.应用系统的存储容量设计"></a>2.3.1.应用系统的存储容量设计</h3><p>应依据对于应用数据的测算，估算应用系统的存储容量，建议在存储容量估算时应考虑以下要求：</p>
<ul>
<li>在实际估算值上预留20%的存储余量，并考虑未来的应用存储量的增长需求。</li>
<li>考虑到应用系统自身的审计数据的容量、保存期限以配置相应的存储设备。</li>
<li>对于应用系统中的临时数据和过渡数据，应当设计其保存的时间，并以此考虑这部分的存储容量要求。</li>
</ul>
<h3 id="2-3-2-应用系统的存储介质选择"><a href="#2-3-2-应用系统的存储介质选择" class="headerlink" title="2.3.2.应用系统的存储介质选择"></a>2.3.2.应用系统的存储介质选择</h3><p>应用系统的存储介质主要包括但不限于：磁带、纸带、闪存、软盘、光<br>盘、磁盘和磁盘阵列。具体存储介质的选择应依据应用系统的业务种类及存储周期的要求，采用不同的介质。</p>
<ol>
<li>对于应用系统的交易数据，应采用高性能、高可靠的存储介质，如磁盘、磁盘阵列等进行存储；</li>
<li>对于应用系统的历史数据，应采用可靠、稳定的存储介质，如磁带、光盘等进行存储。</li>
</ol>
<h3 id="2-3-3-应用系统存储备份对象"><a href="#2-3-3-应用系统存储备份对象" class="headerlink" title="2.3.3.应用系统存储备份对象"></a>2.3.3.应用系统存储备份对象</h3><p>应用系统对于其储存备份的对象设计，应包括如下内容：</p>
<ol>
<li>系统数据的备份：应包括Web服务器的网站内容、Mail服务器的邮件实时备份、数据库、文件服务器中的文件以及其他数据；</li>
<li>系统的完全备份：应包括关键的、需要快速恢复的设备，通过磁带机的完全备份，应实现快速的灾难恢复；</li>
<li>系统的冗余主机备份：对于关键并且不能停止的服务设备（如计费服务、Web、Mail服务器），应考虑使用多台主机进行冗余备份，以保证当任何一台主机发生故障时，服务器仍可提供服务；</li>
<li>系统配置的备份：应包括关键路由器的配置、防火墙的配置、各类服务器操作系统的安全配置以及各类服务器（如Web、Mail、文件服务器等）中服务器软件（如Apache、tomcat等）的配置。</li>
</ol>
<h3 id="2-3-4-应用系统存储备份方式"><a href="#2-3-4-应用系统存储备份方式" class="headerlink" title="2.3.4.应用系统存储备份方式"></a>2.3.4.应用系统存储备份方式</h3><p>应用系统应当根据不同的阶段，系统数据不同的重要程度，对数据采取不同的备份方式：</p>
<ol>
<li>完全备份<br><br>使用备份介质对整个系统进行完全备份，包括系统和数据。这种备份方<br>式的优点是直观，容易被人理解，而且当数据丢失时，可以快速恢复丢失的数据。它也有不足之处，即：</li>
</ol>
<ul>
<li>定期对系统进行完全备份，因此在备份数据中有大量的重复信息，占用了大量的存贮空间，增加了备份成本；</li>
<li>需要备份的数据量大，因此备份所需要的时间较长。<br><br>建议在关键性应用系统的实施前、实施后、变更以及升级等重要操作时，<br>对操作系统进行完全备份。针对信息较小的不断变化的，且变化的内容大于<br>50％的，定期进行完全备份。</li>
</ul>
<ol start="2">
<li>增量备份<br><br>每次备份的数据只是相当于上一次备份后增加和修改过的数据。没有重<br>复的备份数据，节省备份介质的空间，缩短了备份时间。这种备份的优点很明显，同时也存在某些不足之处，即当发生灾难时，恢复数据比较麻烦。<br><br>建议在关键性应用系统正常运行维护阶段，针对变化的、不断增加的信息，定期进行增量备份。</li>
<li>差异备份<br><br>每次备份的数据只是相当于上一次完全备份后新增加和修改过的数据，<br>即采用完全备份和差异备份相结合备份策略。如每周日进行一次完全备份，<br>而周一至周六进行差异备份。<br><br>其优点为：没有重复的备份数据，即节省备份介质的空间，缩短了备份时间；缺点为：当发生灾难时，恢复数据比较麻烦。<br><br>建议应用系统的正常运行维护阶段，针对不断变化的（变化的内容小于<br>50％）系统，定期进行差异备份。</li>
<li>按需备份<br><br>按需备份是指在正常的备份安排之外，额外进行的备份操作，这种备份<br>方式可以弥补冗余管理以及长期转存的日常备份的不足。因此它是一种非常<br>灵活、重要的备份方式，在应用系统的各个阶段，如果备份的内容较少，可以采用按需备份。<br><br>建议应用系统在下列情况下采取按需备份：</li>
</ol>
<ul>
<li>只需要备份很少的几个文件、目录、数据库或数据库中的表；</li>
<li>备份服务器上必要的配置文件。</li>
</ul>
<ol start="5">
<li>排除备份<br><br>排除备份是指排除不需要的文件后再进行备份。从本质上讲，排除备份不是一种备份方法，只是减少备份冗余的一种方法。<br><br>建议应用系统在下列情况下考虑排除备份：</li>
</ol>
<ul>
<li>有些文件非常大，但并不重要；</li>
<li>某些文件总是导致备份异常或出错。</li>
</ul>
<ol start="6">
<li>备份恢复测试<br><br>不管是全备、增备、差异、按需还是排除备份，都应该定期对已被分的数据进行恢复测试，保证备份数据的可用性，在关键时刻可以及时并快速的恢复系统。</li>
</ol>
<h3 id="2-3-5-应用系统的存储设备功能要求"><a href="#2-3-5-应用系统的存储设备功能要求" class="headerlink" title="2.3.5.应用系统的存储设备功能要求"></a>2.3.5.应用系统的存储设备功能要求</h3><p>应用系统存储设备的功能要求应包括如下内容：</p>
<ol>
<li>存储设备应保证数据的高可用性和完整性要求；</li>
<li>存储设备应具有在多主机环境下工作的能力；</li>
<li>存储设备应能方便地做到快速备份和恢复，重要系统应做到双机备份、支持热插拔；</li>
<li>存储设备应有简便的、功能强大的管理工具，做到对整个存储系统的监视与控制。</li>
</ol>
<h2 id="2-4-应用系统通讯安全设计要求"><a href="#2-4-应用系统通讯安全设计要求" class="headerlink" title="2.4.应用系统通讯安全设计要求"></a>2.4.应用系统通讯安全设计要求</h2><ol>
<li>应采用安全通信协议对重要数据进行安全传输（尤其是账号、口令信息），如使用SSL/TLS、HTTPS、SFTP和IPSec等安全协议进行通信：</li>
</ol>
<ul>
<li>终端与服务器端之间的WWW服务，建议使用HTTPS安全通信协议；</li>
<li>终端与服务器端之间的FTP服务，建议使SFTP安全通信协议；</li>
<li>终端与服务器端之间的Telnet服务，建议使SSH安全通信协议。</li>
</ul>
<ol start="2">
<li>终端应用程序采用加密传输机制对重要信息进行传输。</li>
<li>终端应用程序采用完整性检查对业务的重要数据或敏感数据进行检查。</li>
<li>终端应用程序应采用抗抵赖攻击技术对重要的交互信息进行保护。</li>
<li>终端应用程序使用固定的通信端口。</li>
<li>对于需要映射到公网的端口，不要使用原端口，在条件允许的情况下使用白名单访问。</li>
</ol>
<h2 id="2-5-应用系统数据库安全设计要求"><a href="#2-5-应用系统数据库安全设计要求" class="headerlink" title="2.5.应用系统数据库安全设计要求"></a>2.5.应用系统数据库安全设计要求</h2><ol>
<li>应从以下方面进行数据库的选型：</li>
</ol>
<ul>
<li>数据库、应用系统的运行环境；</li>
<li>数据库的稳定性、安全性（多级安全）；</li>
<li>数据库的容量（最多支持的库的数目、表的数目、记录数目）；</li>
<li>数据库的存取速度；</li>
<li>是否支持多种备份方式；</li>
<li>是否支持数据库的导入和导出。</li>
</ul>
<ol start="2">
<li>应明确数据库相关的用户管理、资源管理、特权管理和角色管理，明确各种用户的资源权限，并建立规范的权限文档。</li>
<li>数据库原则上应及时更新重要补丁。在安装补丁前应先在测试环境进行，提前进行数据备份，充分准备回退方案和应急预案。</li>
<li>数据库的配置应符合相应的基线配置要求。</li>
<li>应及时修改数据库的默认密码或将默认账号锁定、删除。</li>
<li>数据库的账号应根据业务和维护需要进行合理分配，避免账号共用。</li>
<li>数据库每个用户之间的权限需要隔离。</li>
<li>需要对数据库操作进行审计，包含：账号、操作、时间等指标。</li>
</ol>
<h2 id="2-6-应用系统数据安全设计要求"><a href="#2-6-应用系统数据安全设计要求" class="headerlink" title="2.6.应用系统数据安全设计要求"></a>2.6.应用系统数据安全设计要求</h2><h3 id="2-6-1-数据采集安全"><a href="#2-6-1-数据采集安全" class="headerlink" title="2.6.1.数据采集安全"></a>2.6.1.数据采集安全</h3><p>应根据数据采集的内容、采集的频率、数据精确度要求、时间特性等来进行数据采集的安全要求设计，数据采集服务器和采集主机应考虑30%的系统开销及冗余。</p>
<h3 id="2-6-2-数据传输安全"><a href="#2-6-2-数据传输安全" class="headerlink" title="2.6.2.数据传输安全"></a>2.6.2.数据传输安全</h3><ol>
<li>应按照数据的类型、数据的重要程度、网络的安全状况等综合因素，对<br>数据的传输采取不同的安全保护，包括但不限于防火墙、IDS、VPN、病毒防护等安全措施。</li>
<li>应了解数据传输存在安全隐患的网络或设备，对存在安全隐患的网络采取必要的安全技术，包括但不限于安全通信协议、加密算法、完整性检查算法以及抗抵赖攻击方法等。</li>
<li>应制定数据传输安全的检查方式，包括但不限于数据传输安全抗主动攻击能力检查、被动抗攻击的能力检查。</li>
<li>应保障“数据传输安全”有关的重要配置参数安全，包括但不限于口令、加/解密算法、加/解密密钥等。</li>
<li>应采用安全通信协议对数据进行安全传输，如使用SSL/TLS、HTTPS、<br>SFTP和IPSec等安全协议进行通信。</li>
<li>对传输的信息进行不同等级的加密保护，即根据网络或设备的风险、传输内容安全要求的不同，选择不同安全强度的加密算法对信息进行加密传输。建议使用RSA等高强度的密码算法对非常重要的信息（如口令、加密密钥）进行加密传输；对于普通数据的传输，可以采用DES、3DES等加密算法进行加密传输。</li>
<li>应防止对所传输数据进行未经授权的任何形式的修改，即对业务的重要数据或敏感数据，建议使用MD5、SHA等算法对数据完整性进行保护。</li>
<li>对重要的交互信息，建议采取抗抵赖技术，包括但不限于数字签名技术。</li>
<li>为了配合网络其它安全设备，建议采用基于用户名/口令的认证技术、<br>VLAN技术、MPLS技术等安全技术手段。</li>
</ol>
<h3 id="2-6-3-数据处理安全"><a href="#2-6-3-数据处理安全" class="headerlink" title="2.6.3.数据处理安全"></a>2.6.3.数据处理安全</h3><ol>
<li>应根据数据的类型、数据的处理方式、数据的安全性要求、与其它接口<br>有关的敏感等级、数据相关业务应用的重要性程度来进行数据处理过程的安全性设计。</li>
<li>应对原始数据进行检错和校验操作，保证原始数据的正确性和完整性。</li>
<li>数据在转换过程中，应采用通用的标准格式，应考虑相关的不同系统和不同应用的格式需求。</li>
<li>数据处理过程应提供处理数据的状态信息和数据处理过程的动态信息。</li>
<li>数据处理过程应具备异常处理功能，在任一环节发现问题，均应能及时回退，必要时可以人工处理。</li>
<li>数据处理的中间过程和中间结果不能暴露给第三方。</li>
</ol>
<hr>
<h1 id="3-应用系统编码安全"><a href="#3-应用系统编码安全" class="headerlink" title="3.应用系统编码安全"></a>3.应用系统编码安全</h1><h2 id="3-1-基本代码安全要求"><a href="#3-1-基本代码安全要求" class="headerlink" title="3.1.基本代码安全要求"></a>3.1.基本代码安全要求</h2><h3 id="3-1-1-输入验证"><a href="#3-1-1-输入验证" class="headerlink" title="3.1.1.输入验证"></a>3.1.1.输入验证</h3><p>对函数入口参数的合法性和准确性进行检查，具体如下：<br></p>
<ul>
<li>在B/S环境下，应进行服务端的验证而不仅仅是客户端的验证（例如基于Javascript的验证）。通过在客户端和服务器之间放置一个代理服务器，可以很容易绕过客户端验证。有了代理服务器，攻击者可以在数据被客户端“验证”后修改数据（与“man-in-the-middle”攻击类似）。</li>
<li>在实际的校验中，输入校验首先定义一个有效（可接受）的字符集，然后检<br>查每个数据的字符是否在有效范围内。如果输入中包含无效的字符，应用程序应<br>该返回错误页面并说明输入中包含无效字符。这样进行验证的原因是定义无效的字符集比较困难，并且一些不应该有效的字符通常不会被指出。</li>
<li>另外，边界检查（例如字符串的最大长度）应该在字符有效性检查以前进行，边界分析可以防止大多数缓冲区溢出漏洞。</li>
<li>从环境变量获得的数据也需要进行验证，同时避免在环境变量中存放敏感数据（例如密码）。</li>
</ul>
<h3 id="3-1-2-SQL语句"><a href="#3-1-2-SQL语句" class="headerlink" title="3.1.2.SQL语句"></a>3.1.2.SQL语句</h3><p>如果应用程序需要连接后端数据库，使用存储过程而不能在代码中使用SQL<br>语句，使用程序以外的嵌入在代码中的SQL语句调用特别危险，难以防止攻击<br>者使用输入域或者配置文件（由应用程序载入）来执行嵌入式的SQL攻击。当然，输入验证有助于缓解这种风险。</p>
<h3 id="3-1-3-注释代码"><a href="#3-1-3-注释代码" class="headerlink" title="3.1.3.注释代码"></a>3.1.3.注释代码</h3><p>当应用程序在实际环境中开始应用时，应该删除所有的注释代码。<br><br>注释代码是用来调试或者测试的，它们不是最终应用程序的一部分。无论如何应该在实际的环境中删除它们以避免意外的执行（一般注释标识被删除后就无法激活休眠的代码，但还是存在可能性的，所以强烈建议执行这项工作）。</p>
<h3 id="3-1-4-错误消息"><a href="#3-1-4-错误消息" class="headerlink" title="3.1.4.错误消息"></a>3.1.4.错误消息</h3><p>所有为用户显示的错误信息都不应该暴露任何关于系统、网络或应用程序的<br>敏感信息。如果可能，应使用包含编号的一般的错误信息，这种信息只有开发者和/或支持小组才能理解，如“发生了错误（代码1234），请您与系统维护部门联系。</p>
<h3 id="3-1-5-URL内容"><a href="#3-1-5-URL内容" class="headerlink" title="3.1.5.URL内容"></a>3.1.5.URL内容</h3><p>对于Web应用，不能在URL上暴露任何重要信息，例如密码、服务器名称、<br>IP地址或者文件系统路径（暴露了Web服务器的目录结构），这些信息可以在攻击时被使用。</p>
<h3 id="3-1-6-设置PATH变量"><a href="#3-1-6-设置PATH变量" class="headerlink" title="3.1.6.设置PATH变量"></a>3.1.6.设置PATH变量</h3><p>设置PATH为一个已知的值，而不是仅仅使用启动时的缺省值。攻击者可<br>以在攻击应用程序时使用PATH变量，例如试图执行一个任意的程序，这些可<br>以应用于大多数其他的语言。</p>
<h3 id="3-1-7-其他要求"><a href="#3-1-7-其他要求" class="headerlink" title="3.1.7.其他要求"></a>3.1.7.其他要求</h3><ol>
<li>禁止使用未经授权和验证的代码。</li>
<li>使用第三方代码，应对代码安全性进行评估和测试。</li>
<li>测试用的“后门”，应在发布版中去除。</li>
<li>规范代码的格式。</li>
</ol>
<ul>
<li>规范变量、函数的命名；</li>
<li>规范程序的书写格式，确保程序的易读性。</li>
</ul>
<ol start="5">
<li>对代码进行版本控制，确保代码的可用性。</li>
<li>防止程序员非授权修改代码</li>
</ol>
<ul>
<li>对代码的访问权限进行严格的权限控制；</li>
<li>禁止在程序中添加隐藏“恶意”的代码，防止与应用系统相关的程序员对系统的非授权修改。</li>
</ul>
<ol start="7">
<li>应用系统不应在程序或进程中固化账号和口令。</li>
<li>系统应具备对口令猜测的防范机制和监控手段。</li>
<li>避免应用程序以错误的顺序运行，或者防止出现故障时，后续程序以不正常的流程运行。</li>
<li>采用正确的故障恢复程序，确保正确处理数据。</li>
<li>采取会话控制或批次控制，确保更新前后数据文件的一致性，例如：检查操作前后文件打开和关闭的数目是否一致。</li>
<li>检查执行操作前后对象的差额是否正常，如：句柄处理，堆栈等系统资源的占用与释放等。</li>
<li>严格验证系统生成的数据。</li>
<li>在网络传输过程中检查下载/上传的数据或软件的完整性。</li>
<li>检查文件与记录是否被篡改。例如通过计算哈希值（HASH）进行对比。</li>
<li>禁止私自将代码上传到互联网，如github等</li>
</ol>
<h2 id="3-2-Web编程安全基本要求"><a href="#3-2-Web编程安全基本要求" class="headerlink" title="3.2.Web编程安全基本要求"></a>3.2.Web编程安全基本要求</h2><h3 id="3-2-1-输入检查安全"><a href="#3-2-1-输入检查安全" class="headerlink" title="3.2.1.输入检查安全"></a>3.2.1.输入检查安全</h3><ol>
<li>限制用户输入HTML和Script(JavaScript、VBScript)代码。即，输入恶意HTML或Script（JavaScript、VBScript）代码可能会对其他浏览者造<br>成混淆、欺骗或恶意破坏的结果。</li>
<li>检查用户输入数据的长度。即输入超出限定长度的数据，可能造成服务器端程序溢出。</li>
<li>防止用户输入特殊字符改变SQL语义。即，输入含特殊字符的字串，篡改SQL语句的语义，可能造成SQL查询执行不该执行的操作，以此绕过身份认证获取非法权限、甚至对数据进行破坏。</li>
<li>限制用户能够访问的最顶层目录。即，编写对服务器端文件、目录操作的程序时应该注意限定此类程序能够访问的最顶层目录，防止用户构造输入字串借助程序功能访问服务器关键文件导致泄漏服务器敏感信息。</li>
<li>对所有类型的用户输入都要做检查，并严格限定什么是合法的用户输入，限定一个合法输入的范围，同时过滤有可能造成危险的特殊字符。</li>
<li>对不可信任域发送到可信任域的数据一定要进行检查。</li>
<li>尽可能在服务器端完成用户输入检查，不能轻易相信客户端脚本的检查结果。即，虽然客户端的Script脚本能完成一部分的用户输入检查功能，<br>但这种检查的结果是不可信任的，攻击者可以自己制作表单程序绕过客户端脚本验证，将非法数据提交到服务器。</li>
<li>在输入变为输出时，也要对特殊字符做检查和转换。</li>
</ol>
<h3 id="3-2-2-敏感数据的存放和传递安全"><a href="#3-2-2-敏感数据的存放和传递安全" class="headerlink" title="3.2.2.敏感数据的存放和传递安全"></a>3.2.2.敏感数据的存放和传递安全</h3><ol>
<li>敏感数据不能存放在Web页中。</li>
<li>不能把敏感的数据存储在cookie、隐藏字段或者潜在地可能会被用户修改的地方。</li>
<li>客户端向服务器端提交敏感数据应该经过加密（例如使用SSL），尽量不能明文传输。</li>
<li>密码等敏感信息存放在数据库中应该加密，并采用健壮的加密算法。</li>
<li>防止数据库被攻破后泄漏用户密码。</li>
<li>敏感数据需要脱敏显示</li>
</ol>
<h3 id="3-2-3-缓冲区溢出安全"><a href="#3-2-3-缓冲区溢出安全" class="headerlink" title="3.2.3.缓冲区溢出安全"></a>3.2.3.缓冲区溢出安全</h3><ol>
<li>所有的输入都必须进行正确的有效性检测。</li>
<li>必须保证数组没有越界，增加数组操作函数的边界检查。</li>
<li>安全地使用字符串处理函数，慎用有安全隐患的字符串处理函数</li>
<li>使用Format字符串的时候特别注意Unicode和ANSI的大小不一致的情<br>况。</li>
<li>注意字符串结束符的保护。</li>
<li>仔细研究库函数内部的缓冲区分配，明确其限制。不能使用realpath()<br>等函数，如果功能需要必须使用时，一定要检查试图规范化的路径的长度，确保其不长于MAXPATHLEN。</li>
<li>时刻进行边界检查。建议使用一些检查工具：Purify、Stackguard等检查代码，保证没有缓冲区溢出的问题。</li>
</ol>
<h3 id="3-2-4-格式化字符串安全"><a href="#3-2-4-格式化字符串安全" class="headerlink" title="3.2.4.格式化字符串安全"></a>3.2.4.格式化字符串安全</h3><ol>
<li>使用固定的格式化字符串，或者来自可信源的格式化字符串。</li>
<li>要检查并限定locale的请求为合法值。</li>
<li>不能将用户输入直接作为格式化字符传给格式化函数。</li>
</ol>
<h3 id="3-2-5-整数溢出安全"><a href="#3-2-5-整数溢出安全" class="headerlink" title="3.2.5.整数溢出安全"></a>3.2.5.整数溢出安全</h3><ol>
<li>对于涉及到内存分配大小的计算，要进行仔细检查，确保计算不会产生溢出。</li>
<li>对于涉及到数组索引的计算，要进行仔细检查，确保计算不会产生溢出。</li>
<li>要使用无符号整数表示数组偏移和内存分配大小。</li>
</ol>
<h3 id="3-2-6-SQL注入代码安全"><a href="#3-2-6-SQL注入代码安全" class="headerlink" title="3.2.6.SQL注入代码安全"></a>3.2.6.SQL注入代码安全</h3><ol>
<li>要检查输入的有效性和可信度。</li>
<li>要使用参数化的查询、占位符、或者参数绑定来构造SQL语句。</li>
<li>要在程序之外存储数据库的连接信息，比如经过保护的配置文件或者<br>Windows注册表。</li>
<li>即使使用的是存储过程，也不能使用字符串连接来构造SQL语句。</li>
<li>不能在存储过程内部使用字符串连接来构造SQL语句。</li>
<li>不能在存储过程内部执行不可信的参数。</li>
<li>不能简单地双写单引号或者双引号。</li>
<li>不能使用高权限账号连接数据库，比如sa或者root。</li>
<li>不能在程序或者连接字符串中存储登录口令。</li>
<li>不能在Web根目录下存储数据库配置信息。</li>
<li>应从数据库中删除对所有用户自定义表的访问权限，同时只对存储过程授权，然后使用存储过程以及参数化的查询来构造查询字符串。</li>
</ol>
<h3 id="3-2-7-命令注入代码安全"><a href="#3-2-7-命令注入代码安全" class="headerlink" title="3.2.7.命令注入代码安全"></a>3.2.7.命令注入代码安全</h3><ol>
<li>在输入命令传递给命令处理程序之前要进行验证。</li>
<li>如果输入验证失败，要安全地处理失败信息。</li>
<li>不能向任何命令解释器传递未验证的输入信息，即使这些输入仅仅是数据信息。</li>
<li>避免使用正则表达式来进行输入验证，应手工去写一些简单而又清晰的验证代码。</li>
</ol>
<h3 id="3-2-8-异常处理代码安全"><a href="#3-2-8-异常处理代码安全" class="headerlink" title="3.2.8.异常处理代码安全"></a>3.2.8.异常处理代码安全</h3><ol>
<li>要检测每个安全相关函数的返回值。</li>
<li>对于每一个更改用户设定或者及其设定的函数，都要检查其返回值。</li>
<li>要有从错误条件中进行恢复的考虑，避免拒绝服务攻击。</li>
<li>不能一次性处理所有的异常，要将异常情况进行分类处理，避免在异常处理代码中的漏洞发生。</li>
</ol>
<h3 id="3-2-9-跨站脚本代码安全"><a href="#3-2-9-跨站脚本代码安全" class="headerlink" title="3.2.9.跨站脚本代码安全"></a>3.2.9.跨站脚本代码安全</h3><ol>
<li>要对所有基于Web的输入进行输入验证和可信度验证。</li>
<li>在没有验证合法性之前，不能对基于Web的输入进行回显。</li>
<li>不能在cookie中存储敏感数据。</li>
</ol>
<h3 id="3-2-10-保护网络流量的代码安全"><a href="#3-2-10-保护网络流量的代码安全" class="headerlink" title="3.2.10.保护网络流量的代码安全"></a>3.2.10.保护网络流量的代码安全</h3><ol>
<li>要使用强大的初始认证机制。</li>
<li>对应用程序所产生的所有网络流量都要执行过程中消息认证。</li>
<li>尽可能使用SSL/TLS进行网络加密传输。</li>
</ol>
<h3 id="3-2-11-应用中的弱口令代码安全"><a href="#3-2-11-应用中的弱口令代码安全" class="headerlink" title="3.2.11.应用中的弱口令代码安全"></a>3.2.11.应用中的弱口令代码安全</h3><ol>
<li>确保口令在网络上认证时不被窃听。</li>
<li>要在登录失败时给出错误提示，并记录失败口令尝试。</li>
<li>尽可能使用基于hash强壮的单向加密函数进行口令存储。</li>
<li>为用户更改口令提供安全的机制。</li>
<li>不得使用默认账号和默认口令，若使用，必须在首次登录后进行修改。</li>
<li>不得在程序、后台存储明文的口令。</li>
<li>口令要有一定的强度，应当满足系统的账号口令策略要求。</li>
</ol>
<h2 id="3-3-SOCKET网络编程安全基本要求"><a href="#3-3-SOCKET网络编程安全基本要求" class="headerlink" title="3.3 SOCKET网络编程安全基本要求"></a>3.3 SOCKET网络编程安全基本要求</h2><ol>
<li>在socket函数调用时，明确参数中绑定的端口、IP地址和网卡接口。Windows环境下，在遇到多个网卡的情况时，需要通过注册表来获得网卡接口和IP地址的信息，包括WindowsNT和windows2000。</li>
<li>判断连接的合法身份。即，为防止恶意的连接以及可能是无效的连接，建议在socket连接期间，判断连接的对端是否是合法的真正的连接。</li>
<li>对于UDP连接，可以获得连接对方的IP地址和端口，从而可以判断对方的有效性和合法性；对于TCP连接，由于每次连接需要三次握手，而且还有超时机制，存在两种方式来控制。</li>
<li>对于TCP连接，需要尽量在三次握手完成前完成判断，同时防止端口扫描的攻击。</li>
<li>尽可能确保socket应用能通过合理设置的防火墙。</li>
<li>在可能的情况下，尽量减少socket连接数目。</li>
<li>尽量不能使用回拨的技术。</li>
<li>尽量采用有连接状态的协议，例如TCP协议。由于防火墙一般采取禁止一切的策略，对于UDP协议比较难以设置。</li>
<li>在一个应用程序中，尽量使用同一种协议，不能使用多种协议。</li>
<li>尽量将客户端和服务器端的端口做成可以配置，不能硬编码在程序中。</li>
</ol>
<h2 id="3-4-JAVA安全开发要求"><a href="#3-4-JAVA安全开发要求" class="headerlink" title="3.4.JAVA安全开发要求"></a>3.4.JAVA安全开发要求</h2><p>JAVA语言安全规范参考<code>OWASPTOP10</code>要求，本指南列举了常见的<br>JAVA开发安全要求。</p>
<h3 id="3-4-1-防范跨站脚本（XSS）"><a href="#3-4-1-防范跨站脚本（XSS）" class="headerlink" title="3.4.1.防范跨站脚本（XSS）"></a>3.4.1.防范跨站脚本（XSS）</h3><p>跨站脚本是最普遍的Web应用安全漏洞。当应用程序在发送给浏览器<br>的页面中包含用户提供的数据，但没有经过适当验证或转义，就容易导致跨站脚本漏洞。<br><br>攻击者能在受害者浏览器中执行脚本以劫持用户会话、危害网站、插入恶意内容和重定向用户等。<br><br>已知三种著名跨站漏洞是：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br></pre></td><td class="code"><pre><span class="line">反射式跨站脚本通过测试或代码分析很容易找到。&lt;br&gt;</span><br><span class="line">防范措施：</span><br><span class="line">1. 验证输入&lt;br&gt;</span><br><span class="line">检查每个输入的有效性，主要检查输入类型和数据的长度。</span><br><span class="line">2. 编码输出&lt;br&gt;</span><br><span class="line">对验证输入的另一面就是编码输出。编码输出是指确保字符被视为数</span><br><span class="line">据，而不是作为HTML元字符被浏览器解析。这些技术定义一些特殊的“转</span><br><span class="line">义”字符，没有正确转义的数据它仍然会在浏览器中正确解析。编码输出</span><br><span class="line">只是让浏览器知道数据是不是要被解析，达到攻击无法实现的目的。**需要编码的部分：HTML实体、HTML属性、JavaScript、CSS、URL**。</span><br><span class="line"></span><br><span class="line">### 3.4.2.防范SQL注入</span><br><span class="line">简单来说，注入往往是应用程序缺少对输入进行安全性检查所引起的，</span><br><span class="line">攻击者把一些包含指令的数据发送给解释器，解释器把收到的数据转换成指</span><br><span class="line">令执行。注入漏洞十分普遍，通常能在SQL查询、LDAP查询、Xpath查询、</span><br><span class="line">OS命令、程序参数等中出现。&lt;br&gt;</span><br><span class="line">注入能导致数据丢失或数据破坏、缺乏可审计性或是拒绝服务，注入漏洞有时甚至能导致完全接管主机。&lt;br&gt;</span><br><span class="line">注入包含了SQL注入、XPATH注入、LDAP注入、OS命令注入等。</span><br><span class="line"></span><br><span class="line">### 3.4.3.防范恶意文件执行</span><br><span class="line">恶意文件执行是一种能够威胁任何网站形式的漏洞，只要攻击者在具有</span><br><span class="line">引入（include）功能程式的参数中修改参数内容，Web服务器便会引入恶意程序从而受到恶意文件执行漏洞攻击。&lt;br&gt;</span><br><span class="line">攻击者可利用恶意文件执行漏洞进行攻击取得Web服务器控制权，进</span><br><span class="line">行不法利益或获取经济利益。</span><br><span class="line"></span><br><span class="line">### 3.4.4.不安全的直接对象引用</span><br><span class="line">所谓“不安全的对象直接引用”，即Insecuredirectobjectreferences，意</span><br><span class="line">指一个已经授权的用户，通过更改访问时的一个参数，从而访问到原本其</span><br><span class="line">并没有得到授权的对象。Web应用往往在生成Web页面时会用它的真实名</span><br><span class="line">字，且并不会对所有的目标对象访问时检查用户权限，所以这就造成了不安全的对象直接引用的漏洞。&lt;br&gt;</span><br><span class="line">以下是不安全的对象直接引用示例：</span><br><span class="line">- 攻击者发现他自己的参数是6065，即?acct=6065；</span><br><span class="line">- 他可以直接更改参数为6066，即?acct=6066；</span><br><span class="line">- 这样他就可以直接看到6066用户的账户信息了。&lt;br&gt;</span><br><span class="line">这种漏洞能损害参数所引用的所有数据。除非名字空间很稀疏，否则攻击者很容易访问该类型的所有数据。</span><br><span class="line"></span><br><span class="line">### 3.4.5.防范跨站请求伪造</span><br><span class="line">跨站请求伪造，也被称成为“oneclickattack”或者sessionriding，通常</span><br><span class="line">缩写为CSRF或者XSRF，是一种对网站的恶意利用。它与XSS非常不同，</span><br><span class="line">并且攻击方式几乎相左。XSS利用站点内的信任用户，而CSRF则通过伪装</span><br><span class="line">来自受信任用户的请求来利用受信任的网站。与XSS攻击相比，CSRF攻击</span><br><span class="line">往往不太流行（因此对其进行防范的资源也相当稀少）和难以防范，所以被认为比XSS更具危险性。&lt;br&gt;</span><br><span class="line">攻击者能让受害用户修改可以修改的任何数据，或者是执行允许使用的任何功能。</span><br><span class="line"></span><br><span class="line">### 3.4.6.信息泄露和错误处理不当</span><br><span class="line">应用程序常常产生错误信息并显示给使用者。很多时候，这些错误信息非常有用，因为它们揭示实施细则或有用的开发信息。- 泄露太多的细节（如错误堆栈跟踪信息、SQL语句等等）；</span><br><span class="line">- 登录失败后，通知用户是否用户ID或密码出错——登录失败可能是由于</span><br><span class="line">ID或密码错误造成的。这为一个对关键资产发动蛮力攻击的攻击者提供重要信息。</span><br><span class="line"></span><br><span class="line">### 3.4.7.残缺的认证和会话管理</span><br><span class="line">与认证和会话管理相关的应用程序功能往往得不到正确实施，这就导致攻击者破坏密码、密钥、会话令牌或利用实施漏洞冒充其他用户身份。&lt;br&gt;</span><br><span class="line">这些漏洞可能导致部分甚至全部账号遭受攻击。一旦攻击成功，攻击者能执行合法用户的任何操作，因此特权账号会造成更大的破坏。&lt;br&gt;</span><br><span class="line">编程要求：</span><br><span class="line">- 使用内置的会话管理功能；</span><br><span class="line">- 通过认证的问候；</span><br><span class="line">- 使用单一的入口点；</span><br><span class="line">- 确保在一开始登录SSL保护的网页；</span><br><span class="line">- 获取注销的权利；</span><br><span class="line">- 添加超时；</span><br><span class="line">- 确保你使用的是安全相关的功能；</span><br><span class="line">- 使用强大的认证；</span><br><span class="line">- 不进行默认身份验证。</span><br><span class="line"></span><br><span class="line">### 3.4.8.不安全的加密存储</span><br><span class="line">保护敏感数据已经成为网络应用的最重要的组成部分，加密的敏感数据</span><br><span class="line">已是非常常见安全保护手段。不加密的应用程序、设计不当或者使用不恰当的密码技术等可能导致披露敏感数据。</span><br><span class="line">- 	攻击者能够取得或是篡改机密的或是私有的信息；</span><br><span class="line">- 	攻击者通过机密秘密的窃取从而进行进一步的攻击；</span><br><span class="line">- 	造成企业形象破损，用户满意度下降，甚至面临法律诉讼等。</span><br><span class="line"></span><br><span class="line">编程要求：</span><br><span class="line">- 	验证你的结构；</span><br><span class="line">- 	识别所有的敏感数据；</span><br><span class="line">- 	识别敏感数据存放的所有位置；</span><br><span class="line">- 	确保所应用的威胁模型能够应付这些攻击；</span><br><span class="line">- 	使用加密手段来应对威胁；</span><br><span class="line">- 	使用一定的机制来进行保护</span><br><span class="line">- 	文件加密；</span><br><span class="line">- 	数据库加密；</span><br><span class="line">- 	数据元素加密；</span><br><span class="line">- 	正确的使用这些机制；</span><br><span class="line">- 	使用标准的强算法；</span><br><span class="line">- 	合理的生成，分发和保护密钥；</span><br><span class="line">- 	准备密钥的变更；</span><br><span class="line">- 	验证实现方法；</span><br><span class="line">- 	确保所有的证书、密钥和密码都得到了安全的存放；</span><br><span class="line">- 	有一个安全的密钥分发和应急处理的方案。</span><br><span class="line"></span><br><span class="line">### 3.4.9.不安全的通信</span><br><span class="line">对于不加密的应用程序的网络信息传输，需要保护敏感的通信。加密（通</span><br><span class="line">常SSL）必须用于所有身份验证的连接，特别是通过Internet访问的网页，</span><br><span class="line">以及后端的连接。否则，应用程序将暴露身份验证或会话令牌。</span><br><span class="line">- 	攻击者能够取得或是篡改机密的或是私有的信息；</span><br><span class="line">- 	攻击者通过这些秘密的窃取从而进行进一步的攻击；</span><br><span class="line">- 	造成企业形象破损，用户满意度下降，甚至面临法律诉讼等。</span><br><span class="line"></span><br><span class="line"> 编程要求：</span><br><span class="line">- 	提供合理的保护机制；</span><br><span class="line">- 	对于敏感数据的传输，对所有连接都要使用TLS；</span><br><span class="line">- 	在传输前对单个数据都要进行加密；（如XML-Encryption）；</span><br><span class="line">- 	在传输前对信息进行签名；（如XML-Signature）；</span><br><span class="line">- 	正确的使用这些机制；</span><br><span class="line">- 	使用标准的强算法；</span><br><span class="line">- 	合理管理密钥和证书；</span><br><span class="line">- 	在使用前验证SSL证书。</span><br><span class="line"></span><br><span class="line">### 3.4.10.限制URL访问失效</span><br><span class="line">这个漏洞事实上也是与认证相关的，与我们前面提到的不安全的直接对</span><br><span class="line">象引用也是类似的，不同在于这个漏洞是指系统已经对URL的访问做了限</span><br><span class="line">制，但这种限制却实际并没有生效。&lt;br&gt;</span><br><span class="line">常见的错误是，我们在用户认证后只显示给用户认证过的页面和菜单选项，而实际上这些仅仅是表示层的访问控制而不能真正生效，攻击者能够很容易伪造请求直接访问未被授权的页面。</span><br><span class="line"></span><br><span class="line">编程要求：</span><br><span class="line">- 	如果URL不是公开的，那么必须限制能够访问的授权用户；</span><br><span class="line">- 	加强基于用户或角色的访问控制；</span><br><span class="line">- 	完全禁止访问未被授权的页面类型（如配置文件、日志文件、源文件等）；</span><br><span class="line">- 	验证你的构架；</span><br><span class="line">- 	在每一个层次都使用简单肯定的模型；</span><br><span class="line">- 	确保每一层都有一个访问机制；</span><br><span class="line">- 	验证你的实现；</span><br><span class="line">- 	不能使用自动化的分析工具；</span><br><span class="line">- 	确保每个URL都被外部过滤器或其他机制保护；</span><br><span class="line">- 	确保服务器的配置不允许对非授权页面的访问。</span><br><span class="line"></span><br><span class="line">## 3.5.PHP安全开发要求</span><br><span class="line"></span><br><span class="line">### 3.5.1.变量滥用</span><br><span class="line">**PHP-4.1.0**发布的时候建议关闭`register_globals`，并提供了7个特殊的数</span><br><span class="line">组变量来使用各种变量。对于从GET、POST、COOKIE等来的变量并不会直接注册成变量，必需通过数组变量来存取。&lt;br&gt;</span><br><span class="line">**PHP-4.2.0**发布的时候，`php.ini`默认配置就是`register_globals=Off`。这使得程序使用PHP自身初始化的默</span><br><span class="line">认值，一般为0，避免了攻击者控制判断变量。通过以下解决方法实现：&lt;br&gt;</span><br><span class="line">配置文件`php.ini`设置`register_globals=Off`。&lt;br&gt;</span><br><span class="line">要求程序员对作为判断的变量在程序最开始初始化一个值。</span><br><span class="line"></span><br><span class="line">### 3.5.2.文件打开</span><br><span class="line">如非特殊需要，把php的文件操作限制在Web目录里面。</span><br><span class="line">以下是修改apache配置文件`httpd.conf`的一个例子：</span><br></pre></td></tr></table></figure></p>
<p>&lt;Directory/usr/local/apache/htdocs&gt;php_admin_valueopen_basedir/usr/local/apache/htdocs<br><br><figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">重启apache后，`/usr/local/apache/htdocs`目录下的PHP脚本就只能操作</span><br><span class="line">它自己目录下的文件了，否则PHP就会报错：</span><br></pre></td></tr></table></figure></p>
<p>Warning:open_basedirrestrictionineffect.Fileisinwrongdirectoryinxxxonlinexx.<br><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">使用`safe_mode`模式也能避免这种问题，前面已经讨论过。</span><br><span class="line"></span><br><span class="line">### <span class="number">3.5</span><span class="number">.3</span>.文件包含</span><br><span class="line">要求程序员包含文件里的参数尽量不能使用变量，如果使用变量，就一</span><br><span class="line">定要严格检查要包含的文件名，绝对不能由用户任意指定。如前面文件打开中限制PHP操作路径是一个必要的选项。&lt;br&gt;另外，如非特</span><br><span class="line">殊需要，一定要关闭PHP的远程文件打开功能。修改php.ini文件：`allow_url_fopen=Off`</span><br><span class="line">重启apache。</span><br><span class="line"></span><br><span class="line">### <span class="number">3.5</span><span class="number">.4</span>.文件上传</span><br><span class="line">**PHP<span class="number">-4.0</span><span class="number">.3</span>**以后提供了```is_uploaded_file```和```move_uploaded_file```函数，可以</span><br><span class="line">检查操作的文件是否是用户上传的文件，从而避免把系统文件拷贝到Web目录。&lt;br&gt;</span><br><span class="line">使用```$HTTP_POST_FILES```或```$_FILES```数组来读取用户上传的文件变量。严格检查上传变量。比如不允许是php脚本文件。</span><br><span class="line">把PHP脚本操作限制在Web目录可以避免程序员使用`copy函数`把系统</span><br><span class="line">文件拷贝到Web目录。```move_uploaded_file```不受```open_basedir```的限制，所以不必修改```php.ini```里```upload_tmp_dir```的值。</span><br><span class="line">把PHP脚本用`phpencode`进行加密，避免由于copy操作泄漏源码。严格配置文件和目录的权限，只允许上传的目录能够让nobody用户可写。&lt;br&gt;</span><br><span class="line">对于上传目录去掉PHP解释功能，可以通过修改`httpd.conf`实现：</span><br></pre></td></tr></table></figure></p>
<p>&lt;Directory/usr/local/apache/htdocs/upload&gt;php_flagengineoff</p>
<p>#如果是php3换成php3_engineoff<br><br><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">重启apache，upload目录的php文件就不能被apache解释了，即使上传了php文件也没有问题，只能直接显示源码。</span><br><span class="line"></span><br><span class="line">### <span class="number">3.5</span><span class="number">.5</span>.命令执行</span><br><span class="line">解决方法：&lt;br&gt;</span><br><span class="line">要求程序员使用```escapeshellcmd()```函数过滤用户输入的shell命令。启用`safe_mode`可以杜绝很多执行命令的问题，不过要注意PHP的版本一定要是最新的，小于**PHP<span class="number">-4.2</span><span class="number">.2</span>**的都可能绕过`safe_mode`的限制去执行命令。&lt;br&gt;</span><br><span class="line">变量类型缺陷逻辑比较时注意变量类型。&lt;br&gt;</span><br><span class="line">必要的时候使用<span class="string">"==="</span>，那么连变量类型一起比较。</span><br><span class="line"></span><br><span class="line">### <span class="number">3.5</span><span class="number">.6</span>.警告及错误信息</span><br><span class="line">修改`php.ini`中关于```Errorhandlingandlogging```部分内容：</span><br></pre></td></tr></table></figure></p>
<p>error_reporting=E_ALLdisplay_errors=Offlog_errors=Onerror_log=/usr/local/apache/logs/php_error.log<br><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">然后重启apache，注意文件```/usr/local/apache/logs/php_error.log```，必需可</span><br><span class="line">以让nobody用户可写。</span><br><span class="line"></span><br><span class="line">### <span class="number">3.5</span><span class="number">.7</span>.PHP与MySQL组合的SQL注入</span><br><span class="line">解决方法：&lt;br&gt;</span><br><span class="line">要求程序员对所有用户提交的要放到SQL语句的变量进行过滤。&lt;br&gt;</span><br><span class="line">即使是数字类型的字段，变量也要用单引号扩起来，MySQL自己会把字串处理成数字。&lt;br&gt;</span><br><span class="line">在MySQL里不能给PHP程序高级别权限的用户，只允许对自己的库进行操作。</span><br><span class="line"></span><br><span class="line">### <span class="number">3.5</span><span class="number">.8</span>.跨站脚本</span><br><span class="line">解决方法：&lt;br&gt;</span><br><span class="line">确认输入</span><br></pre></td></tr></table></figure></p>
<p>strip_tags()<br>htmlspecialchars()<br><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">清除危险的插入点。</span><br><span class="line"></span><br><span class="line">### <span class="number">3.5</span><span class="number">.9</span>.禁用无用的函数</span><br><span class="line">如果觉得有些函数还有威胁，可以设置`php.ini`里的`disable_functions`（这个选项不能在`httpd.conf`里设置），比如：```disable_functions=phpinfo,get_cfg_var</span><br></pre></td></tr></table></figure></p>
<p>可以指定多个函数，用逗号分开。<br><br>重启apache后，<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">都被禁止了。&lt;br&gt;</span><br><span class="line">建议关闭函数```phpinfo,get_cfg_var```，这两个函数容易泄漏服务器信息，而且没有实际用处。</span><br><span class="line"></span><br><span class="line">### 3.5.10.禁用某些类</span><br><span class="line">这个选项是从**PHP-4.3.2**开始才有的，它可以禁用某些类，如果有多个用逗号分隔类名。```disable_classes```也不能在`httpd.conf`里设置，只能在`php.ini`配置文件里修改。</span><br><span class="line"></span><br><span class="line">### 3.5.11.限制脚本操作路径</span><br><span class="line">前面分析例程的时候也多次提到用```open_basedir```对脚本操作路径进行限</span><br><span class="line">制，这里再介绍一下它的特性。&lt;br&gt;</span><br><span class="line">用`open_basedir`指定的限制实际上是前缀，不是目录名。也就是说&quot;```open_basedir=/dir/incl&quot;```也会允许访问```&quot;/dir/include```&quot;</span><br><span class="line">和&quot;```/dir/incls```&quot;，如果它们存在的话。&lt;br&gt;</span><br><span class="line">如果要将访问限制在仅为指定的目录，用斜线结束路径名。例如：&quot;```open_basedir=/dir/incl/```&quot;。&lt;br&gt;</span><br><span class="line">可以设置多个目录，在Windows中，用分号分隔目录。在任何其它系统</span><br><span class="line">中用冒号分隔目录。作为Apache模块时，父目录中的`open_basedir`路径自动被继承。</span><br><span class="line"></span><br><span class="line">### 3.5.12.其他安全配置</span><br><span class="line">1. 取消其它用户对常用、重要系统命令的读写执行权限</span><br><span class="line">- 一般管理员维护只需一个普通用户和管理用户，除了这两个用户，给其它用户能够执行和访问的东西应该越少越好，所以取消其它用户对常用、</span><br><span class="line">重要系统命令的读写执行权限能在程序或者服务出现漏洞的时候给攻击</span><br><span class="line">者带来很大的迷惑。&lt;br&gt;</span><br><span class="line">记住一定要连读的权限也去掉，否则在linux下可以用```/lib/ld-linux.so.2/bin/ls```这种方式来执行。</span><br><span class="line">- 如果要取消程序如果是在chroot环境里，这个工作比较容易实现，否则，</span><br><span class="line">这项工作还是有些挑战的。因为取消一些程序的执行权限会导致一些服</span><br><span class="line">务运行不正常。PHP的mail函数需要`/bin/sh`去调用`sendmail`发信，所以</span><br><span class="line">`/bin/bash`的执行权限不能去掉。</span><br><span class="line">2. 去掉apache日志其它用户的读权限：</span><br><span class="line">- apache的access-log给一些出现本地包含漏洞的程序提供了方便之门。通过提交包含PHP代码的URL，可以使access-log包含PHP代码，那么把包含文件指向access-log就可以执行那些PHP代码，从而获得本地访问</span><br><span class="line">权限；</span><br><span class="line">- 如果有其它虚拟主机，也应该相应去掉该日志文件其它用户的读权限；</span><br><span class="line">- 当然，如果你按照前面介绍的配置PHP那么一般已经是无法读取日志文件了。</span><br><span class="line">3. 保持运行环境干净。</span><br><span class="line">4. 不能在Web目录放测试文件。 </span><br><span class="line"></span><br><span class="line">## 3.6.C/C++安全开发要求</span><br><span class="line">C本质上是不安全的编程语言。例如如果不谨慎使用的话，其大多数标准的字符串库函数有可能被用来进行缓冲区攻击或者格式字符串攻击。但是，由于其</span><br><span class="line">灵活性、快速和相对容易掌握，它是一个广泛使用的编程语言。&lt;br&gt;</span><br><span class="line">下面是针对开发安全的C语言程序的一些规范。</span><br><span class="line"></span><br><span class="line">### 3.6.1.缓冲区溢出</span><br><span class="line">避免使用不执行边界检查的字符串函数，因为它们可能被用来进行缓冲</span><br><span class="line">区溢出攻击。下面是应该避免使用的函数。同时，也列出了每个函数相应的比较安全的替换方式。</span><br><span class="line">- 不使用strcpy()，使用strncpy()；</span><br><span class="line">- 不使用strcat()，使用strncat()；</span><br><span class="line">- 不使用sprintf()，使用snprintf()；</span><br><span class="line">- 不使用gets()，使用fgets()。</span><br><span class="line"></span><br><span class="line">在上面的前三个中函数中，每个替代函数的“n”表示了使用的缓冲区的</span><br><span class="line">大小。最后一个函数的“f”，表示格式，它允许用户指定期望的输入的格式。&lt;br&gt;</span><br><span class="line">这些替换方程强制程序员定义使用的缓冲区的尺寸以及确定输入的类型。</span><br><span class="line"></span><br><span class="line">### 3.6.2.格式化字符串攻击</span><br><span class="line">该类攻击往往与缓冲区溢出相关，因为它们主要利用了某些函数的假</span><br><span class="line">设，例如`sprintf()`和`vsprintf()`假设缓冲区的长度是无限的。然而即使使用`snprintf()`替换`sprintf()`也无法完全保护程序不受格式化字符串的攻击。这些攻击通过直接将格式说明符```（formatspecifiers）(%d，%s，%n等)```传递到输出函数接收缓冲区来进行。&lt;br&gt;</span><br><span class="line">例如，以下的代码就是不安全的：```snprintf(buffer,sizeof(buffer),string)```这种情况下，可以在字符串中插入格式说明符来操纵内存的栈，来写入</span><br><span class="line">攻击者的数据（这些数据中包含小的程序代码，并可由处理器接着执行）。&lt;br&gt;</span><br><span class="line">对以上的例子建议使用下面的代码。&lt;br&gt;</span><br></pre></td></tr></table></figure></p>
<p>snprintf(buffer,sizeof(buffer),“%s”,string)<br><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">进行格式字符串攻击不太容易。首先攻击者必须能获得内存栈的内容情</span><br><span class="line">况（或者从应用导出或者使用调试器），然后必须知道如何精确访问特定的内存空间来操纵栈中的变量。&lt;br&gt;</span><br><span class="line">执行外部程序推荐使用`exec()`函数而不是`<span class="keyword">system</span>()`函数来执行外部程序。这是因为`<span class="keyword">system</span>()`接收整个命令行的随机的缓冲区来执行程序。</span><br></pre></td></tr></table></figure></p>
<p>snprintf(buffer,sizeof(buffer),”emacs%s”,filename);<br>system(buffer);<br><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">在以上的例子中，可以通过使用分号利用文件名变量在sehll中插入额</span><br><span class="line">外的命令（例如文件名可以是`/etc/hosts;rm*`，这将在显示`/etc/hosts`目录文件</span><br><span class="line">的同时，删除目录中的所有文件）。</span><br><span class="line">而exec()函数只保证第一个参数被执行：</span><br></pre></td></tr></table></figure></p>
<p>execl(“usr/bin/emacs”,”usr/bin/emacs”,filename,NULL);<br><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">上面的例子保证文件名仅仅作为一个参数输入Emacs工具，同样它在Emacs命令中使用完全的路径而不是使用可以被攻击者利用的PATH环境变量。</span><br><span class="line"></span><br><span class="line">### <span class="number">3.6</span><span class="number">.3</span>.竞争条件</span><br><span class="line">进程需要访问资源时（无论是磁盘、内存或是文件）通常需要执行两个步骤：</span><br><span class="line"><span class="number">1.</span> 首先测试资源是否空闲可用；</span><br><span class="line"><span class="number">2.</span> 如果可用，就访问该资源，否则它等到资源不再使用为止再去访问它。</span><br><span class="line"></span><br><span class="line">当另一个进程在步骤<span class="number">1</span>和<span class="number">2</span>之间想要访问同一个资源时就出现问题了。这会</span><br><span class="line">导致不可预测的结果。进程可能会被锁定，或者一个进程劫持获得了另一个进程的较大的权限而导致安全问题。攻击主要集中在有较大权限的程序上（称为setuid程序）。竞争条件攻击通常利用程序执行时可以访问到的资源。另外权限低的程</span><br><span class="line">序也存在安全风险，因为攻击者可能会等待有较高权限的用户执行那个程序(例如root)，然后进行攻击。&lt;br&gt;</span><br><span class="line">下面的建议有助于缓解竞争条件(racecondition)攻击：&lt;br&gt;</span><br><span class="line">在进行文件操作时，利用那些使用文件描述符的函数而不能使用那些使用文件路径的函数（例如使用`fdopen()`而不能使用`fopen()`）。文件描述符使得恶意的</span><br><span class="line">用户在文件打开时或是在原始的进程对文件进行操作前，无法使用文件连接（符号式的或是物理的）来改变文件。&lt;br&gt;</span><br><span class="line">在写文件甚至在读文件时使用`fcntl()`和`flock()`函数来对文件加锁，这样它们就不能被其他进程访问。它几乎可以建立原子级的操作。</span><br><span class="line">谨慎操纵临时文件，因为它往往会导致竞争条件。</span><br><span class="line"></span><br><span class="line">### <span class="number">3.6</span><span class="number">.4</span>.检验有效的返回值</span><br><span class="line">检验有效的返回值非常重要。一个例子是旧的`/bin/login`的实现中不检验错</span><br><span class="line">误的返回值，导致当它找不到`/etc/passwd`文件时返回root的访问权限。如果该文</span><br><span class="line">件损坏了，那么这种情况是合理的，但如果该文件存在只是无法访问，那么这就是一个大问题。</span><br><span class="line"></span><br><span class="line">## <span class="number">3.7</span>.Perl安全开发要求</span><br><span class="line">多年以来，Perl已经成为用于系统管理和WebCGI开发的功能最强的编</span><br><span class="line">程语言之一（几乎可以使用Perl做任何功能的程序）。但其扩展应用，即作</span><br><span class="line">另外，大多数CGI脚本有着比一般用户更高的权限，导致它更容易受攻击。&lt;br&gt;</span><br><span class="line">下面列举了一些开发者（特别是CGI程序员）可以使用的主动的预防性的措</span><br><span class="line">施来增强Perl代码的整体安全性（请注意：这不是Web服务器CGI脚本安全性的指导原则）。</span><br><span class="line"></span><br><span class="line">### <span class="number">3.7</span><span class="number">.1</span>.Taint验证</span><br><span class="line">Perl版本<span class="number">5.</span>x包含一个叫做`TaintChecking`的数据验证措施。如果起用该</span><br><span class="line">功能，将不允许通过用户输入（任何程序外的输入）来操纵其他的外部程序</span><br><span class="line">（例如通过管道将数据导入另一个程序执行））。&lt;br&gt;</span><br><span class="line">一般而言，程序员不能信任输入脚本和程序的数据（叫做Tainted数据），因为无法保证它不会产生危害（有意或者无意的）。Taint验证可以通过在命令行参数加入“-T”来开启。&lt;br&gt;</span><br><span class="line">例如你可以在Perl脚本的第一行这样加入“-T”：</span><br></pre></td></tr></table></figure></p>
<p>#!usr/bin/perl5-T<br><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">Tainted数据包括命令行参数、环境变量和来自文件的数据。&lt;br&gt;</span><br><span class="line">引用tainted数据的变量也称为tainted数据。如果脚本试图通过不安全的方式来使用tainted数据会产生一个致命错误（对这种情况称为“不安全的依赖”(Insecuredependency)或者其他的说法）。&lt;br&gt;</span><br><span class="line">启用tainted验证在有些情况下会导致脚本停止运行，常常是由于Perl解释器要求所有脚本引用的外部程序的完全路径必</span><br><span class="line">须在PATH环境变量中列出，同时PATH中包含的每个目录除了目录的所有</span><br><span class="line">者及相应的所有者用户组外无法修改。&lt;br&gt;</span><br><span class="line">Taint验证对于环境比较敏感，但是</span><br><span class="line">只要可能的话，应该使用taint验证，特别是代码执行其他程序功能时（例如在CGI脚本的情况下）。</span><br><span class="line"></span><br><span class="line">### <span class="number">3.7</span><span class="number">.2</span>.安全模块</span><br><span class="line">如果不但输入数据不可信而且实际的代码也不可信，例如用户从网站上下载了一个ActiveX控件，而它实际是一个特洛伊木马(Trojanhorse)。这种情况下taint验证就不起作用。&lt;br&gt;</span><br><span class="line">安全模块让程序员可以在Perl脚本中将不同</span><br><span class="line">的代码模块与安全对象联系。每个安全对象对于运行的每块代码建立了一个</span><br><span class="line">限制的环境。这与chroot在一个进程中只能在整体目录结构的一个子目录中</span><br><span class="line">运行类似。而saft对象限制perl代码只能在perl包结构的某些特定包中运行。</span><br><span class="line">如何使用安全模式超出了本文的范围，但是程序员应该在任何时候尽量使用这一功能。</span><br><span class="line"></span><br><span class="line">### <span class="number">3.7</span><span class="number">.3</span>.警告参数</span><br><span class="line">使用-w参数可以在Perl解释脚本时显示所有的警告信息。警告可以在以下情况产生：只使用了一次的变量或者完全没有使用过得变量，未定义的文</span><br><span class="line">件句柄，未关闭的文件句柄，或者将非数值变量传递到数据变量。该功能不</span><br><span class="line">是针对安全处理的，但是可以有助于调试直接或者间接对安全有危害的错误。一般推荐总是使用-w参数。&lt;br&gt;可以在taint验证时在第一行这样使用-w参数：</span><br><span class="line">```#!usr/bin/perl5-Tw</span><br></pre></td></tr></table></figure></p>
<hr>
<h1 id="4-应用系统测试安全"><a href="#4-应用系统测试安全" class="headerlink" title="4.应用系统测试安全"></a>4.应用系统测试安全</h1><p>应用系统在正式上线前应对安全性进行测试，验证应用系统的安全性是否符合安全设计及安全需求，应用系统的安全测试包括以下内容：</p>
<h2 id="4-1-测试前的要求"><a href="#4-1-测试前的要求" class="headerlink" title="4.1.测试前的要求"></a>4.1.测试前的要求</h2><p>测试之前，首先要确定测试大纲，在测试大纲中应当明确应用安全方面的测试内容、手段及方案（即测试用例）。包括：</p>
<ul>
<li>安全性测试的环境要求；</li>
<li>安全性测试软件、测试设备要求；</li>
<li>安全性测试人员要求；</li>
<li>安全性测试的时间要求；</li>
<li>安全性测试的内容；</li>
<li>安全性测试的输入数据；</li>
<li>安全性测试的预期结果；</li>
<li>安全性测试的详细过程；</li>
<li>安全性测试的风险和风险规避方案。</li>
</ul>
<p>测试大纲中安全性方面的描述是进行安全性测试的一个重要依据。大纲<br>内容的编写应当依据应用系统需求说明书及应用系统设计说明书中，有关安全方面的内容来编写相应的测试用例。</p>
<h2 id="4-2-测试方法及内容要求"><a href="#4-2-测试方法及内容要求" class="headerlink" title="4.2.测试方法及内容要求"></a>4.2.测试方法及内容要求</h2><ol>
<li><p>应根据应用系统的具体情况，设计安全性测试的具体方法和内容，通常<br>主要的测试方法和内容分为<strong>功能性测试、压力测试、渗透性测试、审核性测试</strong>。</p>
<ul>
<li>功能性测试<br><br>对应用系统的安全功能点进行测试，确保安全功能的有效性、正确性。<ul>
<li>这些功能点应全部包含在测试大纲中，在大纲的测试用例中体现具体的测    试方    法。测试大纲中的这些内容应当覆盖了需求说明书中安全功能部分的要    求。</li>
<li>测试的具体内容主要涉及以下几个方面：<ul>
<li>安全审计</li>
<li>通信安全</li>
<li>数据保护</li>
<li>身份认证</li>
<li>容错及资源分配方面的要求</li>
</ul>
</li>
</ul>
</li>
<li>压力测试<br><br>对应用系统的安全功能进行压力测试，确保安全功能可以满足设计的需要。<ul>
<li>压力测试的具体应全部包含在测试大纲中，在大纲的测试用例中体现具    体的测    试方法。</li>
<li>测试大纲中的这些要求应当参照设计说明书中所描述的设计目标进<br>行测试用例的设计，包括但不限于：<ul>
<li>应用系统服务器端和单个终端进行安全数据传输的最大容量。</li>
<li>应用系统服务器端能够与多少终端同时进行安全数据传输。</li>
<li>服务器承受的最大并发连接数。</li>
</ul>
</li>
</ul>
</li>
<li>渗透性测试<br><br>模拟攻击手段，对应用系统抵抗攻击的能力进行测试。主要测试应用程序及应用系统配置上的安全漏洞。<ul>
<li>渗透测试的具体应全部包含在测试大纲中，在大纲的测试用例中体现具    体的测    试方法。</li>
<li>测试大纲中渗透测试方法的选择需要依据设计说明书中描述的应用系统    采用的    开发工具及应用系统安装所需要的基础应用平台，如iis、apached    等，来设计不    同的测试方法，包括但不限于：<ul>
<li>对webserver的渗透攻击测试或者工具扫描性测试。</li>
<li>SQL注入、跨栈攻击。</li>
</ul>
</li>
</ul>
</li>
<li>审核性测试<ul>
<li>代码审核。这不是必需的测试手段，如果条件允许，可以针对容易出现代码漏    洞的程序，特别是关于身份认证等方面的部分代码进行审核。</li>
<li>可以采用开发相关的专用扫描工具，或者编制相应的脚本程序，检查代码中的    不安全函数的使用，如：<code>strcpy()，strcat()</code>等。</li>
</ul>
</li>
</ul>
</li>
<li><p>测试过程中，应详细记录测试过程发生的每一件事情，列出测试过程中<br>发现的问题。这些信息包括：发现了什么，在哪里发现的，当时的环境，这些问题是否可重现。</p>
</li>
<li>应根据测试的过程和测试结果，提出被测试系统、测试过程等方面的改进说明。</li>
<li>应确保测试用例、测试内容和测试结果的保密性。</li>
</ol>
<h2 id="4-3-测试环境及人员安全要求"><a href="#4-3-测试环境及人员安全要求" class="headerlink" title="4.3.测试环境及人员安全要求"></a>4.3.测试环境及人员安全要求</h2><ol>
<li>测试环境的物理、硬软件环境要求应当可以模拟真实环境。</li>
<li>为确保测试环境的安全，应将测试环境与开发环境、生产环境相隔离，避免测试工作对业务的影响。</li>
<li>测试数据如果选择是真实数据，应限定使用该数据的测试人员的数量，并在测试完成后全部删除。</li>
<li>系统测试和验收通常需要大量的（真实数据）尽可能靠近实际运行数据的测试数据。应避免使用含有个人信息的业务数据库。如果要使用其中<br>信息，在用之前应使其失去个性化。当把运行数据用于测试目的时，应采取以下措施保护运行数据。<ul>
<li>如果该数据由测试人员使用，则需要相关授权业务人员参与，或者监督。</li>
<li>每次把运行信息复制到测试应用系统都应有单独的授权。</li>
<li>应记录运行信息的复制和使用，以提供一种检查追踪。</li>
</ul>
</li>
<li>在与其他系统的互操作性测试中，应充分考虑对其他系统的影响，选择适当的时间、方法。</li>
</ol>
<h2 id="4-4-测试后的要求"><a href="#4-4-测试后的要求" class="headerlink" title="4.4.测试后的要求"></a>4.4.测试后的要求</h2><p>测试完成后，在正式上线前，应进行安全检查，消除测试用的一切后门、用户名及口令等，包括但不限于：</p>
<ol>
<li>测试用的测试数据，即测试过程中的临时数据，特别注意要删除授权访问的那些重要测试数据。</li>
<li>测试用的账号、口令，特别是有高级权限的账号。</li>
<li>测试用时临时开通的系统服务、防火墙端口及策略。</li>
<li>与外系统测试时，要求外系统上临时开启的服务、账号等。</li>
</ol>

      

    </div>





    <footer class="article-footer">
      
        <a data-url="https://www.pa55w0rd.club/应用开发安全指南/" data-id="cjop4ynjo002rldt6yn2gyg20" class="article-share-link" data-share="baidu" data-title="应用开发安全指南">分享到</a>
      

      
        <a href="https://www.pa55w0rd.club/应用开发安全指南/#gitalk-container" class="article-comment-link">评论</a>
      

      

    </footer>
  </div>
  
</article>
<!--
<div class="share-component" data-disabled="" data-description="Share.js - 一键分享到微博，QQ空间，腾讯微博，人人，豆瓣">一键分享</div>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/css/share.min.css" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/js/social-share.min.js"></script>
-->







  
    <article id="post-应用系统开发安全" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div data-scroll-reveal="enter top and over 0.7s" class="article-meta">
    <a href="/应用系统开发安全/" class="article-date">
  <i class="fa fa-calendar"></i>
  <time datetime="2018-09-28T09:37:59.000Z" itemprop="datePublished">2018-09-28</time>
</a>

    
  <div class="article-category">
    <a class="article-category-link" href="/categories/开发安全/">开发安全</a>
  </div>


  </div>
  <div class="article-inner">
    
    

      <header class="article-header">

        
  
    <h1 itemprop="name">
      <a class="article-title" href="/应用系统开发安全/">
        <i class="fa fa-pencil-square-o  article-title-icon"></i>应用系统开发安全</a>
    </h1>
  



      </header>
    
    <div class="article-entry" itemprop="articleBody">
      

        <br>
        <span id="busuanzi_container_page_pv">
          阅读次数<span id="busuanzi_value_page_pv"></span>
        </span>
        <ul>
<li>目录<br>{:toc}</li>
</ul>
<h2 id="一、安全原则"><a href="#一、安全原则" class="headerlink" title="一、安全原则"></a>一、安全原则</h2><ol>
<li>保护最薄弱的环节原则：保护最易受攻击影响的部分；</li>
<li>纵深防御原则：不同层面、不同角度之间需要相互配合；</li>
<li>最小权限原则：只授予执行操作所需的最小权限； </li>
<li>最小共享原则：使共享文件资源尽可能少；</li>
<li>权限分离原则：授予不同用户所需的最小权限，并在它们之间形成相互制约的关系；</li>
</ol>
<hr>
<h2 id="二、需求管理阶段"><a href="#二、需求管理阶段" class="headerlink" title="二、需求管理阶段"></a>二、需求管理阶段</h2><ol>
<li>根据业务目标分析并制定系统安全目标；</li>
<li>确认安全需求规格说明。</li>
</ol>
<hr>
<h2 id="三、系统设计阶段"><a href="#三、系统设计阶段" class="headerlink" title="三、系统设计阶段"></a>三、系统设计阶段</h2><ol>
<li>根据安全目标执行威胁建模，识别威胁和风险；</li>
<li>根据威胁建模制定对应开发安全任务：<ul>
<li>确定安全体系架构，设计安全协议和安全接口；</li>
<li>确定访问控制与身份鉴别机制，定义主体角色和权限；</li>
<li>信息输入的安全过滤，信息输出的校验和控制；</li>
<li>数据结构安全设计，选择加密方法和算法；</li>
<li>确定敏感数据保护方法；</li>
<li>内部处理逻辑安全设计；</li>
<li>评估内部通信机制，确定完整性机制。</li>
</ul>
</li>
</ol>
<hr>
<h2 id="四、系统实现阶段"><a href="#四、系统实现阶段" class="headerlink" title="四、系统实现阶段"></a>四、系统实现阶段</h2><ol>
<li>开发环境安全管理要求：<ul>
<li>软件系统开发、测试禁止在生产环境中进行；</li>
<li>开发环境中的开发用机应进行统一安全配置及时进行系统补丁升级和漏洞修复；</li>
<li>软件程序不得篡改应用软件所运行的环境或平台中任何安全配置、安全文件和安全程序。</li>
</ul>
</li>
<li>编码安全要求（后面会有详细讲解）：<ul>
<li>遵循代码编写安全规范，根据代码编写安全规范以及安全设计方案进行系统开发；</li>
<li>遵循通用安全编程准则，包括输入验证、缓存溢出、安全调用组件和程序编译等；</li>
<li>遵循机密性要求，保护用户访问信息的机密性，严禁在客户端存放敏感数据</li>
<li>避免内存溢出，严格检查和验证输入输出信息等；</li>
<li>遵循结构化异常处理机制，捕捉并处理程序异常，防止系统信息泄露 </li>
<li>遵循代码脆弱性防范要求，包括缓冲区溢出、SQL注入、跨站脚本攻击、XML注入攻击、HTTP HEAD注入等。</li>
</ul>
</li>
<li>开发流程安全要求：<ul>
<li>开发过程中应对阶段性开发成果进行有效管理；</li>
<li>开发过程中应定期进行代码静态分析，使用代码审核工具对源代码进行检测，并报告源代码中存在的安全弱点；</li>
<li>开发人员不得超越其规定权限进行开发，不得在程序中设置后门或恶意代码程序。</li>
</ul>
</li>
</ol>
<hr>
<h2 id="五、系统测试阶段"><a href="#五、系统测试阶段" class="headerlink" title="五、系统测试阶段"></a>五、系统测试阶段</h2><ol>
<li>测试内容应包括代码的安全测试和安全功能测试；</li>
<li>代码的安全测试是指使用代码测试工具或渗透测试来识别代码的安全脆弱性，并应按照其提供的修复建议进行修复；</li>
<li>安全功能测试主要包括身份认证和访问控制的功能测试；</li>
<li>测试系统环境应尽可能模拟生产环境并与生产环境进行安全隔离；</li>
<li>真实数据不得直接在测试环境中使用，须进行适当修改或屏蔽，在测试完成之后须立即从测试应用系统清除运行信息；</li>
<li>测试人员编制安全测试方案，构造安全测试用例；</li>
<li>验收测试不得由开发人员兼岗。</li>
</ol>
<hr>
<h2 id="六、系统上线阶段"><a href="#六、系统上线阶段" class="headerlink" title="六、系统上线阶段"></a>六、系统上线阶段</h2><ol>
<li>系统上线须在内部验收通过后进行；</li>
<li>需进行上线前试运行，确认应用系统是否符合上线要求；</li>
<li>上线成功后，记录上线的日期和内容。</li>
</ol>
<hr>
<h2 id="七、文档管理"><a href="#七、文档管理" class="headerlink" title="七、文档管理"></a>七、文档管理</h2><ol>
<li>源代码的变更和版本发布进行统一控制，对程序资源库的任何修改、更新和发布都需经部门主管领导授权和批准；</li>
<li>应指定专人妥善保管程序源代码及相关技术文档。</li>
</ol>
<hr>
<h2 id="八、外包管理"><a href="#八、外包管理" class="headerlink" title="八、外包管理"></a>八、外包管理</h2><ol>
<li>应与外包开发单位签署相关知识产权保护协议和保密协议；</li>
<li>外包开发单位进行系统开发过程中须严格遵循本制度的相关安全要求；</li>
<li>在系统开发过程中须指派专人监督审核外包开发单位在各个阶段安全要求的执行情况；</li>
<li>外包开发单位在系统开发完成后提供程序源代码和相关技术文档，不得将计算机系统采用的关键安全技术措施和核心安全功能设计对外公开；</li>
<li>应对开发完成后的应用软件进行审查或检测。</li>
</ol>

      

    </div>





    <footer class="article-footer">
      
        <a data-url="https://www.pa55w0rd.club/应用系统开发安全/" data-id="cjop4ynd60005ldt6lvminpxx" class="article-share-link" data-share="baidu" data-title="应用系统开发安全">分享到</a>
      

      
        <a href="https://www.pa55w0rd.club/应用系统开发安全/#gitalk-container" class="article-comment-link">评论</a>
      

      

    </footer>
  </div>
  
</article>
<!--
<div class="share-component" data-disabled="" data-description="Share.js - 一键分享到微博，QQ空间，腾讯微博，人人，豆瓣">一键分享</div>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/css/share.min.css" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/js/social-share.min.js"></script>
-->







  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/page/6/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><a class="page-number" href="/page/6/">6</a><span class="page-number current">7</span><a class="page-number" href="/page/8/">8</a><a class="page-number" href="/page/9/">9</a><a class="extend next" rel="next" href="/page/8/">Next &raquo;</a>
    </nav>
  

</section>
      
      <aside id="sidebar">
  
    
  <div class="widget-wrap">

    <h3 class="widget-title" data-scroll-reveal="enter top and over 0.7s"><i class="fa fa-file-text-o"></i>近期文章</h3>
    <div class="widget">
      <ul>
        
          <li onclick="javascript:document.getElementById('recentpost_item').click();">
            <a id="recentpost_item" href="/jekyll迁移hexo/">jekyll迁移hexo</a>
          </li>
        
          <li onclick="javascript:document.getElementById('recentpost_item').click();">
            <a id="recentpost_item" href="/lynis/">Lynis</a>
          </li>
        
          <li onclick="javascript:document.getElementById('recentpost_item').click();">
            <a id="recentpost_item" href="/git_edit_remoteurl/">Git修改远程URL</a>
          </li>
        
          <li onclick="javascript:document.getElementById('recentpost_item').click();">
            <a id="recentpost_item" href="/linux_firefox_error/">Centos 7 运行firefox出错</a>
          </li>
        
          <li onclick="javascript:document.getElementById('recentpost_item').click();">
            <a id="recentpost_item" href="/mongodb_auth/">mongodb开启认证</a>
          </li>
        
      </ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title" data-scroll-reveal="enter top and over 0.7s"><i class="fa fa-tasks"></i>分类</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/note/">note</a><span class="category-list-count">17</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/web安全/">web安全</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/企业安全/">企业安全</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/安全建设/">安全建设</a><span class="category-list-count">10</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/开发安全/">开发安全</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/移动安全/">移动安全</a><span class="category-list-count">3</span></li></ul>
    </div>
  </div>


  <script>
  $(document).on("click", "ul.category-list li.category-list-item", function () {
    window.location.href = $(this).find('a').attr('href')
  })
  </script>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title" data-scroll-reveal="enter top and over 0.7s"><i class="fa fa-cloud"></i>标签云</h3>
    <div class="widget tagcloud">
      <a href="/tags/note/" style="font-size: 10px;">note</a>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title" data-scroll-reveal="enter top and over 0.7s"><i class="fa fa-archive"></i>归档</h3>
    <div class="widget">
      <!-- <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">十一月 2018</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">十月 2018</a><span class="archive-list-count">25</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">九月 2018</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">一月 2018</a><span class="archive-list-count">1</span></li></ul> -->
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">2018年11月</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">2018年10月</a><span class="archive-list-count">25</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">2018年09月</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">2018年01月</a><span class="archive-list-count">1</span></li></ul>
    </div>
  </div>


<script>
$(document).on("click", "ul.archive-list li.archive-list-item", function () {
  window.location.href = $(this).find('a').attr('href')
})
</script>

  
    
  <style>
  *{ margin: 0; padding: 0;}
  .tooltips{ border-width: 1px; border-style: solid; position: absolute; display: none; border-radius: 3px; opacity: 0; filter:alpha( opacity = 0) ; z-index: 999;}
  .tooltips p.content{ padding: 5px; }
  .tooltips .triangle-front,.tooltips .triangle-back{ width: 0; height: 0; overflow: hidden; border-width: 8px; border-style: solid; position: absolute; border-color: transparent ; top: 100%; left: 50%; margin-left: -8px;}
  .tooltips .triangle-back{ margin-top: -1px;}

  .toolTipInfo{ border-color: #000; background-color: #EEEEEE;}
  .toolTipInfo .triangle-front{ border-top-color: #EEEEEE;}
  .toolTipInfo .triangle-back{ border-top-color: #EEEEEE;}


  .icoSize{font-size: 2em}
  </style>



  <div class="widget-wrap">
    <h3 class="widget-title" data-scroll-reveal="enter top and over 0.7s"><i class="fa fa-link"></i>链接</h3>
    <div class="widget" style="z-index: 1;">





      <!-- <ul> -->
        
          <!-- <li> -->
          

          

                  <a id="github-alt-icon-color" class="weight-icon-link" target="_blank" href="https://github.com/Pa55w0rd">
                      <span class="fa-stack fa-lg">
                          <i class="fa fa-circle fa-stack-2x"></i>
                          <i class="fa fa-github-alt fa-stack-1x fa-inverse"></i>
                      </span>
                  </a>
          

          

          

          

          

          

          


          

          


          <!-- </li> -->
        
          <!-- <li> -->
          

          

          

          

          

          

          

          


          
                  <a id="envelope-o-icon-color" class="weight-icon-link" target="_blank" href="mailto:pa55w0rd@aliyun.com" data-toggle="tooltip" data-placement="top" title="请多多交流！">
                  <span class="fa-stack fa-lg">
                          <i class="fa fa-circle fa-stack-2x"></i>
                          <i class="fa fa-envelope-o  fa-stack-1x fa-inverse"></i>
                      </span>
                  </a>
          

          


          <!-- </li> -->
        
      <!-- </ul> -->
    </div>
  </div>


  <script>
  $.fn.extend({
    hoverTips : function (){
      var self = $(this);
      var sw = self.get(0).switch;
      if( !sw ) {
        sw = true;
        var content = self.attr("tooltips");
        var htmlDom = $("<div class='tooltips'>")
            .addClass("toolTipInfo")
            .html("<p class='content'></p>"
                + "<p class='triangle-front'></p>"
                + "<p class='triangle-back'></p>");
        htmlDom.find("p.content").html( content );
      }
      self.on("mouseover",function(){
        $("body").append( htmlDom );
        var left = self.offset().left - htmlDom.outerWidth()/2 + self.outerWidth()/2;
        var top = self.offset().top - htmlDom.outerHeight() - parseInt(htmlDom.find(".triangle-front").css("border-width"));
        htmlDom.css({"left":left,"top":top - 10,"display":"block"});
        htmlDom.stop().animate({ "top" : top ,"opacity" : 1},300);
      });
      self.on("mouseout",function(){
        var top = parseInt(htmlDom.css("top"));
        htmlDom.stop().animate({ "top" : top - 10 ,"opacity" : 0},300,function(){
          htmlDom.remove();
          sw = false;
        });
      });
    },

  });

  $("#weixin-icon-color").hoverTips();
  $("#qq-icon-color").hoverTips();
  </script>



  
    
    <div class="widget-wrap">
  
      <h3 class="widget-title" data-scroll-reveal="enter top and over 0.7s"><i class="fa fa-group"></i>友链</h3>
      <div class="widget">
        <ul>
        
            <li onclick="javascript:document.getElementById('friend_links_item').click();">
              <a id="friend_links_item" href="https://firexun.github.io/"><i class="fa  fa-arrow-circle-right" style="margin-right:7px"></i>青衫磊落</a>
            </li>

        
        </ul>
      </div>
    </div>
  
  
  
</aside>

      
    </div>
    <footer id="footer">
  
  <div data-scroll-reveal="enter bottom" class="outer">
    <div id="footer-info" class="inner">
      &copy; 2018 Pa55w0rd<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
      .
      Theme by <a href="https://github.com/HipHopCoderS/Landscape-x" target="_blank">Landscape-x</a>
    </div>

    <div id="footer-info" class="inner">
      <!-- id 将作为查询条件 
      <span id="<Your/Path/Name>" class="leancloud-visitors" data-flag-title="Your Article Title">
        <em class="post-meta-item-text">阅读量 </em>
        <i class="leancloud-visitors-count">1000000</i>
      </span>
-->
      <script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_1257415698'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s95.cnzz.com/z_stat.php%3Fid%3D1257415698%26show%3Dpic' type='text/javascript'%3E%3C/script%3E"));</script>

    </div>
  </div>

</footer>

  </div>
  <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link"><i class="fa fa-home" aria-hidden="true"></i>首页</a>
  
    <a href="/archives" class="mobile-nav-link"><i class="fa fa-archive" aria-hidden="true"></i>归档</a>
  
    <a href="/about.html" class="mobile-nav-link"><i class="fa fa-user" aria-hidden="true"></i>关于我</a>
  
</nav>

  <!-- totop start -->
<div id="totop">
<a title="返回顶部"><img src="/img/betop.png"></a>
</div>

<!-- totop end -->



  <script>
    const gitalk = new Gitalk({
      clientID: "992fba235eb173826494",
      clientSecret: "d133f6427763be2cf4048e4d146a22043e745f22",
      repo: "www.pa55w0rd.club",
      owner: "Pa55w0rd",
      admin: "Pa55w0rd",
      // id: location.pathname,      // Ensure uniqueness and length less than 50
      id: "",      // Ensure uniqueness and length less than 50
      distractionFreeMode: false  // Facebook-like distraction free mode
    })
    gitalk.render('gitalk-container')
  </script>




<!-- 百度分享 start -->

<div id="article-share-box" class="article-share-box">
  <div id="bdshare" class="bdsharebuttonbox article-share-links">
    <a class="article-share-weibo" data-cmd="tsina" title="分享到新浪微博"></a>
    <a class="article-share-weixin" data-cmd="weixin" title="分享到微信"></a>
    <a class="article-share-qq" data-cmd="sqq" title="分享到QQ"></a>
    <a class="article-share-renren" data-cmd="renren" title="分享到人人网"></a>
    <a class="article-share-more" data-cmd="more" title="更多"></a>
  </div>
</div>
<script>
  function SetShareData(cmd, config) {
    if (shareDataTitle && shareDataUrl) {
      config.bdText = shareDataTitle;
      config.bdUrl = shareDataUrl;
    }
    return config;
  }
  window._bd_share_config={
    "common":{onBeforeClick: SetShareData},
    "share":{"bdCustomStyle":"/css/bdshare.css"}
  };
  with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?cdnversion='+~(-new Date()/36e5)];
</script>

<!-- 百度分享 end -->

<!-- <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script> -->
<script src="//cdn.bootcss.com/jquery/3.0.0-beta1/jquery.min.js"></script>



  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>



<! -- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
                processEscapes: true
                    
}
  
        });
</script>

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
tex2jax: {
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
                  
}
    
        });
</script>

<script type="text/x-mathjax-config">
MathJax.Hub.Queue(function() {
            var all = MathJax.Hub.getAllJax(), i;
            for(i=0; i < all.length; i += 1) {
                            all[i].SourceElement().parentNode.className += ' has-jax';
                                    
            }
                
        });
</script>

<script type="text/javascript" src="http://cdn.bootcss.com/mathjax/2.5.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


<script src="/js/script.js"></script>


</div>
</body>
</html>



<div class="site-search">
  <div class="algolia-popup popup">
    <div class="algolia-search">
      <div class="algolia-search-input-icon">
        <i class="fa fa-search"></i>
      </div>
      <div class="algolia-search-input" id="algolia-search-input"></div>
    </div>
    <div class="algolia-results">
      <div id="algolia-stats"></div>
      <div id="algolia-hits"></div>
      <div id="algolia-pagination" class="algolia-pagination"></div>
    </div>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
  </div>
</div>


<script>
$(document).ready(function(){
window.scrollReveal = new scrollReveal({ reset: true});
//
})
</script>
